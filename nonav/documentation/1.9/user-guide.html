<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Jersey 1.9 User Guide</title><link rel="stylesheet" href="http://jersey.java.net/documentation.css" type="text/css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.75.2"><script xmlns:fo="http://www.w3.org/1999/XSL/Format" type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-3160303-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns:fo="http://www.w3.org/1999/XSL/Format" style="float:right"><a href="http://jersey.java.net"><img src="http://jersey.java.net/images/Jersey_yellow.png"></a></div><small xmlns:fo="http://www.w3.org/1999/XSL/Format">Links: <a href="index.html">Table of Contents</a> | <a href="user-guide.html">Single HTML</a></small><div class="book" title="Jersey 1.9 User Guide"><div class="titlepage"><div><div><h1 class="title"><a name="d4e1"></a>Jersey 1.9 User Guide</h1></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="chapter"><a href="#getting-started">1. Getting Started</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e55">1.1. Creating a root resource</a></span></dt><dt><span class="section"><a href="#d4e62">1.2. Deploying the root resource</a></span></dt><dt><span class="section"><a href="#d4e76">1.3. Testing the root resource</a></span></dt><dt><span class="section"><a href="#getting.started.created">1.4. Here's one Paul created earlier</a></span></dt></dl></dd><dt><span class="chapter"><a href="#jax-rs">2. Overview of JAX-RS 1.1</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e96">2.1. Root Resource Classes</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e112">2.1.1. @Path</a></span></dt><dt><span class="section"><a href="#d4e137">2.1.2. HTTP Methods</a></span></dt><dt><span class="section"><a href="#d4e152">2.1.3. @Produces</a></span></dt><dt><span class="section"><a href="#d4e184">2.1.4. @Consumes</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e196">2.2. Deploying a RESTful Web Service</a></span></dt><dt><span class="section"><a href="#d4e255">2.3. Extracting Request Parameters</a></span></dt><dt><span class="section"><a href="#d4e332">2.4. Representations and Java Types</a></span></dt><dt><span class="section"><a href="#d4e365">2.5. Building Responses</a></span></dt><dt><span class="section"><a href="#d4e382">2.6. Sub-resources</a></span></dt><dt><span class="section"><a href="#d4e413">2.7. Building URIs</a></span></dt><dt><span class="section"><a href="#d4e443">2.8. WebApplicationException and Mapping Exceptions to Responses</a></span></dt><dt><span class="section"><a href="#d4e473">2.9. Conditional GETs and Returning 304 (Not Modified) Responses</a></span></dt><dt><span class="section"><a href="#d4e491">2.10. Life-cycle of Root Resource Classes</a></span></dt><dt><span class="section"><a href="#d4e499">2.11. Security</a></span></dt><dt><span class="section"><a href="#d4e512">2.12. Rules of Injection</a></span></dt><dt><span class="section"><a href="#d4e524">2.13. Use of @Context</a></span></dt><dt><span class="section"><a href="#d4e536">2.14. Annotations Defined By JAX-RS</a></span></dt></dl></dd><dt><span class="chapter"><a href="#client-api">3. Client API</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e542">3.1. Introduction</a></span></dt><dt><span class="section"><a href="#d4e556">3.2. Uniform Interface Constraint</a></span></dt><dt><span class="section"><a href="#d4e581">3.3. Ease of use and reusing JAX-RS artifacts</a></span></dt><dt><span class="section"><a href="#d4e617">3.4. Getting started with the Jersey client</a></span></dt><dt><span class="section"><a href="#d4e626">3.5. Overview of the API</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e631">3.5.1. Configuring a Client and WebResource</a></span></dt><dt><span class="section"><a href="#d4e652">3.5.2. Building a request</a></span></dt><dt><span class="section"><a href="#d4e673">3.5.3. Receiving a response</a></span></dt><dt><span class="section"><a href="#d4e685">3.5.4. Creating new WebResources from a WebResource</a></span></dt><dt><span class="section"><a href="#d4e691">3.5.5. Java instances and types for representations</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e702">3.6. Adding support for new representations</a></span></dt><dt><span class="section"><a href="#d4e714">3.7. Using filters</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e748">3.7.1. Supported filters</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e767">3.8. Testing services</a></span></dt><dt><span class="section"><a href="#d4e786">3.9. Security with Http(s)URLConnection</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e788">3.9.1. With Http(s)URLConnection</a></span></dt><dt><span class="section"><a href="#d4e804">3.9.2. With Apache HTTP client</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#xml">4. XML Support</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e814">4.1. Low level XML support</a></span></dt><dt><span class="section"><a href="#d4e828">4.2. Getting started with JAXB</a></span></dt><dt><span class="section"><a href="#d4e857">4.3. POJOs</a></span></dt><dt><span class="section"><a href="#d4e873">4.4. Using custom JAXBContext</a></span></dt></dl></dd><dt><span class="chapter"><a href="#json">5. JSON Support</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e903">5.1. POJO support</a></span></dt><dt><span class="section"><a href="#d4e921">5.2. JAXB Based JSON support</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e936">5.2.1. Configuration Options</a></span></dt><dt><span class="section"><a href="#d4e957">5.2.2. JSON Notations</a></span></dt><dt><span class="section"><a href="#d4e1127">5.2.3. Examples</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e1132">5.3. Low-Level JSON support</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1146">5.3.1. Examples</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#linking">6. Declarative Hyperlinking</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1155">6.1. Links in Representations</a></span></dt><dt><span class="section"><a href="#d4e1169">6.2. Binding Template Parameters</a></span></dt><dt><span class="section"><a href="#d4e1204">6.3. Conditional Link Injection</a></span></dt><dt><span class="section"><a href="#d4e1213">6.4. Link Headers</a></span></dt><dt><span class="section"><a href="#d4e1227">6.5. Configuration</a></span></dt></dl></dd><dt><span class="chapter"><a href="#test-framework">7. Jersey Test Framework</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1252">7.1. What is different in Jersey 1.2</a></span></dt><dt><span class="section"><a href="#d4e1275">7.2. Using test framework</a></span></dt><dt><span class="section"><a href="#d4e1318">7.3. Creating tests</a></span></dt><dt><span class="section"><a href="#d4e1325">7.4. Creating own module</a></span></dt><dt><span class="section"><a href="#d4e1336">7.5. Running tests outside Maven</a></span></dt></dl></dd><dt><span class="chapter"><a href="#osgi">8. OSGi</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1389">8.1. Feature Overview</a></span></dt><dt><span class="section"><a href="#d4e1425">8.2. WAB Example</a></span></dt><dt><span class="section"><a href="#d4e1437">8.3. Http Service Example</a></span></dt></dl></dd><dt><span class="chapter"><a href="#jrebel">9. JRebel support</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1451">9.1. How to use JRebel with Jersey</a></span></dt><dt><span class="section"><a href="#d4e1457">9.2. Using JRebel with the hello world sample</a></span></dt><dt><span class="section"><a href="#d4e1472">9.3. Limitations</a></span></dt></dl></dd><dt><span class="chapter"><a href="#experimental">10. Experimental Features</a></span></dt><dd><dl><dt><span class="section"><a href="#hypermedia">10.1. Hypermedia Actions</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1482">10.1.1. Introduction</a></span></dt><dt><span class="section"><a href="#d4e1500">10.1.2. Hypermedia by Example</a></span></dt><dt><span class="section"><a href="#d4e1523">10.1.3. Server API</a></span></dt><dt><span class="section"><a href="#d4e1560">10.1.4. Client API</a></span></dt><dt><span class="section"><a href="#d4e1610">10.1.5. Server Evolution</a></span></dt><dt><span class="section"><a href="#d4e1620">10.1.6. Configuring Hypermedia in Jersey</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#chapter_deps">11. Dependencies</a></span></dt><dd><dl><dt><span class="section"><a href="#core_server">11.1. Core server</a></span></dt><dt><span class="section"><a href="#core_client">11.2. Core client</a></span></dt><dt><span class="section"><a href="#d4e1720">11.3. Container</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1722">11.3.1. Grizzly HTTP Web server</a></span></dt><dt><span class="section"><a href="#d4e1730">11.3.2. Simple HTTP Web server</a></span></dt><dt><span class="section"><a href="#d4e1734">11.3.3. Light weight HTTP server</a></span></dt><dt><span class="section"><a href="#d4e1737">11.3.4. Servlet</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e1749">11.4. Entity</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1751">11.4.1. JAXB</a></span></dt><dt><span class="section"><a href="#d4e1796">11.4.2. Atom</a></span></dt><dt><span class="section"><a href="#d4e1817">11.4.3. JSON</a></span></dt><dt><span class="section"><a href="#d4e1829">11.4.4. Mail and MIME multipart</a></span></dt><dt><span class="section"><a href="#d4e1850">11.4.5. Activation</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e1854">11.5. Tools</a></span></dt><dt><span class="section"><a href="#d4e1858">11.6. Spring</a></span></dt><dt><span class="section"><a href="#d4e1865">11.7. Guice</a></span></dt><dt><span class="section"><a href="#d4e1881">11.8. Jersey Test Framework</a></span></dt></dl></dd><dt><span class="chapter"><a href="#glassfish">12. Jersey with GlassFish</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1927">12.1. Overriding Jersey with war files</a></span></dt><dt><span class="section"><a href="#d4e1934">12.2. Upgrading Jersey in GlassFish</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1936">12.2.1. GlassFish v3.0 and 3.0.1</a></span></dt><dt><span class="section"><a href="#d4e1956">12.2.2. GlassFish 3.1</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#how-to-build">13. Building and testing Jersey</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1982">13.1. Checking out the source</a></span></dt><dt><span class="section"><a href="#d4e1997">13.2. Building using Maven</a></span></dt><dt><span class="section"><a href="#d4e2009">13.3. Testing</a></span></dt><dt><span class="section"><a href="#d4e2015">13.4. Continuous building and testing with Hudson</a></span></dt><dt><span class="section"><a href="#d4e2019">13.5. Using NetBeans</a></span></dt></dl></dd></dl></div><div class="list-of-tables"><p><b>List of Tables</b></p><dl><dt>7.1. <a href="#d4e1258">Property name changes</a></dt></dl></div><div class="list-of-examples"><p><b>List of Examples</b></p><dl><dt>2.1. <a href="#d4e109">Simple hello world root resource class</a></dt><dt>2.2. <a href="#d4e128">Specifying URI path parameter</a></dt><dt>2.3. <a href="#d4e148">PUT method</a></dt><dt>2.4. <a href="#d4e159">Specifying output MIME type</a></dt><dt>2.5. <a href="#d4e178">Using multiple output MIME types</a></dt><dt>2.6. <a href="#d4e189">Specifying input MIME type</a></dt><dt>2.7. <a href="#d4e201">Deployment agnostic application model</a></dt><dt>2.8. <a href="#d4e206">Reusing Jersey implementation in your custom application model</a></dt><dt>2.9. <a href="#d4e214">Deployment of a JAX-RS application using <code class="literal">@ApplicationPath</code> with Servlet 3.0</a></dt><dt>2.10. <a href="#d4e221">Configuration of maven-war-plugin in <code class="literal">pom.xml</code> with Servlet 3.0</a></dt><dt>2.11. <a href="#d4e231">Deployment of a JAX-RS application using <code class="literal">web.xml</code> with Servlet 3.0</a></dt><dt>2.12. <a href="#d4e241">Deployment of your application using Jersey specific servlet</a></dt><dt>2.13. <a href="#d4e246">Using Jersey specific servlet without an application model instance</a></dt><dt>2.14. <a href="#d4e262">Query parameters</a></dt><dt>2.15. <a href="#d4e268">Custom Java type for consuming request parameters</a></dt><dt>2.16. <a href="#d4e313">Processing POSTed HTML form</a></dt><dt>2.17. <a href="#d4e318">Obtaining general map of URI path and/or query parameters</a></dt><dt>2.18. <a href="#d4e323">Obtaining general map of header parameters</a></dt><dt>2.19. <a href="#d4e329">Obtaining general map of form parameters</a></dt><dt>2.20. <a href="#d4e350">Using <code class="code">File</code> with a specific MIME type to produce a response</a></dt><dt>2.21. <a href="#d4e360">The most acceptable MIME type is used when multiple output MIME types allowed</a></dt><dt>2.22. <a href="#d4e372">Returning 201 status code and adding <code class="literal">Location</code> header in response to POST request</a></dt><dt>2.23. <a href="#d4e378">Adding an entity body to a custom response</a></dt><dt>2.24. <a href="#d4e391">Sub-resource methods</a></dt><dt>2.25. <a href="#d4e404">Sub-resource locators</a></dt><dt>2.26. <a href="#d4e426">URI building</a></dt><dt>2.27. <a href="#d4e440">Building URIs using query parameters</a></dt><dt>2.28. <a href="#d4e449">Throwing Jersey specific exceptions to control response</a></dt><dt>2.29. <a href="#d4e455">Jersey specific exception implementation</a></dt><dt>2.30. <a href="#d4e464">Mapping generic exceptions to responses</a></dt><dt>2.31. <a href="#d4e480">Conditional GET support</a></dt><dt>2.32. <a href="#d4e508">Accessing <code class="code">SecurityContext</code></a></dt><dt>2.33. <a href="#d4e517">Injection</a></dt><dt>3.1. <a href="#d4e605">POST request with form parameters</a></dt><dt>4.1. <a href="#d4e821">Low level XML test - methods added to HelloWorldResource.java</a></dt><dt>4.2. <a href="#d4e834">Planet class</a></dt><dt>4.3. <a href="#d4e837">Resource class</a></dt><dt>4.4. <a href="#d4e850">Method for consuming Planet</a></dt><dt>4.5. <a href="#d4e863">Resource class - JAXBElement</a></dt><dt>4.6. <a href="#d4e870">Client side - JAXBElement</a></dt><dt>4.7. <a href="#d4e878">PlanetJAXBContextProvider</a></dt><dt>4.8. <a href="#d4e884">Using Provider with Jersey client</a></dt><dt>5.1. <a href="#d4e910">POJO JSON support web.xml configuration</a></dt><dt>5.2. <a href="#d4e914">POJO JSON support client configuration</a></dt><dt>5.3. <a href="#d4e926">Simple JAXB bean implementation</a></dt><dt>5.4. <a href="#d4e929">JAXB bean used to generate JSON representation</a></dt><dt>5.5. <a href="#d4e940">Tweaking JSON format using JAXB</a></dt><dt>5.6. <a href="#json.jaxb.context.resolver.example">An example of a JAXBContext resolver implementation</a></dt><dt>5.7. <a href="#d4e970">JAXB beans for JSON supported notations description, simple address bean</a></dt><dt>5.8. <a href="#d4e973">JAXB beans for JSON supported notations description, contact bean</a></dt><dt>5.9. <a href="#json.jaxb.bean.init.example">JAXB beans for JSON supported notations description, initialization</a></dt><dt>5.10. <a href="#d4e995">JSON expression produced using <code class="literal">mapped</code> notation</a></dt><dt>5.11. <a href="#d4e1008">Force arrays in <code class="literal">mapped</code> JSON notation</a></dt><dt>5.12. <a href="#d4e1019">Force non-string values in <code class="literal">mapped</code> JSON notation</a></dt><dt>5.13. <a href="#d4e1032">XML attributes as XML elements in <code class="literal">mapped</code> JSON notation</a></dt><dt>5.14. <a href="#json.jaxb.mapped.root.unwrapping">Keep XML root tag equivalent in JSON <code class="literal">mapped</code> JSON notation</a></dt><dt>5.15. <a href="#d4e1044">XML root tag equivalent kept in JSON using <code class="literal">mapped</code> notation</a></dt><dt>5.16. <a href="#d4e1054">XML namespace to JSON mapping configuration for <code class="literal">mapped</code> notation</a></dt><dt>5.17. <a href="#d4e1075">JSON expression produced using <code class="literal">natural</code> notation</a></dt><dt>5.18. <a href="#json.jaxb.natural.root.unwrapping">Keep XML root tag equivalent in JSON <code class="literal">natural</code> JSON notation</a></dt><dt>5.19. <a href="#d4e1098">JSON expression produced using Jettison based <code class="literal">mapped</code> notation</a></dt><dt>5.20. <a href="#json.jaxb.jettison.mapped.ns.def">XML namespace to JSON mapping configuration for Jettison based <code class="literal">mapped</code> notation</a></dt><dt>5.21. <a href="#d4e1110">JSON expression with XML namespaces mapped into JSON</a></dt><dt>5.22. <a href="#d4e1123">JSON expression produced using <code class="literal">badgerfish</code> notation</a></dt><dt>5.23. <a href="#d4e1138">JAXB bean creation</a></dt><dt>5.24. <a href="#d4e1143">Constructing a JSONObject</a></dt></dl></div>
    
    <div class="preface" title="Preface"><div class="titlepage"><div><div><h2 class="title"><a name="preface"></a>Preface</h2></div></div></div>
        
        <p>
The user guide is not complete (see the JavaDoc API for all details) and will
be added to on a continual basis. If you want to contribute to the guide please
email <a class="ulink" href="mailto:users@jersey.java.net" target="_top">users@jersey.java.net</a>.
        </p>
    </div>
  
  <div class="chapter" title="Chapter&nbsp;1.&nbsp;Getting Started"><div class="titlepage"><div><div><h2 class="title"><a name="getting-started"></a>Chapter&nbsp;1.&nbsp;Getting Started</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d4e55">1.1. Creating a root resource</a></span></dt><dt><span class="section"><a href="#d4e62">1.2. Deploying the root resource</a></span></dt><dt><span class="section"><a href="#d4e76">1.3. Testing the root resource</a></span></dt><dt><span class="section"><a href="#getting.started.created">1.4. Here's one Paul created earlier</a></span></dt></dl></div>
  

  <p>This chapter will present how to get started with Jersey using
the embedded Grizzly server. The last section of this chapter
presents a reference to equivalent functionality for getting started
with a Web application.</p>
<p>First, it is necessary to depend on the correct Jersey artifacts
as described in <a class="xref" href="#chapter_deps" title="Chapter&nbsp;11.&nbsp;Dependencies">Chapter&nbsp;11, <i>Dependencies</i></a>
</p>
<p>Maven developers require a dependency on

</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-server&amp;v=1.9&amp;e=pom" target="_top">jersey-server</a> module, </li><li class="listitem">the <a class="ulink" href="http://download.java.net/maven/2/com/sun/grizzly/grizzly-servlet-webserver/1.9.18-i/grizzly-servlet-webserver-1.9.18-i.pom" target="_top">grizzly-servlet-webserver</a> module </li><li class="listitem">and optionally for WADL support if using Java SE 5 the <a class="ulink" href="http://download.java.net/maven/1/com.sun.xml.bind/poms/jaxb-impl-2.1.12.pom" target="_top">jaxb-impl</a> module</li></ul></div><p>
 </p>
 <p>
   The following dependencies need to be added to the pom:
</p><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
    &lt;artifactId&gt;jersey-server&lt;/artifactId&gt;
    &lt;version&gt;1.9&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.sun.grizzly&lt;/groupId&gt;
    &lt;artifactId&gt;grizzly-servlet-webserver&lt;/artifactId&gt;
    &lt;version&gt;1.9.18-i&lt;/version&gt;
&lt;/dependency&gt;</pre>
<p>
And the following repositories need to be added to the pom:
</p><pre class="programlisting">&lt;repository&gt;
    &lt;id&gt;maven2-repository.java.net&lt;/id&gt;
    &lt;name&gt;Java.net Repository for Maven&lt;/name&gt;
    &lt;url&gt;http://download.java.net/maven/2/&lt;/url&gt;
    &lt;layout&gt;default&lt;/layout&gt;
&lt;/repository&gt;
&lt;repository&gt;
    &lt;id&gt;maven-repository.java.net&lt;/id&gt;
    &lt;name&gt;Java.net Maven 1 Repository (legacy)&lt;/name&gt;
    &lt;url&gt;http://download.java.net/maven/1&lt;/url&gt;
    &lt;layout&gt;legacy&lt;/layout&gt;
&lt;/repository&gt;</pre>

    <p>If you want to depend on Jersey snapshot versions the following repository needs to be added to the pom:
    </p><pre class="programlisting">&lt;repository&gt;
    &lt;id&gt;snapshot-repository.java.net&lt;/id&gt;
    &lt;name&gt;Java.net Snapshot Repository for Maven&lt;/name&gt;
    &lt;url&gt;https://maven.java.net/content/repositories/snapshots/&lt;/url&gt;
    &lt;layout&gt;default&lt;/layout&gt;
&lt;/repository&gt;</pre> 

<p>
Non-maven developers require:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="ulink" href="http://download.java.net/maven/2/com/sun/grizzly/grizzly-servlet-webserver/1.9.18-i/grizzly-servlet-webserver-1.9.18-i.jar" target="_top">grizzly-servlet-webserver.jar</a>,</li><li class="listitem"><a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-server&amp;v=1.9&amp;e=jar" target="_top">jersey-server.jar</a>,</li><li class="listitem"><a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-core&amp;v=1.9&amp;e=jar" target="_top">jersey-core.jar</a>,</li><li class="listitem"><a class="ulink" href="http://download.java.net/maven/2/javax/ws/rs/jsr311-api/1.1/jsr311-api-1.1.jar" target="_top">jsr311-api.jar</a>,</li><li class="listitem"><a class="ulink" href="http://repo1.maven.org/maven2/asm/asm/3.1/asm-3.1.jar" target="_top">asm.jar</a></li></ul></div>
<p>and optionally for WADL support if using Java SE 5:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="ulink" href="http://download.java.net/maven/1/com.sun.xml.bind/jars/jaxb-impl-2.1.12.jar" target="_top">jaxb-impl.jar</a>,</li><li class="listitem"><a class="ulink" href="http://download.java.net/maven/1/javax.xml.bind/jars/jaxb-api-2.1.jar" target="_top">jaxb-api.jar</a>,</li><li class="listitem"><a class="ulink" href="http://download.java.net/maven/1/javax.activation/jars/activation-1.1.jar" target="_top">activation.jar</a>,</li><li class="listitem"><a class="ulink" href="http://download.java.net/maven/1/javax.xml.stream/jars/stax-api-1.0-2.jar" target="_top">stax-api.jar</a></li></ul></div><p>
</p>
<p>For Ant
developers the <a class="ulink" href="http://maven.apache.org/ant-tasks.html" target="_top">Ant
Tasks for Maven</a> may be used to add the following to the ant
document such that the dependencies do not need to be downloaded
explicitly:</p>
<pre class="programlisting">&lt;artifact:dependencies pathId="dependency.classpath"&gt;
  &lt;dependency groupId="com.sun.jersey"
              artifactId="jersey-server"
              version="1.9"/&gt;
  &lt;dependency groupId="com.sun.grizzly"
              artifactId="grizzly-servlet-webserver"
              version="1.8.6.4"/&gt;
  &lt;artifact:remoteRepository id="maven-repository.java.net"
                             url="http://maven.java.net/" /&gt;
  &lt;artifact:remoteRepository id="maven1-repository.java.net"
                             url="http://download.java.net/maven/1"
                             layout="legacy" /&gt;
&lt;/artifact:dependencies&gt;</pre>

<p>
The path id &#8220;dependency.classpath&#8221; may then be referenced as the
classpath to be used for compiling or executing.</p>
<p>Second, create a new project (using your favourite IDE or just
ant/maven) and add the dependences. (For those who want to skip the
creation of their own project take a look at <a class="xref" href="#getting.started.created" title="1.4.&nbsp;Here's one Paul created earlier">Section&nbsp;1.4, &#8220;Here's one Paul created earlier&#8221;</a>
</p>

<div class="section" title="1.1.&nbsp;Creating a root resource"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e55"></a>1.1.&nbsp;Creating a root resource</h2></div></div></div>

<p>Create the following Java class in your project:</p>
<pre class="programlisting">&nbsp;&nbsp;1     // The Java class will be hosted at the URI path "/helloworld"
&nbsp;&nbsp;2     @Path("/helloworld")
&nbsp;&nbsp;3     public class HelloWorldResource {
&nbsp;&nbsp;4     
&nbsp;&nbsp;5         // The Java method will process HTTP GET requests
&nbsp;&nbsp;6         @GET 
&nbsp;&nbsp;7         // The Java method will produce content identified by the MIME Media
&nbsp;&nbsp;8         // type "text/plain"
&nbsp;&nbsp;9         @Produces("text/plain")
&nbsp;10         public String getClichedMessage() {
&nbsp;11             // Return some cliched textual content
&nbsp;12             return "Hello World";
&nbsp;13         }
&nbsp;14     }</pre><p>
The <code class="literal">HelloWorldResource</code> class is a very simple Web
resource. The URI path of the resource is "/helloworld"
(line 2), it supports the HTTP GET method (line 6) and produces
cliched textual content (line 12) of the MIME media type "text/plain"
(line 9).</p>
<p>Notice the use of Java annotations to declare the URI path, the
HTTP method and the media type. This is a key feature of JSR 311.</p>
</div>

<div class="section" title="1.2.&nbsp;Deploying the root resource"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e62"></a>1.2.&nbsp;Deploying the root resource</h2></div></div></div>

<p>The root resource will be deployed using the Grizzly Web
container.</p>
<p>Create the following Java class in your project:</p>
<pre class="programlisting">&nbsp;&nbsp;1 public class Main {
&nbsp;&nbsp;2           
&nbsp;&nbsp;3      public static void main(String[] args) throws IOException {
&nbsp;&nbsp;4              
&nbsp;&nbsp;5          final String baseUri = "http://localhost:9998/";
&nbsp;&nbsp;6          final Map&lt;String, String&gt; initParams = 
&nbsp;&nbsp;7 	                       new HashMap&lt;String, String&gt;();
&nbsp;&nbsp;8  
&nbsp;&nbsp;9          initParams.put("com.sun.jersey.config.property.packages", 
&nbsp;10                  "com.sun.jersey.samples.helloworld.resources");
&nbsp;11 
&nbsp;12         System.out.println("Starting grizzly...");
&nbsp;13         SelectorThread threadSelector = 
&nbsp;14 	          GrizzlyWebContainerFactory.create(baseUri, initParams);
&nbsp;15         System.out.println(String.format(
&nbsp;16           "Jersey app started with WADL available at %sapplication.wadl\n&#8221; + 
&nbsp;17           &#8220;Try out %shelloworld\nHit enter to stop it...", baseUri, baseUri));
&nbsp;18         System.in.read();
&nbsp;19         threadSelector.stopEndpoint();
&nbsp;20         System.exit(0);
&nbsp;21     }    
&nbsp;22 }</pre><p>
The <code class="literal">Main</code> class deploys the <code class="literal">HelloWorldResource</code>
using the Grizzly Web container.</p>
<p>Lines 9 to 10 creates an initialization parameter that informs the
Jersey runtime where to search for root resource classes to be
deployed. In this case it assumes the root resource class in the
package <code class="literal">com.sun.jersey.samples.helloworld.resources</code>
(or in a sub-package of).</p>
<p>Lines 13 to 14 deploys the root resource to the base URI
"<a class="ulink" href="http://localhost:9998/" target="_top">http://localhost:9998/</a>"
and returns a Grizzly SelectorThread. The complete URI of the Hello
World root resource is "<a class="ulink" href="http://localhost:9998/helloworld" target="_top">http://localhost:9998/helloworld</a>".</p>
<p>Notice that no deployment descriptors were needed and the root
resource was setup in a few statements of Java code.</p>
</div>

<div class="section" title="1.3.&nbsp;Testing the root resource"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e76"></a>1.3.&nbsp;Testing the root resource</h2></div></div></div>

<p>Goto the URI <a class="ulink" href="http://localhost:9998/helloworld" target="_top">http://localhost:9998/helloworld</a>
in your favourite browser.</p>
<p>Or, from the command line use <code class="literal">curl</code>:
</p><pre class="programlisting">&gt; curl http://localhost:9998/helloworld</pre><p>
</p>
</div>

<div class="section" title="1.4.&nbsp;Here's one Paul created earlier"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="getting.started.created"></a>1.4.&nbsp;Here's one Paul created earlier</h2></div></div></div>

<p>The example code presented above is shipped as the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.samples&amp;a=helloworld&amp;v=1.9&amp;c=project&amp;e=zip" target="_top">HelloWorld</a>
sample in the Java.Net maven repository.</p>
<p>For developers wishing to get started by deploying a Web
application an equivalent sample, as a Web application, is shipped as
the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.samples&amp;a=helloworld-webapp&amp;v=1.9&amp;c=project&amp;e=zip" target="_top">HelloWorld-WebApp</a>
sample.</p>
</div>

</div>
  <div class="chapter" title="Chapter&nbsp;2.&nbsp;Overview of JAX-RS 1.1"><div class="titlepage"><div><div><h2 class="title"><a name="jax-rs"></a>Chapter&nbsp;2.&nbsp;Overview of JAX-RS 1.1</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d4e96">2.1. Root Resource Classes</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e112">2.1.1. @Path</a></span></dt><dt><span class="section"><a href="#d4e137">2.1.2. HTTP Methods</a></span></dt><dt><span class="section"><a href="#d4e152">2.1.3. @Produces</a></span></dt><dt><span class="section"><a href="#d4e184">2.1.4. @Consumes</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e196">2.2. Deploying a RESTful Web Service</a></span></dt><dt><span class="section"><a href="#d4e255">2.3. Extracting Request Parameters</a></span></dt><dt><span class="section"><a href="#d4e332">2.4. Representations and Java Types</a></span></dt><dt><span class="section"><a href="#d4e365">2.5. Building Responses</a></span></dt><dt><span class="section"><a href="#d4e382">2.6. Sub-resources</a></span></dt><dt><span class="section"><a href="#d4e413">2.7. Building URIs</a></span></dt><dt><span class="section"><a href="#d4e443">2.8. WebApplicationException and Mapping Exceptions to Responses</a></span></dt><dt><span class="section"><a href="#d4e473">2.9. Conditional GETs and Returning 304 (Not Modified) Responses</a></span></dt><dt><span class="section"><a href="#d4e491">2.10. Life-cycle of Root Resource Classes</a></span></dt><dt><span class="section"><a href="#d4e499">2.11. Security</a></span></dt><dt><span class="section"><a href="#d4e512">2.12. Rules of Injection</a></span></dt><dt><span class="section"><a href="#d4e524">2.13. Use of @Context</a></span></dt><dt><span class="section"><a href="#d4e536">2.14. Annotations Defined By JAX-RS</a></span></dt></dl></div>
  

  <p>This chapter presents an overview of the JAX-RS 1.1 features.</p>

  <p>The JAX-RS 1.1 API may be found online <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/index.html" target="_top">here</a>.</p>

  <p>The JAX-RS 1.1 specification draft may be found online <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/spec/spec.html" target="_top">here</a>.</p>

  <div class="section" title="2.1.&nbsp;Root Resource Classes"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e96"></a>2.1.&nbsp;Root Resource Classes</h2></div></div></div>
    

    <p><span class="emphasis"><em>Root resource classes</em></span> are POJOs (Plain Old Java Objects) that are annotated with <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Path.html" target="_top">@Path</a>
    have at least one method annotated with <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Path.html" target="_top">@Path</a> or a resource method designator annotation such as <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/GET.html" target="_top">@GET</a>,
    <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/PUT.html" target="_top">@PUT</a>, <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/POST.html" target="_top">@POST</a>, <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/DELETE.html" target="_top">@DELETE</a>. Resource methods are methods of a resource class annotated with a resource
    method designator. This section shows how to use Jersey to annotate Java objects to create RESTful web services.</p>

    <p>The following code example is a very simple example of a root
    resource class using JAX-RS annotations. The example code shown here is
    from one of the samples that ships with Jersey, the zip file of which can
    be found in the maven repository <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.samples&amp;a=helloworld&amp;v=1.9&amp;c=project&amp;e=zip" target="_top">here</a>.</p>
    <div class="example"><a name="d4e109"></a><p class="title"><b>Example&nbsp;2.1.&nbsp;Simple hello world root resource class</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 package com.sun.ws.rest.samples.helloworld.resources;
&nbsp;&nbsp;2 
&nbsp;&nbsp;3 import javax.ws.rs.GET;
&nbsp;&nbsp;4 import javax.ws.rs.Produces;
&nbsp;&nbsp;5 import javax.ws.rs.Path;
&nbsp;&nbsp;6 
&nbsp;&nbsp;7 // The Java class will be hosted at the URI path "/helloworld"
&nbsp;&nbsp;8 @Path("/helloworld")
&nbsp;&nbsp;9 public class HelloWorldResource {
&nbsp;10 
&nbsp;11     // The Java method will process HTTP GET requests
&nbsp;12     @GET
&nbsp;13     // The Java method will produce content identified by the MIME Media
&nbsp;14     // type "text/plain"
&nbsp;15     @Produces("text/plain")
&nbsp;16     public String getClichedMessage() {
&nbsp;17         // Return some cliched textual content
&nbsp;18         return "Hello World";
&nbsp;19     }
&nbsp;20 }</pre></div></div><p><br class="example-break">Let's look at some of the JAX-RS annotations used in this
    example.</p>

    <div class="section" title="2.1.1.&nbsp;@Path"><div class="titlepage"><div><div><h3 class="title"><a name="d4e112"></a>2.1.1.&nbsp;@Path</h3></div></div></div>
      

      <p>The <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Path.html" target="_top">@Path</a> annotation's value is a relative URI path. In the example above, the Java class will be hosted
      at the URI path <code class="literal">/helloworld</code>. This is an extremely simple use of the <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Path.html" target="_top">@Path</a> annotation.
      What makes JAX-RS so useful is that you can embed variables in the URIs.</p>

      <p><span class="emphasis"><em>URI path templates</em></span> are URIs with variables embedded within the URI syntax. These variables
      are substituted at runtime in order for a resource to respond to a request based on the substituted URI. Variables are
      denoted by curly braces. For example, look at the following <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Path.html" target="_top">@Path</a> annotation:</p>

      <pre class="programlisting">@Path("/users/{username}")</pre><p>In this
      type of example, a user will be prompted to enter their name, and then a
      Jersey web service configured to respond to requests to this URI path
      template will respond. For example, if the user entered their username
      as "Galileo", the web service will respond to the following URL:</p>

      <p><code class="literal">http://example.com/users/Galileo</code></p>

      <p>To obtain the value of the username variable the <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/PathParam.html" target="_top">@PathParam</a> may be used on method parameter of a request method,
      for example:</p>

      <div class="example"><a name="d4e128"></a><p class="title"><b>Example&nbsp;2.2.&nbsp;Specifying URI path parameter</b></p><div class="example-contents">
      
<pre class="programlisting">&nbsp;&nbsp;1 @Path("/users/{username}")
&nbsp;&nbsp;2 public class UserResource {
&nbsp;&nbsp;3 
&nbsp;&nbsp;4     @GET
&nbsp;&nbsp;5     @Produces("text/xml")
&nbsp;&nbsp;6     public String getUser(@PathParam("username") String userName) {
&nbsp;&nbsp;7         ...
&nbsp;&nbsp;8     }
&nbsp;&nbsp;9 }</pre></div></div><p><br class="example-break">If it is required that a user name must only consist of
      lower and upper case numeric characters then it is possible to declare a
      particular regular expression, which overrides the default regular
      expression, "[^/]+?", for example:</p>

      <pre class="programlisting">@Path("users/{username: [a-zA-Z][a-zA-Z_0-9]*}")</pre><p>In
      this type of example the username variable will only match user names
      that begin with one upper or lower case letter and zero or more alpha
      numeric characters and the underscore character. If a user name does not
      match that a 404 (Not Found) response will occur. </p>

      <p>A <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Path.html" target="_top">@Path</a> value may or may not begin with a '/', it makes no difference. Likewise, by default, a <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Path.html" target="_top">@Path</a>
      value may or may not end in a '/', it makes no difference, and thus request URLs that end or do not end in a '/' will both
      be matched.
      However, Jersey has a redirection mechanism, which if enabled, automatically performs redirection to a request URL ending
      in a '/' if a request URL does not end in a '/' and the matching <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Path.html" target="_top">@Path</a> does end in a '/'.</p>
    </div>

    <div class="section" title="2.1.2.&nbsp;HTTP Methods"><div class="titlepage"><div><div><h3 class="title"><a name="d4e137"></a>2.1.2.&nbsp;HTTP Methods</h3></div></div></div>
      

      <p><a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/GET.html" target="_top">@GET</a>, <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/PUT.html" target="_top">@PUT</a>, <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/POST.html" target="_top">@POST</a>, <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/DELETE.html" target="_top">@DELETE</a> and <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/HEAD.html" target="_top">@HEAD</a>
      are <span class="emphasis"><em>resource method designator</em></span> annotations defined
      by JAX-RS and which correspond to the similarly named HTTP methods. In
      the example above, the annotated Java method will process HTTP GET
      requests. The behavior of a resource is determined by which of the HTTP
      methods the resource is responding to.</p>

      <p>The following example is an extract from the storage service
      sample that shows the use of the PUT method to create or update a
      storage container:</p>

      <div class="example"><a name="d4e148"></a><p class="title"><b>Example&nbsp;2.3.&nbsp;PUT method</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @PUT
&nbsp;&nbsp;2 public Response putContainer() {
&nbsp;&nbsp;3     System.out.println("PUT CONTAINER " + container);
&nbsp;&nbsp;4 
&nbsp;&nbsp;5     URI uri =  uriInfo.getAbsolutePath();
&nbsp;&nbsp;6     Container c = new Container(container, uri.toString());
&nbsp;&nbsp;7 
&nbsp;&nbsp;8     Response r;
&nbsp;&nbsp;9     if (!MemoryStore.MS.hasContainer(c)) {
&nbsp;10         r = Response.created(uri).build();
&nbsp;11     } else {
&nbsp;12         r = Response.noContent().build();
&nbsp;13     }
&nbsp;14 
&nbsp;15     MemoryStore.MS.createContainer(c);
&nbsp;16     return r;
&nbsp;17 }</pre></div></div><p><br class="example-break">By default the JAX-RS runtime will automatically support the
      methods HEAD and OPTIONS, if not explicitly implemented. For HEAD the
      runtime will invoke the implemented GET method (if present) and ignore
      the response entity (if set). For OPTIONS the Allow response header
      will be set to the set of HTTP methods support by the resource. In
      addition Jersey will return a <a class="ulink" href="http://wadl.java.net/" target="_top">WADL</a> document describing the
      resource.</p>
    </div>

    <div class="section" title="2.1.3.&nbsp;@Produces"><div class="titlepage"><div><div><h3 class="title"><a name="d4e152"></a>2.1.3.&nbsp;@Produces</h3></div></div></div>
      

      <p>The <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Produces.html" target="_top">@Produces</a> annotation is used to specify the MIME media types of representations a resource can
      produce and send back to the client. In this example, the Java method will produce representations identified by
      the MIME media type "text/plain".</p>

      <p><a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Produces.html" target="_top">@Produces</a> can be applied at both the class and method levels. Here's an example:</p>

      <div class="example"><a name="d4e159"></a><p class="title"><b>Example&nbsp;2.4.&nbsp;Specifying output MIME type</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @Path("/myResource")
&nbsp;&nbsp;2 @Produces("text/plain")
&nbsp;&nbsp;3 public class SomeResource {
&nbsp;&nbsp;4     @GET
&nbsp;&nbsp;5     public String doGetAsPlainText() {
&nbsp;&nbsp;6         ...
&nbsp;&nbsp;7     }
&nbsp;&nbsp;8 
&nbsp;&nbsp;9     @GET
&nbsp;10     @Produces("text/html")
&nbsp;11     public String doGetAsHtml() {
&nbsp;12         ...
&nbsp;13     }
&nbsp;14 }</pre></div></div><p><br class="example-break">The <code class="literal">doGetAsPlainText</code> method defaults to the MIME type of the <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Produces.html" target="_top">@Produces</a>
      annotation at the class level. The <code class="literal">doGetAsHtml</code> method's <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Produces.html" target="_top">@Produces</a>
      annotation overrides the class-level <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Produces.html" target="_top">@Produces</a> setting, and specifies that the method can produce HTML rather than
      plain text. </p>

      <p>If a resource class is capable of producing more that one MIME
      media type then the resource method chosen will correspond to the most
      acceptable media type as declared by the client. More specifically the
      Accept header of the HTTP request declared what is most acceptable. For
      example if the Accept header is:</p>

      <pre class="programlisting">Accept: text/plain</pre><p>then the
      <code class="literal">doGetAsPlainText</code> method will be invoked.
      Alternatively if the Accept header is: </p>

      <pre class="programlisting">Accept: text/plain;q=0.9, text/html</pre>

      <p>which declares that the client can accept media types of
      "text/plain" and "text/html" but prefers the latter, then the
      <code class="literal">doGetAsHtml</code> method will be invoked. </p>

      <p>More than one media type may be declared in the same <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Produces.html" target="_top">@Produces</a> declaration, for example:</p>

      <div class="example"><a name="d4e178"></a><p class="title"><b>Example&nbsp;2.5.&nbsp;Using multiple output MIME types</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @GET
&nbsp;&nbsp;2 @Produces({"application/xml", "application/json"})
&nbsp;&nbsp;3 public String doGetAsXmlOrJson() {
&nbsp;&nbsp;4     ...
&nbsp;&nbsp;5 }</pre></div></div><p><br class="example-break">The <code class="literal">doGetAsXmlOrJson</code> method will get
      invoked if either of the media types "application/xml" and
      "application/json" are acceptable. If both are equally acceptable then
      the former will be chosen because it occurs first. </p>

      <p>The examples above refer explicitly to MIME media types for
      clarity. It is possible to refer to constant values, which may reduce
      typographical errors, see the constant field values of <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/MediaType.html" target="_top">MediaType</a>.</p>
    </div>

    <div class="section" title="2.1.4.&nbsp;@Consumes"><div class="titlepage"><div><div><h3 class="title"><a name="d4e184"></a>2.1.4.&nbsp;@Consumes</h3></div></div></div>
      

      <p>The <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Consumes.html" target="_top">@Consumes</a> annotation is used to specify the MIME media types of representations a
      resource can consume that were sent by the client. The above example can be modified to set the cliched
      message as follows:</p>

      <div class="example"><a name="d4e189"></a><p class="title"><b>Example&nbsp;2.6.&nbsp;Specifying input MIME type</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @POST
&nbsp;&nbsp;2 @Consumes("text/plain")
&nbsp;&nbsp;3 public void postClichedMessage(String message) {
&nbsp;&nbsp;4     // Store the message
&nbsp;&nbsp;5 }</pre></div></div><p><br class="example-break"></p>

      <p>In this example, the Java method will consume representations
      identified by the MIME media type "text/plain". Notice that the resource
      method returns void. This means no representation is returned and
      response with a status code of 204 (No Content) will be returned.</p>

      <p><a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Consumes.html" target="_top">@Consumes</a> can be applied at both the class and method levels and more than one
      media type may be declared in the same <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Consumes.html" target="_top">@Consumes</a> declaration.</p>
    </div>
  </div>

  <div class="section" title="2.2.&nbsp;Deploying a RESTful Web Service"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e196"></a>2.2.&nbsp;Deploying a RESTful Web Service</h2></div></div></div>
    

    <p>JAX-RS provides a deployment agnostic abstract class <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/Application.html" target="_top">Application</a>
    for declaring root resource and provider classes, and root resource and provider singleton instances.
    A Web service may extend this class to declare root resource and provider classes. For
    example,</p>

    <div class="example"><a name="d4e201"></a><p class="title"><b>Example&nbsp;2.7.&nbsp;Deployment agnostic application model</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 public class MyApplication extends Application {
&nbsp;&nbsp;2     public Set&lt;Class&lt;?&gt;&gt; getClasses() {
&nbsp;&nbsp;3         Set&lt;Class&lt;?&gt;&gt; s = new HashSet&lt;Class&lt;?&gt;&gt;();
&nbsp;&nbsp;4         s.add(HelloWorldResource.class);
&nbsp;&nbsp;5         return s;
&nbsp;&nbsp;6     }
&nbsp;&nbsp;7 }</pre></div></div><p><br class="example-break">Alternatively it is possible to reuse one of Jersey's
    implementations that scans for root resource and provider classes given a classpath or
    a set of package names. Such classes are automatically added to the set of
    classes that are returned by <code class="literal">getClasses</code>. For example,
    the following scans for root resource and provider classes in packages "org.foo.rest",
    "org.bar.rest" and in any sub-packages of those two:</p>

    <div class="example"><a name="d4e206"></a><p class="title"><b>Example&nbsp;2.8.&nbsp;Reusing Jersey implementation in your custom application model</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 public class MyApplication extends PackagesResourceConfig {
&nbsp;&nbsp;2     public MyApplication() {
&nbsp;&nbsp;3         super("org.foo.rest;org.bar.rest");
&nbsp;&nbsp;4     }
&nbsp;&nbsp;5 }</pre></div></div><p><br class="example-break"></p>
    <p>There are multiple deployment options for the class that implements <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/Application.html" target="_top">Application</a>
    interface in the Servlet 3.0 container. For simple deployments, no <code class="literal">web.xml</code> 
    is needed at all. Instead, an <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/ApplicationPath.html" target="_top">@ApplicationPath</a> annotation can be used to annotate the
    user defined application class and specify the the base resource URI of all application resources:</p>
    <div class="example"><a name="d4e214"></a><p class="title"><b>Example&nbsp;2.9.&nbsp;Deployment of a JAX-RS application using <code class="literal">@ApplicationPath</code> with Servlet 3.0</b></p><div class="example-contents">
        
        <pre class="programlisting">&nbsp;&nbsp;1 @ApplicationPath("resources")
&nbsp;&nbsp;2 public class MyApplication extends PackagesResourceConfig {
&nbsp;&nbsp;3     public MyApplication() {
&nbsp;&nbsp;4         super("org.foo.rest;org.bar.rest");
&nbsp;&nbsp;5     }    
&nbsp;&nbsp;6     ...
&nbsp;&nbsp;7 }</pre>
    </div></div><p><br class="example-break"></p>      
    <p>You also need to set maven-war-plugin attribute <a class="ulink" href="http://maven.apache.org/plugins/maven-war-plugin/war-mojo.html#failOnMissingWebXml" target="_top">failOnMissingWebXml</a> to false in pom.xml when building .war without web.xml file using maven:</p>
    <div class="example"><a name="d4e221"></a><p class="title"><b>Example&nbsp;2.10.&nbsp;Configuration of maven-war-plugin in <code class="literal">pom.xml</code> with Servlet 3.0</b></p><div class="example-contents">
        
        <pre class="programlisting">&nbsp;&nbsp;1 &lt;plugins&gt;
&nbsp;&nbsp;2  ...
&nbsp;&nbsp;3  &lt;plugin&gt;
&nbsp;&nbsp;4    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
&nbsp;&nbsp;5    &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
&nbsp;&nbsp;6    &lt;version&gt;2.1.1&lt;/version&gt;    
&nbsp;&nbsp;7    &lt;configuration&gt;
&nbsp;&nbsp;8        &lt;failOnMissingWebXml&gt;false&lt;/failOnMissingWebXml&gt;        
&nbsp;&nbsp;9    &lt;/configuration&gt;
&nbsp;10    &lt;/plugin&gt;
&nbsp;11  ...
&nbsp;12  &lt;/plugins&gt;</pre>
    </div></div><p><br class="example-break"></p>    
    <p>Another deployment option is to declare JAX-RS application details in the <code class="literal">web.xml</code>.
    This is usually suitable in case of more complex deployments, e.g. when security model needs to be properly defined 
    or when additional initialization parameters have to be passed to Jersey runtime.
    JAX-RS 1.1 specifies that a fully qualified name of the class that
    implements <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/Application.html" target="_top">Application</a>
    may be declared in the <code class="literal">&lt;servlet-name&gt;</code> element of the JAX-RS application's
    <code class="literal">web.xml</code>. This is supported in a Web container implementing Servlet 3.0 as follows:</p>
    <div class="example"><a name="d4e231"></a><p class="title"><b>Example&nbsp;2.11.&nbsp;Deployment of a JAX-RS application using <code class="literal">web.xml</code> with Servlet 3.0</b></p><div class="example-contents">
        
        <pre class="programlisting">&nbsp;&nbsp;1 &lt;web-app&gt;
&nbsp;&nbsp;2     &lt;servlet&gt;
&nbsp;&nbsp;3         &lt;servlet-name&gt;org.foo.rest.MyApplication&lt;/servlet-name&gt;
&nbsp;&nbsp;4     &lt;/servlet&gt;
&nbsp;&nbsp;5     ...
&nbsp;&nbsp;6     &lt;servlet-mapping&gt;
&nbsp;&nbsp;7         &lt;servlet-name&gt;org.foo.rest.MyApplication&lt;/servlet-name&gt;
&nbsp;&nbsp;8         &lt;url-pattern&gt;/resources&lt;/url-pattern&gt;
&nbsp;&nbsp;9     &lt;/servlet-mapping&gt;
&nbsp;10     ...
&nbsp;11 &lt;/web-app&gt;</pre>
    </div></div><p><br class="example-break"></p>    
    <p>Note that the <code class="literal">&lt;servlet-class&gt;</code> element is omitted from the servlet declaration. 
    This is a correct declaration utilizing the Servlet 3.0 extension mechanism. Also note that 
    <code class="literal">&lt;servlet-mapping&gt;</code> is used to define the base resource URI.</p>    
    <p>When running in a Servlet 2.x then instead it is necessary to declare the Jersey
    specific servlet and pass the <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/Application.html" target="_top">Application</a> implementation class name as
    one of the servlet's <code class="literal">init-param</code> entries:
    </p><div class="example"><a name="d4e241"></a><p class="title"><b>Example&nbsp;2.12.&nbsp;Deployment of your application using Jersey specific servlet</b></p><div class="example-contents">
        
        <pre class="programlisting">&nbsp;&nbsp;1 &lt;web-app&gt;
&nbsp;&nbsp;2     &lt;servlet&gt;
&nbsp;&nbsp;3         &lt;servlet-name&gt;Jersey Web Application&lt;/servlet-name&gt;
&nbsp;&nbsp;4         &lt;servlet-class&gt;com.sun.jersey.spi.container.servlet.ServletContainer&lt;/servlet-class&gt;
&nbsp;&nbsp;5         &lt;init-param&gt;
&nbsp;&nbsp;6             &lt;param-name&gt;javax.ws.rs.Application&lt;/param-name&gt;
&nbsp;&nbsp;7             &lt;param-value&gt;org.foo.rest.MyApplication&lt;/param-value&gt;
&nbsp;&nbsp;8         &lt;/init-param&gt;
&nbsp;&nbsp;9         ...
&nbsp;10     &lt;/servlet&gt;
&nbsp;11     ...
&nbsp;12 &lt;/web-app&gt;</pre>
    </div></div><p><br class="example-break"></p>        
    <p>Alternatively a simpler approach is to let Jersey choose the <code class="literal">PackagesResourceConfig</code> 
    implementation automatically by declaring the packages as follows:

    </p><div class="example"><a name="d4e246"></a><p class="title"><b>Example&nbsp;2.13.&nbsp;Using Jersey specific servlet without an application model instance</b></p><div class="example-contents">
        
        <pre class="programlisting">&nbsp;&nbsp;1 &lt;web-app&gt;
&nbsp;&nbsp;2     &lt;servlet&gt;
&nbsp;&nbsp;3         &lt;servlet-name&gt;Jersey Web Application&lt;/servlet-name&gt;
&nbsp;&nbsp;4         &lt;servlet-class&gt;com.sun.jersey.spi.container.servlet.ServletContainer&lt;/servlet-class&gt;
&nbsp;&nbsp;5         &lt;init-param&gt;
&nbsp;&nbsp;6             &lt;param-name&gt;com.sun.jersey.config.property.packages&lt;/param-name&gt;
&nbsp;&nbsp;7             &lt;param-value&gt;org.foo.rest;org.bar.rest&lt;/param-value&gt;
&nbsp;&nbsp;8         &lt;/init-param&gt;
&nbsp;&nbsp;9         ...
&nbsp;10     &lt;/servlet&gt;
&nbsp;11     ...
&nbsp;12 &lt;/web-app&gt;</pre>
    </div></div><p><br class="example-break"></p>    
    <p>JAX-RS also provides the ability to obtain a container specific artifact 
    from an <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/Application.html" target="_top">Application</a> instance. For example, Jersey supports using
    <a class="ulink" href="http://grizzly.java.net/" target="_top">Grizzly</a> as follows:
    </p><pre class="programlisting">SelectorThread st = RuntimeDelegate.createEndpoint(new MyApplication(), SelectorThread.class);</pre><p>    
    Jersey also provides <a class="ulink" href="http://grizzly.java.net/" target="_top">Grizzly</a>
    helper classes to deploy the ServletThread instance at a base URL for
    in-process deployment.</p>

    <p>The Jersey samples provide many examples of Servlet-based and
    Grizzly-in-process-based deployments.</p>
  </div>

  <div class="section" title="2.3.&nbsp;Extracting Request Parameters"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e255"></a>2.3.&nbsp;Extracting Request Parameters</h2></div></div></div>
    

    <p>Parameters of a resource method may be annotated with parameter-based annotations to extract information from
    a request. A previous example presented the use <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/PathParam.html" target="_top">@PathParam</a> to extract a path parameter from the path component
    of the request URL that matched the path declared in <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Path.html" target="_top">@Path</a>.</p>

    <p><a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/QueryParam.html" target="_top">@QueryParam</a> is used to extract query parameters from the Query component of the request URL. The following
    example is an extract from the sparklines sample: </p>

    <div class="example"><a name="d4e262"></a><p class="title"><b>Example&nbsp;2.14.&nbsp;Query parameters</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @Path("smooth")
&nbsp;&nbsp;2 @GET
&nbsp;&nbsp;3 public Response smooth(
&nbsp;&nbsp;4         @DefaultValue("2") @QueryParam("step") int step,
&nbsp;&nbsp;5         @DefaultValue("true") @QueryParam("min-m") boolean hasMin,
&nbsp;&nbsp;6         @DefaultValue("true") @QueryParam("max-m") boolean hasMax,
&nbsp;&nbsp;7         @DefaultValue("true") @QueryParam("last-m") boolean hasLast,           
&nbsp;&nbsp;8         @DefaultValue("blue") @QueryParam("min-color") ColorParam minColor,
&nbsp;&nbsp;9         @DefaultValue("green") @QueryParam("max-color") ColorParam maxColor,
&nbsp;10         @DefaultValue("red") @QueryParam("last-color") ColorParam lastColor
&nbsp;11         ) { ... }</pre></div></div><br class="example-break">

    <p>If a query parameter "step" exists in the query component of the
    request URI then the "step" value will be will extracted and parsed as a
    32 bit signed integer and assigned to the step method parameter. If "step"
    does not exist then a default value of 2, as declared in the <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/DefaultValue.html" target="_top">@DefaultValue</a>
    annotation, will be assigned to the step method parameter. If the "step"
    value cannot be parsed as a 32 bit signed integer then a HTTP 404 (Not
    Found) response is returned. User defined Java types such as
    <code class="literal">ColorParam</code> may be used, which as implemented as
    follows: </p>

    <div class="example"><a name="d4e268"></a><p class="title"><b>Example&nbsp;2.15.&nbsp;Custom Java type for consuming request parameters</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 public class ColorParam extends Color {
&nbsp;&nbsp;2     public ColorParam(String s) {
&nbsp;&nbsp;3         super(getRGB(s));
&nbsp;&nbsp;4     }
&nbsp;&nbsp;5 
&nbsp;&nbsp;6     private static int getRGB(String s) {
&nbsp;&nbsp;7         if (s.charAt(0) == '#') {
&nbsp;&nbsp;8             try {
&nbsp;&nbsp;9                 Color c = Color.decode("0x" + s.substring(1));
&nbsp;10                 return c.getRGB();
&nbsp;11             } catch (NumberFormatException e) {
&nbsp;12                 throw new WebApplicationException(400);
&nbsp;13             }
&nbsp;14         } else {
&nbsp;15             try {
&nbsp;16                 Field f = Color.class.getField(s);
&nbsp;17                 return ((Color)f.get(null)).getRGB();
&nbsp;18             } catch (Exception e) {
&nbsp;19                 throw new WebApplicationException(400);
&nbsp;20             }
&nbsp;21         }
&nbsp;22     }
&nbsp;23 }</pre></div></div><br class="example-break">

    <p>In general the Java type of the method parameter may:</p>

    <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
        <p>Be a primitive type;</p>
      </li><li class="listitem">
        <p>Have a constructor that accepts a single
        <code class="literal">String</code> argument;</p>
      </li><li class="listitem">
        <p>Have a static method named <code class="literal">valueOf</code> or <code class="literal">fromString</code>
        that accepts a single <code class="literal">String</code> argument (see, for example,
        <code class="literal">Integer.valueOf(String)</code> and <code class="literal">java.util.UUID.fromString(String)</code>);
        or</p>
      </li><li class="listitem">
        <p>Be <code class="literal">List&lt;T&gt;</code>,
        <code class="literal">Set&lt;T&gt;</code> or
        <code class="literal">SortedSet&lt;T&gt;</code>, where <code class="literal">T</code>
        satisfies 2 or 3 above. The resulting collection is read-only.</p>
      </li></ol></div>

    <p>Sometimes parameters may contain more than one value for the same
    name. If this is the case then types in 4) may be used to obtain all
    values.</p>

    <p>If the <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/DefaultValue.html" target="_top">@DefaultValue</a> is not used in conjunction with <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/QueryParam.html" target="_top">@QueryParam</a>
    and the query parameter is not present in the request then value will be
    an empty collection for <code class="literal">List</code>, <code class="literal">Set</code> or
    <code class="literal">SortedSet</code>, <code class="literal">null</code> for other object
    types, and the Java-defined default for primitive types.</p>

    <p>The <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/PathParam.html" target="_top">@PathParam</a> and the other parameter-based annotations, <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/MatrixParam.html" target="_top">@MatrixParam</a>,
    <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/HeaderParam.html" target="_top">@HeaderParam</a>, <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/CookieParam.html" target="_top">@CookieParam</a>, <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/FormParam.html" target="_top">@FormParam</a> obey the same rules as <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/QueryParam.html" target="_top">@QueryParam</a>.
    <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/MatrixParam.html" target="_top">@MatrixParam</a> extracts information from URL path segments. <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/HeaderParam.html" target="_top">@HeaderParam</a> extracts information
    from the HTTP headers. <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/CookieParam.html" target="_top">@CookieParam</a> extracts information from the cookies declared in cookie related HTTP
    headers.</p>

    <p><a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/FormParam.html" target="_top">@FormParam</a> is slightly special because it extracts information from a request representation that
    is of the MIME media type <code class="literal">"application/x-www-form-urlencoded"</code> and conforms to the encoding
    specified by HTML forms, as described here. This parameter is very useful for extracting information that is
    POSTed by HTML forms, for example the following extracts the form parameter named "name" from the POSTed form
    data: </p>

    <div class="example"><a name="d4e313"></a><p class="title"><b>Example&nbsp;2.16.&nbsp;Processing POSTed HTML form</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @POST
&nbsp;&nbsp;2 @Consumes("application/x-www-form-urlencoded")
&nbsp;&nbsp;3 public void post(@FormParam("name") String name) {
&nbsp;&nbsp;4     // Store the message
&nbsp;&nbsp;5 }</pre></div></div><p><br class="example-break"></p>

    <p>If it is necessary to obtain a general map of parameter name to
    values then, for query and path parameters it is possible to do the
    following: </p>

    <div class="example"><a name="d4e318"></a><p class="title"><b>Example&nbsp;2.17.&nbsp;Obtaining general map of URI path and/or query parameters</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @GET
&nbsp;&nbsp;2 public String get(@Context UriInfo ui) {
&nbsp;&nbsp;3     MultivaluedMap&lt;String, String&gt; queryParams = ui.getQueryParameters();
&nbsp;&nbsp;4     MultivaluedMap&lt;String, String&gt; pathParams = ui.getPathParameters();
&nbsp;&nbsp;5 }</pre></div></div><p><br class="example-break"></p>

    <p>For header and cookie parameters the following:</p>

    <div class="example"><a name="d4e323"></a><p class="title"><b>Example&nbsp;2.18.&nbsp;Obtaining general map of header parameters</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @GET
&nbsp;&nbsp;2 public String get(@Context HttpHeaders hh) {
&nbsp;&nbsp;3     MultivaluedMap&lt;String, String&gt; headerParams = hh.getRequestHeaders();
&nbsp;&nbsp;4     Map&lt;String, Cookie&gt; pathParams = hh.getCookies();
&nbsp;&nbsp;5 }</pre></div></div><p><br class="example-break"></p>

    <p>In general <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/Context.html" target="_top">@Context</a> can be used to obtain contextual Java types related to the request or
    response. For form parameters it is possible to do the following:</p>

    <div class="example"><a name="d4e329"></a><p class="title"><b>Example&nbsp;2.19.&nbsp;Obtaining general map of form parameters</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @POST
&nbsp;&nbsp;2 @Consumes("application/x-www-form-urlencoded")
&nbsp;&nbsp;3 public void post(MultivaluedMap&lt;String, String&gt; formParams) {
&nbsp;&nbsp;4     // Store the message
&nbsp;&nbsp;5 }</pre></div></div><p><br class="example-break"></p>
  </div>

  <div class="section" title="2.4.&nbsp;Representations and Java Types"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e332"></a>2.4.&nbsp;Representations and Java Types</h2></div></div></div>
    

    <p>Previous sections on <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Produces.html" target="_top">@Produces</a> and <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Consumes.html" target="_top">@Consumes</a>
    referred to MIME media types of representations and showed resource
    methods that consume and produce the Java type String for a number of
    different media types. However, <code class="literal">String</code> is just one of
    many Java types that are required to be supported by JAX-RS
    implementations.</p>

    <p>Java types such as <code class="literal">byte[]</code>,
    <code class="literal">java.io.InputStream</code>, <code class="literal">java.io.Reader</code>
    and <code class="literal">java.io.File</code> are supported. In addition JAXB beans
    are supported. Such beans are <code class="literal">JAXBElement</code> or classes
    annotated with <a class="ulink" href="http://java.sun.com/javase/6/docs/api/javax/xml/bind/annotation/XmlRootElement.html" target="_top">@XmlRootElement</a>
    or <a class="ulink" href="http://java.sun.com/javase/6/docs/api/javax/xml/bind/annotation/XmlType.html" target="_top">@XmlType</a>.
    The samples jaxb and json-from-jaxb show the use of JAXB beans. </p>

    <p>Unlike method parameters that are associated with the extraction of
    request parameters, the method parameter associated with the
    representation being consumed does not require annotating. A maximum of
    one such unannotated method parameter may exist since there may only be a
    maximum of one such representation sent in a request.</p>

    <p>The representation being produced corresponds to what is returned by
    the resource method. For example JAX-RS makes it simple to produce images
    that are instance of <code class="literal">File</code> as follows:</p>

    <div class="example"><a name="d4e350"></a><p class="title"><b>Example&nbsp;2.20.&nbsp;Using <code class="code">File</code> with a specific MIME type to produce a response</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @GET
&nbsp;&nbsp;2 @Path("/images/{image}")
&nbsp;&nbsp;3 @Produces("image/*")
&nbsp;&nbsp;4 public Response getImage(@PathParam("image") String image) {
&nbsp;&nbsp;5     File f = new File(image);
&nbsp;&nbsp;6 
&nbsp;&nbsp;7     if (!f.exists()) {
&nbsp;&nbsp;8         throw new WebApplicationException(404);
&nbsp;&nbsp;9     }
&nbsp;10 
&nbsp;11     String mt = new MimetypesFileTypeMap().getContentType(f);
&nbsp;12     return Response.ok(f, mt).build();
&nbsp;13 }</pre></div></div><p><br class="example-break"></p>

    <p>A <code class="literal">File</code> type can also be used when consuming, a
    temporary file will be created where the request entity is stored.</p>

    <p>The <code class="literal">Content-Type</code> (if not set, see next section)
    can be automatically set from the MIME media types declared by <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Produces.html" target="_top">@Produces</a>
    if the most acceptable media type is not a wild card (one that contains a
    *, for example "application/" or "/*"). Given the following method:</p>

    <div class="example"><a name="d4e360"></a><p class="title"><b>Example&nbsp;2.21.&nbsp;The most acceptable MIME type is used when multiple output MIME types allowed</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @GET
&nbsp;&nbsp;2 @Produces({"application/xml", "application/json"})
&nbsp;&nbsp;3 public String doGetAsXmlOrJson() {
&nbsp;&nbsp;4     ...
&nbsp;&nbsp;5 }</pre></div></div><p><br class="example-break"></p>

    <p>if "application/xml" is the most acceptable then the
    <code class="literal">Content-Type</code> of the response will be set to
    "application/xml".</p>
  </div>

  <div class="section" title="2.5.&nbsp;Building Responses"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e365"></a>2.5.&nbsp;Building Responses</h2></div></div></div>
    

    <p>Sometimes it is necessary to return additional
    information in response to a HTTP request. Such information may be built
    and returned using <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/Response.html" target="_top">Response</a> and <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/Response.ResponseBuilder.html" target="_top">Response.ResponseBuilder</a>.
    For example, a common RESTful pattern for the creation of a new resource
    is to support a POST request that returns a 201 (Created) status code and
    a <code class="literal">Location</code> header whose value is the URI to the newly
    created resource. This may be achieved as follows:</p>

    <div class="example"><a name="d4e372"></a><p class="title"><b>Example&nbsp;2.22.&nbsp;Returning 201 status code and adding <code class="literal">Location</code> header in response to POST request</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @POST
&nbsp;&nbsp;2 @Consumes("application/xml")
&nbsp;&nbsp;3 public Response post(String content) {
&nbsp;&nbsp;4     URI createdUri = ...
&nbsp;&nbsp;5     create(content);
&nbsp;&nbsp;6     return Response.created(createdUri).build();
&nbsp;&nbsp;7 }</pre></div></div><p><br class="example-break"></p>

    <p>In the above no representation produced is returned, this can be
    achieved by building an entity as part of the response as follows:</p>

    <div class="example"><a name="d4e378"></a><p class="title"><b>Example&nbsp;2.23.&nbsp;Adding an entity body to a custom response</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @POST
&nbsp;&nbsp;2 @Consumes("application/xml")
&nbsp;&nbsp;3 public Response post(String content) {
&nbsp;&nbsp;4     URI createdUri = ...
&nbsp;&nbsp;5     String createdContent = create(content);
&nbsp;&nbsp;6     return Response.created(createdUri).entity(createdContent).build();
&nbsp;&nbsp;7 }</pre></div></div><p><br class="example-break"></p>

    <p>Response building provides other functionality such as setting the
    entity tag and last modified date of the representation.</p>
  </div>

  <div class="section" title="2.6.&nbsp;Sub-resources"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e382"></a>2.6.&nbsp;Sub-resources</h2></div></div></div>
    

    <p><a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Path.html" target="_top">@Path</a> may be used on classes and such classes are referred to as root resource classes. <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Path.html" target="_top">@Path</a>
    may also be used on methods of root resource classes. This enables common functionality for a number of resources
    to be grouped together and potentially reused.</p>

    <p>The first way <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Path.html" target="_top">@Path</a> may be used is on resource methods and such methods are referred to as
    <span class="emphasis"><em>sub-resource methods</em></span>. The following example shows the method signatures for a root
    resource class from the jmaki-backend sample:</p>

    <div class="example"><a name="d4e391"></a><p class="title"><b>Example&nbsp;2.24.&nbsp;Sub-resource methods</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @Singleton
&nbsp;&nbsp;2 @Path("/printers")
&nbsp;&nbsp;3 public class PrintersResource {
&nbsp;&nbsp;4 
&nbsp;&nbsp;5     @GET
&nbsp;&nbsp;6     @Produces({"application/json", "application/xml"})
&nbsp;&nbsp;7     public WebResourceList getMyResources() { ... }
&nbsp;&nbsp;8    
&nbsp;&nbsp;9     @GET @Path("/list")
&nbsp;10     @Produces({"application/json", "application/xml"})
&nbsp;11     public WebResourceList getListOfPrinters() { ... }
&nbsp;12 
&nbsp;13     @GET @Path("/jMakiTable")
&nbsp;14     @Produces("application/json")
&nbsp;15     public PrinterTableModel getTable() { ... }
&nbsp;16 
&nbsp;17     @GET @Path("/jMakiTree")
&nbsp;18     @Produces("application/json")
&nbsp;19     public TreeModel getTree() { ... }
&nbsp;20 
&nbsp;21     @GET @Path("/ids/{printerid}")
&nbsp;22     @Produces({"application/json", "application/xml"})
&nbsp;23     public Printer getPrinter(@PathParam("printerid") String printerId) { ... }
&nbsp;24 
&nbsp;25     @PUT @Path("/ids/{printerid}")
&nbsp;26     @Consumes({"application/json", "application/xml"})
&nbsp;27     public void putPrinter(@PathParam("printerid") String printerId,  Printer printer) { ... }
&nbsp;28 
&nbsp;29     @DELETE @Path("/ids/{printerid}")
&nbsp;30     public void deletePrinter(@PathParam("printerid") String printerId) { ... }
&nbsp;31 }</pre></div></div><p><br class="example-break"></p>

    <p>If the path of the request URL is "printers" then the resource methods not annotated with <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Path.html" target="_top">@Path</a>
    will be selected. If the request path of the request URL is "printers/list" then first the root resource class
    will be matched and then the sub-resource methods that match "list" will be selected, which in this case
    is the sub-resource method <code class="literal">getListOfPrinters</code>. So in this example hierarchical matching
    on the path of the request URL is performed.</p>

    <p>The second way <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Path.html" target="_top">@Path</a> may be used is on methods <span class="bold"><strong>not</strong></span> annotated
    with resource method designators such as <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/GET.html" target="_top">@GET</a> or <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/POST.html" target="_top">@POST</a>. Such methods are referred to as
    <span class="emphasis"><em>sub-resource locators</em></span>. The following example shows the method signatures for
    a root resource class and a resource class from the optimistic-concurrency sample:</p>

    <div class="example"><a name="d4e404"></a><p class="title"><b>Example&nbsp;2.25.&nbsp;Sub-resource locators</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @Path("/item")
&nbsp;&nbsp;2 public class ItemResource {
&nbsp;&nbsp;3     @Context UriInfo uriInfo;
&nbsp;&nbsp;4 
&nbsp;&nbsp;5     @Path("content")
&nbsp;&nbsp;6     public ItemContentResource getItemContentResource() {
&nbsp;&nbsp;7         return new ItemContentResource();
&nbsp;&nbsp;8     }
&nbsp;&nbsp;9 
&nbsp;10     @GET
&nbsp;11     @Produces("application/xml")
&nbsp;12     public Item get() { ... }
&nbsp;13 }
&nbsp;14 
&nbsp;15 public class ItemContentResource {
&nbsp;16 
&nbsp;17     @GET
&nbsp;18     public Response get() { ... }
&nbsp;19 
&nbsp;20     @PUT
&nbsp;21     @Path("{version}")
&nbsp;22     public void put(
&nbsp;23             @PathParam("version") int version,
&nbsp;24             @Context HttpHeaders headers,
&nbsp;25             byte[] in) { ... }
&nbsp;26 }</pre></div></div><p><br class="example-break"></p>

    <p>The root resource class <code class="literal">ItemResource</code> contains the
    sub-resource locator method <code class="literal">getItemContentResource</code> that
    returns a new resource class. If the path of the request URL is
    "item/content" then first of all the root resource will be matched, then
    the sub-resource locator will be matched and invoked, which returns an
    instance of the <code class="literal">ItemContentResource</code> resource class.
    Sub-resource locators enable reuse of resource classes.</p>

    <p>In addition the processing of resource classes returned by
    sub-resource locators is performed at runtime thus it is possible to
    support polymorphism. A sub-resource locator may return different
    sub-types depending on the request (for example a sub-resource locator
    could return different sub-types dependent on the role of the principle
    that is authenticated).</p>

    <p>Note that the runtime will not manage the life-cycle or perform any
    field injection onto instances returned from sub-resource locator methods.
    This is because the runtime does not know what the life-cycle of the
    instance is.</p>
  </div>

  <div class="section" title="2.7.&nbsp;Building URIs"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e413"></a>2.7.&nbsp;Building URIs</h2></div></div></div>
    

    <p>A very important aspects of REST is hyperlinks, URIs, in
    representations that clients can use to transition the Web service to new
    application states (this is otherwise known as "hypermedia as the engine
    of application state"). HTML forms present a good example of this in
    practice.</p>

    <p>Building URIs and building them safely is not easy with <a class="ulink" href="http://java.sun.com/j2se/1.5.0/docs/api/java/net/URI.html" target="_top">java.net.URI</a>,
    which is why JAX-RS has the <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/UriBuilder.html" target="_top">UriBuilder</a> class that makes it simple and easy to build URIs safely.</p>

    <p><a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/UriBuilder.html" target="_top">UriBuilder</a> can be used to build new URIs or build from existing URIs. For resource
    classes it is more than likely that URIs will be built from the base URI the web service is deployed at
    or from the request URI. The class <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/UriInfo.html" target="_top">UriInfo</a> provides such information (in addition to further
    information, see next section).</p>

    <p>The following example shows URI building with <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/UriInfo.html" target="_top">UriInfo</a> and <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/UriBuilder.html" target="_top">UriBuilder</a>
    from the bookmark sample:</p>

    <div class="example"><a name="d4e426"></a><p class="title"><b>Example&nbsp;2.26.&nbsp;URI building</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @Path("/users/")
&nbsp;&nbsp;2 public class UsersResource {
&nbsp;&nbsp;3 
&nbsp;&nbsp;4     @Context UriInfo uriInfo;
&nbsp;&nbsp;5 
&nbsp;&nbsp;6     ...
&nbsp;&nbsp;7 
&nbsp;&nbsp;8     @GET
&nbsp;&nbsp;9     @Produces("application/json")
&nbsp;10     public JSONArray getUsersAsJsonArray() {
&nbsp;11         JSONArray uriArray = new JSONArray();
&nbsp;12         for (UserEntity userEntity : getUsers()) {
&nbsp;13             UriBuilder ub = uriInfo.getAbsolutePathBuilder();
&nbsp;14             URI userUri = ub.
&nbsp;15                     path(userEntity.getUserid()).
&nbsp;16                     build();
&nbsp;17             uriArray.put(userUri.toASCIIString());
&nbsp;18         }
&nbsp;19         return uriArray;
&nbsp;20     }
&nbsp;21 }</pre></div></div><p><br class="example-break"></p>

    <p><a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/UriInfo.html" target="_top">UriInfo</a> is obtained using the @Context annotation, and in this particular example injection onto
    the field of the root resource class is performed, previous examples showed the use of @Context on resource method parameters.</p>

    <p><a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/UriInfo.html" target="_top">UriInfo</a> can be used to obtain URIs and associated <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/UriBuilder.html" target="_top">UriBuilder</a> instances for
    the following URIs: the base URI the application is deployed at; the request URI; and the absolute path URI, which
    is the request URI minus any query components.</p>

    <p>The <code class="literal">getUsersAsJsonArray</code> method constructs a
    JSONArrray where each element is a URI identifying a specific user
    resource. The URI is built from the absolute path of the request URI by
    calling <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/UriInfo.html#getAbsolutePathBuilder()" target="_top">UriInfo.getAbsolutePathBuilder()</a>.
    A new path segment is added, which is the user ID, and then the URI is
    built. Notice that it is not necessary to worry about the inclusion of '/'
    characters or that the user ID may contain characters that need to be
    percent encoded. UriBuilder takes care of such details.</p>

    <p><a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/UriBuilder.html" target="_top">UriBuilder</a> can be used to build/replace query or matrix parameters. URI templates can also be declared,
    for example the following will build the URI "http://localhost/segment?name=value":</p>

    <div class="example"><a name="d4e440"></a><p class="title"><b>Example&nbsp;2.27.&nbsp;Building URIs using query parameters</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 UriBuilder.fromUri("http://localhost/").
&nbsp;&nbsp;2     path("{a}").
&nbsp;&nbsp;3     queryParam("name", "{value}").
&nbsp;&nbsp;4     build("segment", "value");</pre></div></div><p><br class="example-break"></p>
  </div>

  <div class="section" title="2.8.&nbsp;WebApplicationException and Mapping Exceptions to Responses"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e443"></a>2.8.&nbsp;WebApplicationException and Mapping Exceptions to Responses</h2></div></div></div>
    

    <p>Previous sections have shown how to return HTTP responses and it is
    possible to return HTTP errors using the same mechanism. However,
    sometimes when programming in Java it is more natural to use exceptions
    for HTTP errors.</p>

    <p>The following example shows the throwing of a
    <code class="literal">NotFoundException</code> from the bookmark sample:</p>

    <div class="example"><a name="d4e449"></a><p class="title"><b>Example&nbsp;2.28.&nbsp;Throwing Jersey specific exceptions to control response</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @Path("items/{itemid}/")
&nbsp;&nbsp;2 public Item getItem(@PathParam("itemid") String itemid) {
&nbsp;&nbsp;3     Item i = getItems().get(itemid);
&nbsp;&nbsp;4     if (i == null)
&nbsp;&nbsp;5         throw new NotFoundException("Item, " + itemid + ", is not found");
&nbsp;&nbsp;6 
&nbsp;&nbsp;7     return i;
&nbsp;&nbsp;8 }</pre></div></div><p><br class="example-break"></p>

    <p>This exception is a Jersey specific exception that extends <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/WebApplicationException.html" target="_top">WebApplicationException</a>
    and builds a HTTP response with the 404 status code and an optional
    message as the body of the response:</p>

    <div class="example"><a name="d4e455"></a><p class="title"><b>Example&nbsp;2.29.&nbsp;Jersey specific exception implementation</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 public class NotFoundException extends WebApplicationException {
&nbsp;&nbsp;2 
&nbsp;&nbsp;3     /**
&nbsp;&nbsp;4      * Create a HTTP 404 (Not Found) exception.
&nbsp;&nbsp;5      */
&nbsp;&nbsp;6     public NotFoundException() {
&nbsp;&nbsp;7         super(Responses.notFound().build());
&nbsp;&nbsp;8     }
&nbsp;&nbsp;9 
&nbsp;10     /**
&nbsp;11      * Create a HTTP 404 (Not Found) exception.
&nbsp;12      * @param message the String that is the entity of the 404 response.
&nbsp;13      */
&nbsp;14     public NotFoundException(String message) {
&nbsp;15         super(Response.status(Responses.NOT_FOUND).
&nbsp;16                 entity(message).type("text/plain").build());
&nbsp;17     }
&nbsp;18 
&nbsp;19 }</pre></div></div><p><br class="example-break"></p>

    <p>In other cases it may not be appropriate to throw instances of <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/WebApplicationException.html" target="_top">WebApplicationException</a>,
    or classes that extend <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/WebApplicationException.html" target="_top">WebApplicationException</a>, and instead it may be preferable to map an existing exception to a
    response. For such cases it is possible to use the <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/ext/ExceptionMapper.html" target="_top">ExceptionMapper&lt;E extends Throwable&gt;</a> interface. For example, the following
    maps the <a class="ulink" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/EntityNotFoundException.html" target="_top">EntityNotFoundException</a>
    to a HTTP 404 (Not Found) response:</p>

    <div class="example"><a name="d4e464"></a><p class="title"><b>Example&nbsp;2.30.&nbsp;Mapping generic exceptions to responses</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @Provider
&nbsp;&nbsp;2 public class EntityNotFoundMapper implements
&nbsp;&nbsp;3         ExceptionMapper&lt;javax.persistence.EntityNotFoundException&gt; {
&nbsp;&nbsp;4     public Response toResponse(javax.persistence.EntityNotFoundException ex) {
&nbsp;&nbsp;5         return Response.status(404).
&nbsp;&nbsp;6             entity(ex.getMessage()).
&nbsp;&nbsp;7             type("text/plain").
&nbsp;&nbsp;8             build();
&nbsp;&nbsp;9     }
&nbsp;10 }</pre></div></div><p><br class="example-break"></p>

    <p>The above class is annotated with <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/ext/Provider.html" target="_top">@Provider</a>, this declares that the class is of interest to the JAX-RS runtime. Such a
    class may be added to the set of classes of the <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/Application.html" target="_top">Application</a> instance that is configured. When an application throws an
    <a class="ulink" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/EntityNotFoundException.html" target="_top">EntityNotFoundException</a>
    the <code class="literal">toResponse</code> method of the <code class="literal">EntityNotFoundMapper</code> instance will be invoked.</p>
  </div>

  <div class="section" title="2.9.&nbsp;Conditional GETs and Returning 304 (Not Modified) Responses"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e473"></a>2.9.&nbsp;Conditional GETs and Returning 304 (Not Modified) Responses</h2></div></div></div>
    

    <p>Conditional GETs are a great way to reduce bandwidth, and
    potentially server-side performance, depending on how the information used
    to determine conditions is calculated. A well-designed web site may return
    304 (Not Modified) responses for the many of the static images it
    serves.</p>

    <p>JAX-RS provides support for conditional GETs using the contextual interface <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/Request.html" target="_top">Request</a>.</p>

    <p>The following example shows conditional GET support from the sparklines sample:</p>

    <div class="example"><a name="d4e480"></a><p class="title"><b>Example&nbsp;2.31.&nbsp;Conditional GET support</b></p><div class="example-contents">
        <pre class="programlisting">&nbsp;&nbsp;1 public SparklinesResource(
&nbsp;&nbsp;2         @QueryParam("d") IntegerList data,
&nbsp;&nbsp;3         @DefaultValue("0,100") @QueryParam("limits") Interval limits,
&nbsp;&nbsp;4         @Context Request request,
&nbsp;&nbsp;5         @Context UriInfo ui) {
&nbsp;&nbsp;6     if (data == null)
&nbsp;&nbsp;7         throw new WebApplicationException(400);
&nbsp;&nbsp;8 
&nbsp;&nbsp;9     this.data = data;
&nbsp;10 
&nbsp;11     this.limits = limits;
&nbsp;12 
&nbsp;13     if (!limits.contains(data))
&nbsp;14         throw new WebApplicationException(400);
&nbsp;15 
&nbsp;16     this.tag = computeEntityTag(ui.getRequestUri());
&nbsp;17     if (request.getMethod().equals("GET")) {
&nbsp;18         Response.ResponseBuilder rb = request.evaluatePreconditions(tag);
&nbsp;19         if (rb != null)
&nbsp;20             throw new WebApplicationException(rb.build());
&nbsp;21     }
&nbsp;22 }</pre></div></div><p><br class="example-break"></p>

    <p>The constructor of the <code class="literal">SparklinesResouce</code> root
    resource class computes an entity tag from the request URI and then calls
    the <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/Request.html#evaluatePreconditions(javax.ws.rs.core.EntityTag)" target="_top">request.evaluatePreconditions</a>
    with that entity tag. If a client request contains an
    <code class="literal">If-None-Match</code> header with a value that contains the
    same entity tag that was calculated then the <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/Request.html#evaluatePreconditions(javax.ws.rs.core.EntityTag)" target="_top">evaluatePreconditions</a>
    returns a pre-filled out response, with the 304 status code and entity tag
    set, that may be built and returned. Otherwise, <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/Request.html#evaluatePreconditions(javax.ws.rs.core.EntityTag)" target="_top">evaluatePreconditions</a>
    returns <code class="literal">null</code> and the normal response can be
    returned.</p>

    <p>Notice that in this example the constructor of a resource class can
    be used perform actions that may otherwise have to be duplicated to
    invoked for each resource method.</p>
  </div>

  <div class="section" title="2.10.&nbsp;Life-cycle of Root Resource Classes"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e491"></a>2.10.&nbsp;Life-cycle of Root Resource Classes</h2></div></div></div>
    

    <p>By default the life-cycle of root resource classes is per-request,
    namely that a new instance of a root resource class is created every time
    the request URI path matches the root resource. This makes for a very
    natural programming model where constructors and fields can be utilized
    (as in the previous section showing the constructor of the
    <code class="literal">SparklinesResource</code> class) without concern for multiple
    concurrent requests to the same resource.</p>

    <p>In general this is unlikely to be a cause of performance issues.
    Class construction and garbage collection of JVMs has vastly improved over
    the years and many objects will be created and discarded to serve and
    process the HTTP request and return the HTTP response.</p>

    <p>Instances of singleton root resource classes can be declared by an instance of <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/Application.html" target="_top">Application</a>.</p>

    <p>Jersey supports two further life-cycles using Jersey specific
    annotations. If a root resource class is annotated with @Singleton then
    only one instance is created per-web application. If a root resource class
    is annotated with @PerSession then one instance is created per web session
    and stored as a session attribute.</p>
  </div>

  <div class="section" title="2.11.&nbsp;Security"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e499"></a>2.11.&nbsp;Security</h2></div></div></div>
    

    <p>Security information is available by obtaining the <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/SecurityContext.html" target="_top">SecurityContext</a> using <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/Context.html" target="_top">@Context</a>,
    which is essentially the equivalent functionality available on the <a class="ulink" href="http://java.sun.com/javaee/5/docs/api/javax/servlet/http/HttpServletRequest.html" target="_top">HttpServletRequest</a>.</p>

    <p><a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/SecurityContext.html" target="_top">SecurityContext</a> can be used in conjunction with sub-resource locators to return different
    resources if the user principle is included in a certain role. For example, a sub-resource locator could return
    a different resource if a user is a preferred customer:</p>

    <div class="example"><a name="d4e508"></a><p class="title"><b>Example&nbsp;2.32.&nbsp;Accessing <code class="code">SecurityContext</code></b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @Path("basket")
&nbsp;&nbsp;2 public ShoppingBasketResource get(@Context SecurityContext sc) {
&nbsp;&nbsp;3     if (sc.isUserInRole("PreferredCustomer") {
&nbsp;&nbsp;4        return new PreferredCustomerShoppingBaskestResource();
&nbsp;&nbsp;5     } else {
&nbsp;&nbsp;6        return new ShoppingBasketResource();
&nbsp;&nbsp;7     }
&nbsp;&nbsp;8 }</pre></div></div><p><br class="example-break"></p>
  </div>

  <div class="section" title="2.12.&nbsp;Rules of Injection"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e512"></a>2.12.&nbsp;Rules of Injection</h2></div></div></div>
    

    <p>Previous sections have presented examples of annotated types, mostly
    annotated method parameters but also annotated fields of a class, for the
    injection of values onto those types.</p>

    <p>This section presents the rules of injection of values on annotated
    types. Injection can be performed on fields, constructor parameters,
    resource/sub-resource/sub-resource locator method parameters and bean
    setter methods. The following presents an example of all such injection
    cases: </p>

    <div class="example"><a name="d4e517"></a><p class="title"><b>Example&nbsp;2.33.&nbsp;Injection</b></p><div class="example-contents">
<pre class="programlisting">&nbsp;&nbsp;1 @Path("id: \d+")
&nbsp;&nbsp;2 public class InjectedResource {
&nbsp;&nbsp;3     // Injection onto field
&nbsp;&nbsp;4     @DefaultValue("q") @QueryParam("p")
&nbsp;&nbsp;5     private String p;
&nbsp;&nbsp;6 
&nbsp;&nbsp;7     // Injection onto constructor parameter
&nbsp;&nbsp;8     public InjectedResource(@PathParam("id") int id) { ... }
&nbsp;&nbsp;9 
&nbsp;10     // Injection onto resource method parameter
&nbsp;11     @GET
&nbsp;12     public String get(@Context UriInfo ui) { ... }
&nbsp;13 
&nbsp;14     // Injection onto sub-resource resource method parameter
&nbsp;15     @Path("sub-id")
&nbsp;16     @GET
&nbsp;17     public String get(@PathParam("sub-id") String id) { ... }
&nbsp;18 
&nbsp;19     // Injection onto sub-resource locator method parameter
&nbsp;20     @Path("sub-id")
&nbsp;21     public SubResource getSubResource(@PathParam("sub-id") String id) { ... }
&nbsp;22 
&nbsp;23     // Injection using bean setter method
&nbsp;24     @HeaderParam("X-header")
&nbsp;25     public void setHeader(String header) { ... }
&nbsp;26 }</pre></div></div><p><br class="example-break"></p>

    <p>There are some restrictions when injecting on to resource classes
    with a life-cycle other than per-request. In such cases it is not possible
    to injected onto fields for the annotations associated with extraction of
    request parameters. However, it is possible to use the <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/Context.html" target="_top">@Context</a>
    annotation on fields, in such cases a thread local proxy will be
    injected.</p>

    <p>The <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/FormParam.html" target="_top">@FormParam</a> annotation is special and may only be utilized on resource and sub-resource methods.
    This is because it extracts information from a request entity.</p>
  </div>

  <div class="section" title="2.13.&nbsp;Use of @Context"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e524"></a>2.13.&nbsp;Use of @Context</h2></div></div></div>
    

    <p>Previous sections have introduced the use of <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/Context.html" target="_top">@Context</a>. <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/spec/spec3.html#x3-520005" target="_top">Chapter 5</a>
    of the JAX-RS specification presents all the standard JAX-RS Java types that may be used with <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/Context.html" target="_top">@Context</a>.</p>

    <p>When deploying a JAX-RS application using servlet then <a class="ulink" href="http://java.sun.com/javaee/5/docs/api/javax/servlet/ServletConfig.html" target="_top">ServletConfig</a>,
    <a class="ulink" href="http://java.sun.com/javaee/5/docs/api/javax/servlet/ServletContext.html" target="_top">ServletContext</a>,
    <a class="ulink" href="http://java.sun.com/javaee/5/docs/api/javax/servlet/http/HttpServletRequest.html" target="_top">HttpServletRequest</a>
    and <a class="ulink" href="http://java.sun.com/javaee/5/docs/api/javax/servlet/http/HttpServletResponse.html" target="_top">HttpServletResponse</a>
    are available using <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/Context.html" target="_top">@Context</a>.</p>
  </div>

  <div class="section" title="2.14.&nbsp;Annotations Defined By JAX-RS"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e536"></a>2.14.&nbsp;Annotations Defined By JAX-RS</h2></div></div></div>
    

    <p>For a list of the annotations specified by JAX-RS see <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/spec/spec3.html#x3-66000A" target="_top">Appendix
    A</a> of the specification.</p>
  </div>
</div>
  <div class="chapter" title="Chapter&nbsp;3.&nbsp;Client API"><div class="titlepage"><div><div><h2 class="title"><a name="client-api"></a>Chapter&nbsp;3.&nbsp;Client API</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d4e542">3.1. Introduction</a></span></dt><dt><span class="section"><a href="#d4e556">3.2. Uniform Interface Constraint</a></span></dt><dt><span class="section"><a href="#d4e581">3.3. Ease of use and reusing JAX-RS artifacts</a></span></dt><dt><span class="section"><a href="#d4e617">3.4. Getting started with the Jersey client</a></span></dt><dt><span class="section"><a href="#d4e626">3.5. Overview of the API</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e631">3.5.1. Configuring a Client and WebResource</a></span></dt><dt><span class="section"><a href="#d4e652">3.5.2. Building a request</a></span></dt><dt><span class="section"><a href="#d4e673">3.5.3. Receiving a response</a></span></dt><dt><span class="section"><a href="#d4e685">3.5.4. Creating new WebResources from a WebResource</a></span></dt><dt><span class="section"><a href="#d4e691">3.5.5. Java instances and types for representations</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e702">3.6. Adding support for new representations</a></span></dt><dt><span class="section"><a href="#d4e714">3.7. Using filters</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e748">3.7.1. Supported filters</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e767">3.8. Testing services</a></span></dt><dt><span class="section"><a href="#d4e786">3.9. Security with Http(s)URLConnection</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e788">3.9.1. With Http(s)URLConnection</a></span></dt><dt><span class="section"><a href="#d4e804">3.9.2. With Apache HTTP client</a></span></dt></dl></dd></dl></div>
    
    <div class="section" title="3.1.&nbsp;Introduction"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e542"></a>3.1.&nbsp;Introduction</h2></div></div></div>
        
        <p>This section introduces the client API and some features such as filters and how to use them with
        security features in the JDK. The Jersey client API is a high-level Java based API for interoperating
        with RESTful Web services.
        It makes it very easy to interoperate with RESTful Web services and
        enables a developer to concisely and efficiently implement a reusable client-side solution that
        leverages existing and well established client-side HTTP implementations.
        </p>
        <p>The Jersey client API can be utilized to interoperate with any RESTful Web service, implemented
        using one of many frameworks, and is not restricted to services implemented using JAX-RS.
        However, developers familiar with JAX-RS should find the Jersey client API complementary to their services,
        especially if the client API is utilized by those services themselves, or to test those services.
        </p>
        <p>The goals of the Jersey client API are threefold:</p>
        <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
                <p>Encapsulate a key constraint of the REST architectural style, namely the Uniform Interface
                Constraint and associated data elements, as client-side Java artifacts;
                </p>
            </li><li class="listitem">
                <p>Make it as easy to interoperate with RESTful Web services as JAX-RS makes it easy to build
                RESTful Web services; and
                </p>
            </li><li class="listitem">
                <p>Leverage artifacts of the JAX-RS API for the client side. Note that JAX-RS is currently a
                server-side only API.
                </p>
            </li></ol></div>
        <p>The Jersey Client API supports a pluggable architecture to enable the use of different underlying HTTP client
        implementations. Two such implementations are supported and leveraged: the 
        <code class="literal">Http(s)URLConnection</code> classes
        supplied with the JDK; and the Apache HTTP client.
        </p>
    </div>

    <div class="section" title="3.2.&nbsp;Uniform Interface Constraint"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e556"></a>3.2.&nbsp;Uniform Interface Constraint</h2></div></div></div>
        
        <p>The uniform interface constraint bounds the architecture of RESTful Web services so that a client, such
        as a browser, can utilize the same interface to communicate with any service. This is a very powerful concept
        in software engineering that makes Web-based search engines and service mash-ups possible. It induces properties
        such as:
        </p>
        <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
                <p>simplicity, the architecture is easier to understand and maintain; and</p>
            </li><li class="listitem">
                <p>modifiability or loose coupling, clients and services can evolve over time perhaps in new and
                unexpected ways, while retaining backwards compatibility.
                </p>
            </li></ol></div>
        <p>Further constraints are required:</p>
        <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
                <p>every resource is identified by a URI;</p>
            </li><li class="listitem">
                <p>a client interacts with the resource via HTTP requests and responses using a fixed set of
                HTTP methods;
                </p>
            </li><li class="listitem">
                <p>one or more representations can be retured and are identified by media types; and</p>
            </li><li class="listitem">
                <p>the contents of which can link to further resources.</p>
            </li></ol></div>
        <p>The above process repeated over and again should be familiar to anyone who has used a browser to fill
        in HTML forms and follow links. That same process is applicable to non-browser based clients.
        </p>
        <p>Many existing Java-based client APIs, such as the Apache HTTP client API or
            <code class="literal">java.net.HttpURLConnection</code>
        supplied with the JDK place too much focus on the Client-Server constraint for the exchanges of request and
        responses rather than a resource, identified by a URI, and the use of a fixed set of HTTP methods.
        </p>
        <p>A resource in the Jersey client API is an instance of the Java class
            <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/client/WebResource.html" target="_top">WebResource</a>,
            and encapsulates a URI. The fixed set of HTTP methods are methods on
            <code class="literal">WebResource</code>
            or if using the builder
            pattern (more on this later) are the last methods to be called when invoking an HTTP method on a resource.
            The representations are Java types, instances of which, may contain links that new instances of 
            <code class="literal">WebResource</code> may be created from.
        </p>
    </div>

    <div class="section" title="3.3.&nbsp;Ease of use and reusing JAX-RS artifacts"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e581"></a>3.3.&nbsp;Ease of use and reusing JAX-RS artifacts</h2></div></div></div>
        
        <p>Since a resource is represented as a Java type it makes it easy to configure, pass around and inject in
        ways that is not so intuitive or possible with other client-side APIs.
        </p>
        <p>The Jersey Client API reuses many aspects of the JAX-RS and the Jersey implementation such as:</p>
        <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
                <p>URI building using
                    <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.0/javax/ws/rs/core/UriBuilder.html" target="_top">UriBuilder</a> and
                    <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/uri/UriTemplate.html" target="_top">UriTemplate</a>
                    to safely build URIs;
                </p>
            </li><li class="listitem">
                <p>Support for Java types of representations such as
                    <code class="literal">byte[]</code>,
                    <code class="literal">String</code>,
                    <code class="literal">InputStream</code>,
                    <code class="literal">File</code>,
                    <code class="literal">DataSource</code>
                and JAXB beans in addition to Jersey specific features such as
                    <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/json/package-summary.html" target="_top">JSON</a> support and
                    <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/contribs/jersey-multipart/index.html" target="_top">MIME Multipart</a> support.
                </p>
            </li><li class="listitem">
                <p>Using the builder pattern to make it easier to construct requests.</p>
            </li></ol></div>
        <p>Some APIs, like the Apache HTTP client or
            <a class="ulink" href="http://java.sun.com/j2se/1.5.0/docs/api/java/net/HttpURLConnection.html" target="_top">java.net.HttpURLConnection</a>,
            can be rather hard to use and/or require too much code to do something relatively simple.
        </p>
        <p>This is why the Jersey Client API provides support for wrapping HttpURLConnection and the Apache
        HTTP client. Thus it is possible to get the benefits of the established implementations and features
        while getting the ease of use benefit.
        </p>
        <p>It is not intuitive to send a POST request with form parameters and receive a response as a
        JAXB object with such an API. For example with the Jersey API this is very easy:
        </p><div class="example"><a name="d4e605"></a><p class="title"><b>Example&nbsp;3.1.&nbsp;POST request with form parameters</b></p><div class="example-contents">
            
            <pre class="programlisting">&nbsp;&nbsp;1 Form f = new Form();
&nbsp;&nbsp;2 f.add(&#8220;x&#8221;, &#8220;foo&#8221;);
&nbsp;&nbsp;3 f.add(&#8220;y&#8221;, &#8220;bar&#8221;);
&nbsp;&nbsp;4 
&nbsp;&nbsp;5 Client c = Client.create();
&nbsp;&nbsp;6 WebResource r = c.resource(&#8220;http://localhost:8080/form&#8221;);
&nbsp;&nbsp;7 
&nbsp;&nbsp;8 JAXBBean bean = r.
&nbsp;&nbsp;9     type(MediaType.APPLICATION_FORM_URLENCODED_TYPE)
&nbsp;10     .accept(MediaType.APPLICATION_JSON_TYPE)
&nbsp;11     .post(JAXBBean.class, f);</pre>
        </div></div><p><br class="example-break">
        In the above code a
            <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/representation/Form.html" target="_top">Form</a> is created with two parameters, a new
            <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/client/WebResource.html" target="_top">WebResource</a> instance is created from a
            <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/client/Client.html" target="_top">Client</a> then the
            <code class="literal">Form</code> instance is <code class="literal">POST</code>ed to
            the resource, identified with the form media type, and the response is requested as an instance of a JAXB bean
            with an acceptable media type identifying the Java Script Object
            Notation (JSON) format. The Jersey client API manages the serialization of the <code class="literal">Form</code> instance to produce the
            request and de-serialization of the response to consume as an instance of a JAXB bean.
        </p>
        <p>If the code above was written using
            <code class="literal">HttpURLConnection</code> then the developer would have to write code to serialize the
        form sent in the POST request and de-serialize the response to the JAXB bean. In addition further code would have to be written
        to make it easy to reuse the same resource &#8220;http://localhost:8080/form&#8221; that is encapsulated in the 
            <code class="literal">WebResource</code> type.
        </p>
    </div>

    <div class="section" title="3.4.&nbsp;Getting started with the Jersey client"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e617"></a>3.4.&nbsp;Getting started with the Jersey client</h2></div></div></div>
        
        <p>Refer to the
            <a class="ulink" href="#chapter_deps" target="_top">dependencies chapter</a>,
            and specifically the <a class="ulink" href="#core_client" target="_top">Core client</a> section,
            for details on the dependencies when using the Jersey client with Maven and Ant.
        </p>
        <p>Refer to the
            <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/client/package-summary.html" target="_top">Java API documentation</a> for details on the Jersey client API packages and classes.
        </p>
        <p>Refer to the
            <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/contribs/jersey-apache-client/index.html" target="_top">Java API Apache HTTP client documentation</a> for details on how to use the Jersey client API with the Apache HTTP client.
        </p>
    </div>

    <div class="section" title="3.5.&nbsp;Overview of the API"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e626"></a>3.5.&nbsp;Overview of the API</h2></div></div></div>
        
        <p>To utilize the client API it is first necessary to create an instance of a
            <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/client/Client.html" target="_top">Client</a>, for example:
            </p><pre class="programlisting">    Client c = Client.create();</pre><p>
        </p>
        <div class="section" title="3.5.1.&nbsp;Configuring a Client and WebResource"><div class="titlepage"><div><div><h3 class="title"><a name="d4e631"></a>3.5.1.&nbsp;Configuring a Client and WebResource</h3></div></div></div>
            
            <p>The client instance can then be configured by setting properties on the map returned from
            the
                <code class="literal">getProperties</code> methods or by calling the specific setter methods,
            for example the following configures the client to perform automatic redirection for
            appropriate responses:
                </p><pre class="programlisting">    c.getProperties().put(
        ClientConfig.PROPERTY_FOLLOW_REDIRECTS, true);</pre><p>
            which is equivalent to the following:
                </p><pre class="programlisting">    c.setFollowRedirects(true);</pre><p>
            Alternatively it is possible to create a <code class="literal">Client</code> instance using a
                <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/client/config/ClientConfig.html" target="_top">ClientConfig</a>
            object for example:
                </p><pre class="programlisting">    ClientConfig cc = new DefaultClientConfig();
    cc.getProperties().put(
        ClientConfig.PROPERTY_FOLLOW_REDIRECTS, true);
    Client c = Client.create(cc);</pre><p>
            </p>
            <p>Once a client instance is created and configured it is then possible to obtain a
                <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/client/WebResource.html" target="_top">WebResource</a>
                instance, which will inherit the configuration declared on the client instance.
                For example, the following creates a reference to a Web resource with the URI
                &#8220;http://localhost:8080/xyz&#8221;:
                </p><pre class="programlisting">    WebResource r = c.resource(&#8220;http://localhost:8080/xyz&#8221;);</pre><p>
            and redirection will be configured for responses to requests invoked on the Web resource.
            </p>
            <p>
                <code class="literal">Client</code> instances are expensive resources. It is recommended a configured
            instance is reused for the creation of Web resources. The creation of Web resources, the building
            of requests and receiving of responses are guaranteed to be thread safe. Thus a
                <code class="literal">Client</code>
            instance and 
                <code class="literal">WebResource</code> instances may be shared between multiple threads.
            </p>
            <p>In the above cases a
                <code class="literal">WebResource</code> instance will utilize
                <code class="literal">HttpUrlConnection</code> or
                <code class="literal">HttpsUrlConnection</code>,
            if the URI scheme of the
                <code class="literal">WebResource</code> is &#8220;http&#8221; or &#8220;https&#8221; respectively.
            </p>
        </div>
        <div class="section" title="3.5.2.&nbsp;Building a request"><div class="titlepage"><div><div><h3 class="title"><a name="d4e652"></a>3.5.2.&nbsp;Building a request</h3></div></div></div>
            
            <p>Requests to a Web resource are built using the builder pattern (see
                <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/client/RequestBuilder.html" target="_top">RequestBuilder</a>)
                where the terminating method corresponds to an HTTP method (see
                <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/client/UniformInterface.html" target="_top">UniformInterface</a>).
                For example,
                </p><pre class="programlisting">    String response = r.accept(
        MediaType.APPLICATION_JSON_TYPE,
        MediaType.APPLICATION_XML_TYPE).
        header(&#8220;X-FOO&#8221;, &#8220;BAR&#8221;).
        get(String.class);</pre><p>
            </p>
            <p>The above sends a GET request with an
                <code class="literal">Accept</code> header of
                <code class="literal">application/json</code>,
                <code class="literal">application/xml</code> and a
            non-standard header 
                <code class="literal">X-FOO</code> of
                <code class="literal">BAR</code>.
            </p>
            <p>If the request has a request entity (or representation) then an instance
            of a Java type can be declared in the terminating HTTP method, for
                <code class="literal">PUT</code>,
                <code class="literal">POST</code> and
                <code class="literal">DELETE</code> requests.
            For example, the following sends a POST request:
                </p><pre class="programlisting">    String request = &#8220;content&#8221;;
    String response = r.accept(
        MediaType.APPLICATION_JSON_TYPE,
        MediaType.APPLICATION_XML_TYPE).
        header(&#8220;X-FOO&#8221;, &#8220;BAR&#8221;).
        post(String.class, request);</pre><p>
            where the String &#8220;content&#8221; will be serialized as the request
            entity (see the section &#8220;Java instances and types for representations&#8221;
            section for further details on the supported Java types). The
            <code class="literal">Content-Type</code> of the request entity may be declared
            using the <code class="literal">type</code> builder method as follows:
            </p><pre class="programlisting">    String response = r.accept(
         MediaType.APPLICATION_JSON_TYPE,
         MediaType.APPLICATION_XML_TYPE).
         header(&#8220;X-FOO&#8221;, &#8220;BAR&#8221;).
         type(MediaType.TEXT_PLAIN_TYPE).
         post(String.class, request);</pre><p>
            or alternatively the request entity and type may be declared
            using the entity method as follows:
            </p><pre class="programlisting">    String response = r.accept(
         MediaType.APPLICATION_JSON_TYPE,
         MediaType.APPLICATION_XML_TYPE).
         header(&#8220;X-FOO&#8221;, &#8220;BAR&#8221;).
         entity(request, MediaType.TEXT_PLAIN_TYPE).
         post(String.class);</pre><p>
            </p>
            </div>

            <div class="section" title="3.5.3.&nbsp;Receiving a response"><div class="titlepage"><div><div><h3 class="title"><a name="d4e673"></a>3.5.3.&nbsp;Receiving a response</h3></div></div></div>
                
                <p>If the response has a entity (or representation) then the 
                Java type of the instance required is declared in the terminating HTTP method.
                In the above examples a response entity is expected and an instance of <code class="literal">String</code>
                is requested. The response entity will be de-serialized to a String
                instance.</p>
                <p>If response meta-data is required then the Java type
                    <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/client/ClientResponse.html" target="_top">ClientResponse</a>
                    can be declared from which the response status, headers and entity may be obtained.
                    For example, the following gets both the entity tag and response entity from the
                    response:
                </p><pre class="programlisting">    ClientResponse response = r.get(ClientResponse.class);
    EntityTag e = response.getEntityTag();
    String entity = response.getEntity(String.class);</pre>
                <p>If the <code class="literal">ClientResponse</code> type is not utilized and the response
                status is greater than or equal to 300 then the runtime exception
                 <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/client/UniformInterfaceException.html" target="_top">UniformInterfaceException</a>
                 is thrown. This exception may be caught and the <code class="literal">ClientResponse</code> obtained as follows:
                </p><pre class="programlisting">    try {
        String entity = r.get(String.class);
    } catch (UniformInterfaceException ue) {
        ClientResponse response = ue.getResponse();
    }</pre>
            </div>

            <div class="section" title="3.5.4.&nbsp;Creating new WebResources from a WebResource"><div class="titlepage"><div><div><h3 class="title"><a name="d4e685"></a>3.5.4.&nbsp;Creating new WebResources from a WebResource</h3></div></div></div>
                
                <p>A new
                    <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/client/WebResource.html" target="_top">WebResource</a>
                    can be created from an existing <code class="literal">WebResource</code> by building from the latter's URI.
                    Thus it is possible to build the request URI before building the request. For example, the
                    following appends a new path segment and adds some query parameters:
                </p><pre class="programlisting">    WebResource r = c.resource(&#8220;http://localhost:8080/xyz&#8221;);

    MultivaluedMap&lt;String, String&gt; params = MultivaluedMapImpl();
    params.add(&#8220;foo&#8221;, &#8220;x&#8221;);
    params.add(&#8220;bar&#8221;, &#8220;y&#8221;);
    
    String response = r.path(&#8220;abc&#8221;).
        queryParams(params).
        get(String.class);</pre><p>
                that results in a GET request to the URI &#8220;http://localhost:8080/xyz/abc?foo=x&amp;bar=y&#8221;.</p>
            </div>
            
            <div class="section" title="3.5.5.&nbsp;Java instances and types for representations"><div class="titlepage"><div><div><h3 class="title"><a name="d4e691"></a>3.5.5.&nbsp;Java instances and types for representations</h3></div></div></div>
                
                <p>All the Java types for representations supported by the Jersey server side for 
                requests and responses are also supported on the client side. This includes the standard
                Java types as specified by JAX-RS in
                    <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.0/spec/index.html" target="_top">section 4.2.4</a>
                    in addition to JSON, Atom and Multipart MIME as supported by Jersey.
                </p>
                <p>To process a response entity (or representation) as a stream of bytes use InputStream as follows:
                </p><pre class="programlisting">    InputStream in = r.get(InputStream.class);
    // Read from the stream
    in.close();</pre><p>
                Note that it is important to close the stream after processing so that resources are freed up.</p>
                <p>To <code class="literal">POST</code> a file use <code class="literal">File</code> as follows:
                </p><pre class="programlisting">    File f = ...
    String response = r.post(String.class, f);</pre><p>
                Refer to the
                    <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.samples&amp;a=jaxb&amp;v=1.9&amp;c=project&amp;e=zip" target="_top">JAXB sample</a> to see how JAXB with XML and JSON can be utilized with the client API (more specifically, see the unit tests).
                </p>
            </div>
        </div>

        <div class="section" title="3.6.&nbsp;Adding support for new representations"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e702"></a>3.6.&nbsp;Adding support for new representations</h2></div></div></div>
            
            <p>The support for new application-defined representations as Java types requires the
            implementation of the same provider-based interfaces as for the server side JAX-RS API, namely
                <a class="ulink" href="http://jsr311.java.net/nonav/javadoc/javax/ws/rs/ext/MessageBodyReader.html" target="_top">MessageBodyReader</a> and
                <a class="ulink" href="http://jsr311.java.net/nonav/javadoc/javax/ws/rs/ext/MessageBodyWriter.html" target="_top">MessageBodyWriter</a>,
                respectively, for request and response entities (or inbound and outbound representations). Refer to the
                <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.samples&amp;a=entity-provider&amp;v=1.9&amp;c=project&amp;e=zip" target="_top">entity provider</a>
                sample for such implementations utilized on the server side.
            </p>
            <p>Classes or implementations of the provider-based interfaces need to be registered with a
            <code class="literal">ClientConfig</code> and passed to the <code class="literal">Client</code> for creation. The following
            registers a provider class <code class="literal">MyReader</code> which will be instantiated by Jersey:
            </p><pre class="programlisting">    ClientConfig cc = new DefaultClientConfig();
    cc.getClasses().add(MyReader.class);
    Client c = Client.create(cc);</pre><p>
            The following registers an instance or singleton of MyReader:
            </p><pre class="programlisting">    ClientConfig cc = new DefaultClientConfig();
    MyReader reader = ...
    cc.getSingletons().add(reader);
    Client c = Client.create(cc);</pre>
        </div>

        <div class="section" title="3.7.&nbsp;Using filters"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e714"></a>3.7.&nbsp;Using filters</h2></div></div></div>
            
            <p>Filtering requests and responses can provide useful functionality that is hidden from the
            application layer of building and sending requests, and processing responses. Filters can
            read/modify the request URI, headers and entity or read/modify the response status,
            headers and entity.</p>
            <p>
            The <code class="literal">Client</code> and <code class="literal">WebResource</code> classes extend from
            <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/client/filter/Filterable.html" target="_top">Filterable</a>
            and that enables the addition of
            <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/client/filter/ClientFilter.html" target="_top">ClientFilter</a>
            instances. A <code class="literal">WebResource</code> will inherit filters from its creator, which
            can be a <code class="literal">Client</code> or another <code class="literal">WebResource</code>.
            Additional filters can be added to a <code class="literal">WebResource</code> after it has been
            created. For requests, filters are applied in order, starting with inherited filters
            and followed by the filters added to the <code class="literal">WebResource</code>. All filters
            are applied in the order in which they were added. For responses, filters are applied
            in reverse order, starting with the <code class="literal">WebResource</code> filters and then
            moving to the inherited filters.
            For instance, in the following example the <code class="literal">Client</code> has two filters added,
            <code class="literal">filter1</code> and <code class="literal">filter2</code>, in that order, and the
            <code class="literal">WebResource</code> has one filter added, <code class="literal">filter3</code>:
            </p><pre class="programlisting">    ClientFilter filter1 = ...
    ClientFilter filter2 = ...
    Client c = Client.create();
    c.addFilter(filter1);
    c.addFilter(filter2);
    
    ClientFilter filter3 = ...
    WebResource r = c.resource(...);
    r.addFilter(filter3);</pre><p>
            After a request has been built the request is filtered by <code class="literal">filter1</code>,
            <code class="literal">filter2</code> and <code class="literal">filter3</code> in that order. After the response
            has been received the response is filtered by <code class="literal">filter3</code>,
            <code class="literal">filter2</code> and <code class="literal">filter1</code> in that order, before the
            response is returned.</p>
            <p>Filters are implemented using the &#8220;russian doll&#8221; stack-based pattern where a
            filter is responsible for calling the next filter in the ordered list of filters
            (or the next filter in the &#8220;chain&#8221; of filters).
            The basic template for a filter is as follows:
            </p><pre class="programlisting">    class AppClientFilter extends ClientFilter {
        public ClientResponse handle(ClientRequest cr) {
            // Modify the request
            ClientRequest mcr = modifyRequest(cr);
            // Call the next filter
            ClientResponse resp = getNext().handle(mcr);
            // Modify the response
            return modifyResponse(resp);
        }
    }</pre>
            <p>The filter modifies the request (if required) by creating a new
            <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/client/ClientRequest.html" target="_top">ClientRequest</a>
            or modifying the state of the passed <code class="literal">ClientRequest</code> before calling the
            next filter. The call to the next request will return
            the response, a <code class="literal">ClientResponse</code>. The filter
            modifies the response (if required) by creating a new <code class="literal">ClientResponse</code>
            or modifying the state of the returned <code class="literal">ClientResponse</code>.
            Then the filter returns the modified response.
            Filters are re-entrant and may be called by multiple threads performing requests
            and processing responses.</p>
            <div class="section" title="3.7.1.&nbsp;Supported filters"><div class="titlepage"><div><div><h3 class="title"><a name="d4e748"></a>3.7.1.&nbsp;Supported filters</h3></div></div></div>
                
                <p>The Jersey Client API currently supports two filters:</p>
                <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
                        <p>A GZIP content encoding filter,
                            <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/client/filter/GZIPContentEncodingFilter.html" target="_top">GZIPContentEncodingFilter</a>.
                            If this filter is added then a request entity is compressed with the
                            <code class="literal">Content-Encoding</code>
                            of <code class="literal">gzip</code>, and a response entity if compressed with a
                            <code class="literal">Content-Encoding</code> of <code class="literal">gzip</code> is
                            decompressed. The filter declares an <code class="literal">Accept-Encoding</code>
                            of <code class="literal">gzip</code>.
                        </p>
                    </li><li class="listitem">
                        <p>A logging filter,
                            <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/client/filter/LoggingFilter.html" target="_top">LoggingFilter</a>.
                            If this filter is added then the request and response headers as well as the entities are logged
                            to a declared output stream if present, or to <code class="literal">System.out</code> if not.
                            Often this filter will be placed at the end of the ordered list of
                            filters to log the request before it is sent
                            and the response after it is received.
                        </p>
                    </li></ol></div>
                <p>The filters above are good examples that show how to modify or read
                request and response entities. Refer to the
                    <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-client&amp;v=1.9&amp;e=jar" target="_top">source code</a>
                    of the Jersey client for more details.
                </p>
            </div>
        </div>

        <div class="section" title="3.8.&nbsp;Testing services"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e767"></a>3.8.&nbsp;Testing services</h2></div></div></div>
            
            <p>The Jersey client API was originally developed to aid the testing of the Jersey server-side, 
            primarily to make it easier to write functional tests in conjunction with the JUnit framework
            for execution and reporting. It is used extensively and there are currently over 1000 tests.</p>
            <p>Embedded servers, Grizzly and a special in-memory server, are utilized to deploy the
            test-based services. Many of the Jersey samples contain tests that utilize the client API to
            server both for testing and examples of how to use the API. The samples utilize Grizzly or
            embedded Glassfish to deploy the services.</p>
            <p>The following code snippets are presented from the single unit test
            <code class="literal">HelloWorldWebAppTest</code> of the
                <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.samples&amp;a=helloworld-webapp&amp;v=1.9&amp;c=project&amp;e=zip" target="_top">helloworld-webapp</a>
                sample.
            The <code class="literal">setUp</code> method, called before a test is executed, creates an instance of
            the Glassfish server, deploys the application, and a <code class="literal">WebResource</code> instance
            that references the base resource:
            </p><pre class="programlisting">    @Override
    protected void setUp() throws Exception {
        super.setUp();

        // Start Glassfish
        glassfish = new GlassFish(BASE_URI.getPort());
        
        // Deploy Glassfish referencing the web.xml
        ScatteredWar war = new ScatteredWar(
            BASE_URI.getRawPath(), new File("src/main/webapp"),
            new File("src/main/webapp/WEB-INF/web.xml"),
            Collections.singleton(
                new File("target/classes").
                    toURI().toURL()));
        glassfish.deploy(war);
        
        Client c = Client.create();
        r = c.resource(BASE_URI);
    }</pre><p>
            The <code class="literal">tearDown</code> method, called after a test is executed,
            stops the Glassfish server.
            </p><pre class="programlisting">    @Override
   protected void tearDown() throws Exception {
        super.tearDown();
        glassfish.stop();
   }</pre>
            <p>The <code class="literal">testHelloWorld</code> method tests that the response
            to a <code class="literal">GET</code> request to the Web resource returns &#8220;Hello World&#8221;:
            </p><pre class="programlisting">    public void testHelloWorld() throws Exception {
       String responseMsg = r.path("helloworld").
           get(String.class);
       assertEquals("Hello World", responseMsg);
   }</pre><p>
            Note the use of the <code class="literal">path</code> method on the <code class="literal">WebResource</code> to
            build from the base <code class="literal">WebResource</code>.</p>
        </div>

        <div class="section" title="3.9.&nbsp;Security with Http(s)URLConnection"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e786"></a>3.9.&nbsp;Security with Http(s)URLConnection</h2></div></div></div>
            
            <div class="section" title="3.9.1.&nbsp;With Http(s)URLConnection"><div class="titlepage"><div><div><h3 class="title"><a name="d4e788"></a>3.9.1.&nbsp;With Http(s)URLConnection</h3></div></div></div>
            
            <p>The support for security, specifically HTTP authentication and/or cookie management 
            with <code class="literal">Http(s)URLConnection</code> is limited due to constraints in the API.
            There are currently no specific features or properties on the <code class="literal">Client</code> class that
            can be set to support HTTP authentication. However, since the client API, by default, utilizes
            <code class="literal">HttpURLConnection</code> or <code class="literal">HttpsURLConnection</code>,
            it is possible to configure system-wide
            security settings (which is obviously not sufficient for multiple client configurations).</p>
            <p>For HTTP authentication the <code class="literal">java.net.Authenticator</code> can
            be extended and statically registered. Refer to the
                <a class="ulink" href="http://java.sun.com/javase/6/docs/technotes/guides/net/http-auth.html" target="_top">Http authentication</a>
                document for more details.
            For cookie management the <code class="literal">java.net.CookieHandler</code> can be extended
            and statically registered. Refer to the
                <a class="ulink" href="http://java.sun.com/javase/6/docs/technotes/guides/net/http-cookie.html" target="_top">Cookie Management</a>
                document for more details.
            </p>
            <p>To utilize HTTP with SSL it is necessary to utilize the &#8220;https&#8221; scheme.
            For certificate-based authentication see the class
                <a class="ulink" href="http://jersey.java.net/nonav/apidocs/latest/jersey/com/sun/jersey/client/urlconnection/HTTPSProperties.html" target="_top">HTTPSProperties</a>
                for how to set <code class="literal">javax.net.ssl.HostnameVerifier</code> and
                <code class="literal">javax.net.ssl.SSLContext</code>.
            </p>
            </div>
            <div class="section" title="3.9.2.&nbsp;With Apache HTTP client"><div class="titlepage"><div><div><h3 class="title"><a name="d4e804"></a>3.9.2.&nbsp;With Apache HTTP client</h3></div></div></div>
            
            <p>The support for HTTP authentication and cookies is much better with the Apache HTTP 
            client than with <code class="literal">HttpURLConnection</code>.
            See the Java documentation for the package
                <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/contribs/jersey-apache-client/com/sun/jersey/client/apache/package-summary.html" target="_top">com.sun.jersey.client.apache</a>,
                <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/contribs/jersey-apache-client/com/sun/jersey/client/apache/config/ApacheHttpClientState.html" target="_top">ApacheHttpClientState</a> and
                <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/contribs/jersey-apache-client/com/sun/jersey/client/apache/config/ApacheHttpClientConfig.html" target="_top">ApacheHttpClientConfig</a> for more details.
            </p>
            </div>
        </div>
    </div>
  <div class="chapter" title="Chapter&nbsp;4.&nbsp;XML Support"><div class="titlepage"><div><div><h2 class="title"><a name="xml"></a>Chapter&nbsp;4.&nbsp;XML Support</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d4e814">4.1. Low level XML support</a></span></dt><dt><span class="section"><a href="#d4e828">4.2. Getting started with JAXB</a></span></dt><dt><span class="section"><a href="#d4e857">4.3. POJOs</a></span></dt><dt><span class="section"><a href="#d4e873">4.4. Using custom JAXBContext</a></span></dt></dl></div>

    

    <p>As you probably already know, Jersey uses MessageBodyWriters and MessageBodyReaders to parse
        incoming request and create outgoing responses. Every user can create its own representation but...
        this is not recommended way how to do things. XML is proven standard for interchanging information,
        especially in web services. Jerseys supports low level data types used for direct manipulation and
        JAXB XML entities.</p>

    <div class="section" title="4.1.&nbsp;Low level XML support"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e814"></a>4.1.&nbsp;Low level XML support</h2></div></div></div>
        

        <p>Jersey currently support several low level data types: <code class="code">StreamSource</code>, <code class="code">SAXSource</code>,
            <code class="code">DOMSource</code> and <code class="code">Document</code>. You can use these types as return type or method (resource)
            parameter. Lets say we want to test this feature and we have helloworld sample as starting point. All we
            need to do is add methods (resources) which consumes and produces XML and types mentioned above will
            be used.</p>

        <div class="example"><a name="d4e821"></a><p class="title"><b>Example&nbsp;4.1.&nbsp;Low level XML test - methods added to HelloWorldResource.java</b></p><div class="example-contents">
            
            <pre class="programlisting">&nbsp;&nbsp;1     @Path("1")
&nbsp;&nbsp;2     @POST
&nbsp;&nbsp;3     public StreamSource get1(StreamSource streamSource) {
&nbsp;&nbsp;4         return streamSource;
&nbsp;&nbsp;5     }
&nbsp;&nbsp;6 
&nbsp;&nbsp;7     @Path("2")
&nbsp;&nbsp;8     @POST
&nbsp;&nbsp;9     public SAXSource get2(SAXSource saxSource) {
&nbsp;10         return saxSource;
&nbsp;11     }
&nbsp;12 
&nbsp;13     @Path("3")
&nbsp;14     @POST
&nbsp;15     public DOMSource get3(DOMSource domSource) {
&nbsp;16         return domSource;
&nbsp;17     }
&nbsp;18 
&nbsp;19     @Path("4")
&nbsp;20     @POST
&nbsp;21     public Document get4(Document document) {
&nbsp;22         return document;
&nbsp;23     }</pre>
        </div></div><br class="example-break">

        <p>Both MessageBodyReaders and MessageBodyWriters are used in this case, all we need is do POST request
            with some XML document as a request entity. I want to keep this as simple as possible so I'm going to
            send only root element with no content: <code class="code">"&lt;test /&gt;"</code>. You can create Jersey client to
            do that or use some other tool, for example <code class="code">curl</code> as I did. (<code class="code">curl -v http://localhost:9998/helloworld/1 -d "&lt;test /&gt;"</code>).
            You should get exactly same XML from our service as is present in the request; in this case, XML headers
            are added to response but content stays. Feel free to iterate through all resources.</p>

    </div>

    <div class="section" title="4.2.&nbsp;Getting started with JAXB"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e828"></a>4.2.&nbsp;Getting started with JAXB</h2></div></div></div>
        

        <p>Good start for people which already have some experience with JAXB annotations is JAXB sample.
            You can see various usecases there. This text is mainly meant for those who don't have prior experience
            with JAXB. Don't expect that all possible annotations and their combinations
            will be covered in this chapter, <a class="ulink" href="http://jaxb.java.net" target="_top">JAXB (JSR 222 implementation)</a> is pretty complex and comprehensive. But if
            you just want to know how you can interchange XML messages with your REST service, you are looking
            at right chapter.</p>

        <p>Lets start with simple example. Lets say we have class <code class="code">Planet</code> and service
        which produces "Planets"</p>

        <div class="example"><a name="d4e834"></a><p class="title"><b>Example&nbsp;4.2.&nbsp;Planet class</b></p><div class="example-contents">
            
            <pre class="programlisting">&nbsp;&nbsp;1 @XmlRootElement
&nbsp;&nbsp;2 public class Planet {
&nbsp;&nbsp;3     public int id;
&nbsp;&nbsp;4     public String name;
&nbsp;&nbsp;5     public double radius;
&nbsp;&nbsp;6 }
&nbsp;&nbsp;7             </pre>
        </div></div><br class="example-break">

        <div class="example"><a name="d4e837"></a><p class="title"><b>Example&nbsp;4.3.&nbsp;Resource class</b></p><div class="example-contents">
            
            <pre class="programlisting">&nbsp;&nbsp;1 @Path("planet")
&nbsp;&nbsp;2 public class Resource {
&nbsp;&nbsp;3 
&nbsp;&nbsp;4     @GET
&nbsp;&nbsp;5     @Produces(MediaType.APPLICATION_XML)
&nbsp;&nbsp;6     public Planet getPlanet() {
&nbsp;&nbsp;7         Planet p = new Planet();
&nbsp;&nbsp;8         p.id = 1;
&nbsp;&nbsp;9         p.name = "Earth";
&nbsp;10         p.radius = 1.0;
&nbsp;11 
&nbsp;12         return p;
&nbsp;13     }
&nbsp;14 }            </pre>
        </div></div><br class="example-break">

        <p>You can see there is some extra annotation declared on <code class="code">Planet</code> class.
        Concretely <code class="code">XmlRootelement</code>. What it does? This is a JAXB annotation which
        maps java class to XML element. We don't need specify anything else, because <code class="code">Planet</code>
        is very simple class and all fields are public. In this case, XML element name will be derived
        from class name or you can set name property: <code class="code">@XmlRootElement(name="yourName")</code>.</p>

        <p>Our resource class will respond to GET /planet with
            </p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
                &lt;planet&gt;
                        &lt;id&gt;1&lt;/id&gt;
                        &lt;name&gt;Earth&lt;/name&gt;
                        &lt;radius&gt;1.0&lt;/radius&gt;
                &lt;/planet&gt;
            </pre><p>

            which might be exactly what we want... or not. Or we might not really care, because we
            can use Jersey client for making requests to this resource and this is easy as:
            <code class="code">Planet planet = webResource.path("planet").accept(MediaType.APPLICATION_XML_TYPE).get(Planet.class);</code>.
            There is pre-created WebResource object which points to our applications context root and
            we simpli add path (in our clase its "planet"), accept header (not mandatory, but service could
            provide different content based on this header; for example text/html can be served for web browsers) and
            at the end we specify that we are expecting <code class="code">Planet</code> class via GET request.</p>

            <p>There may be need for not just producing XML, we might want to consume it as well.

                </p><div class="example"><a name="d4e850"></a><p class="title"><b>Example&nbsp;4.4.&nbsp;Method for consuming Planet</b></p><div class="example-contents">
                    
                    <pre class="programlisting">&nbsp;&nbsp;1     @POST
&nbsp;&nbsp;2     @Consumes(MediaType.APPLICATION_XML)
&nbsp;&nbsp;3     public void setPlanet(Planet p) {
&nbsp;&nbsp;4         System.out.println("setPlanet " + p);
&nbsp;&nbsp;5     }
&nbsp;&nbsp;6                     </pre>
                </div></div><p><br class="example-break">

           After valid request is made (with Jersey client you can do <code class="code">webResource.path("planet").post(p);</code>),
           service will print out string representation of Planet, which can look like <code class="literal">Planet{id=2, name='Mars', radius=1.51}</code>.
           </p>

        <p>If there is a need for some other (non default) XML representation, other JAXB annotations would
        need to be used. This process is usually simplified by generating java source from XML Schema which is
        done by xjc. Xjc is XML to java compiler and is part of JAXB. See <a class="ulink" href="http://jaxb.java.net" target="_top">JAXB home page</a>
        for further details.</p>
    </div>

    <div class="section" title="4.3.&nbsp;POJOs"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e857"></a>4.3.&nbsp;POJOs</h2></div></div></div>
        

        <p>Sometimes you can't / don't want to add JAXB annotations to source code and you still want
        to have resources consuming and producing XML representation of your classes. In this case, <code class="code">JAXBElement</code>
        class should help you. Let's redo planet resource but this time we won't have <code class="code">XmlRootElement</code>
        annotation on <code class="code">Planet</code> class.</p>

        <div class="example"><a name="d4e863"></a><p class="title"><b>Example&nbsp;4.5.&nbsp;Resource class - JAXBElement</b></p><div class="example-contents">
            
            <pre class="programlisting">&nbsp;&nbsp;1 @Path("planet")
&nbsp;&nbsp;2 public class Resource {
&nbsp;&nbsp;3 
&nbsp;&nbsp;4     @GET
&nbsp;&nbsp;5     @Produces(MediaType.APPLICATION_XML)
&nbsp;&nbsp;6     public JAXBElement&lt;Planet&gt; getPlanet() {
&nbsp;&nbsp;7         Planet p = new Planet();
&nbsp;&nbsp;8         p.id = 1;
&nbsp;&nbsp;9         p.name = "Earth";
&nbsp;10         p.radius = 1.0;
&nbsp;11 
&nbsp;12         return new JAXBElement&lt;Planet&gt;(new QName("planet"), Planet.class, p);
&nbsp;13     }
&nbsp;14 
&nbsp;15     @POST
&nbsp;16     @Consumes(MediaType.APPLICATION_XML)
&nbsp;17     public void setPlanet(JAXBElement&lt;Planet&gt; p) {
&nbsp;18         System.out.println("setPlanet " + p.getValue());
&nbsp;19     }
&nbsp;20 }            </pre>
        </div></div><br class="example-break">

        <p>As you can see, everything is little more complicated with JAXBElement. This is because now you need
        to explicitly set element name for <code class="code">Planet</code> class XML representation. Client side is even more ugly
        than server side because you can't do <code class="code">JAXBElement&lt;Planet&gt;.class</code> so Jersey client
        API provides way how to workaround it by declaring subclass of <code class="code">GenericType</code>.</p>

        <div class="example"><a name="d4e870"></a><p class="title"><b>Example&nbsp;4.6.&nbsp;Client side - JAXBElement</b></p><div class="example-contents">
            
            <pre class="programlisting">&nbsp;&nbsp;1         // GET
&nbsp;&nbsp;2         GenericType&lt;JAXBElement&lt;Planet&gt;&gt; planetType = new GenericType&lt;JAXBElement&lt;Planet&gt;&gt;() {};
&nbsp;&nbsp;3 
&nbsp;&nbsp;4         Planet planet = (Planet) webResource.path("planet").accept(MediaType.APPLICATION_XML_TYPE).get(planetType).getValue();
&nbsp;&nbsp;5         System.out.println("### " + planet);
&nbsp;&nbsp;6 
&nbsp;&nbsp;7         // POST
&nbsp;&nbsp;8         Planet p = new Planet();
&nbsp;&nbsp;9         // ...
&nbsp;10 
&nbsp;11         webResource.path("planet").post(new JAXBElement&lt;Planet&gt;(new QName("planet"), Planet.class, p));           </pre>
        </div></div><br class="example-break">

    </div>

    <div class="section" title="4.4.&nbsp;Using custom JAXBContext"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e873"></a>4.4.&nbsp;Using custom JAXBContext</h2></div></div></div>
        

        <p>In some scenarios you can take advantage of using custom <code class="code">JAXBContext</code>. Creating
            <code class="code">JAXBContext</code> is expensive operation and if you already have one created, same instance
        can be used by Jersey. Other possible usecase for this is when you need to set some specific things
        to JAXBContext, for example set different classloader.</p>

        <div class="example"><a name="d4e878"></a><p class="title"><b>Example&nbsp;4.7.&nbsp;PlanetJAXBContextProvider</b></p><div class="example-contents">
            
            <pre class="programlisting">&nbsp;&nbsp;1 @Provider
&nbsp;&nbsp;2 public class PlanetJAXBContextProvider implements ContextResolver&lt;JAXBContext&gt; {
&nbsp;&nbsp;3     private JAXBContext context = null;
&nbsp;&nbsp;4 
&nbsp;&nbsp;5     public JAXBContext getContext(Class&lt;?&gt; type) {
&nbsp;&nbsp;6         if(type != Planet.class)
&nbsp;&nbsp;7             return null; // we don't support nothing else than Planet
&nbsp;&nbsp;8 
&nbsp;&nbsp;9         if(context == null) {
&nbsp;10             try {
&nbsp;11                 context = JAXBContext.newInstance(Planet.class);
&nbsp;12             } catch (JAXBException e) {
&nbsp;13                 // log warning/error; null will be returned which indicates that this
&nbsp;14                 // provider won't/can't be used.
&nbsp;15             }
&nbsp;16         }
&nbsp;17         return context;
&nbsp;18     }
&nbsp;19 }
&nbsp;20         </pre>
        </div></div><br class="example-break">

        <p>Sample above shows simple <code class="code">JAXBContext</code> creation, all you need to do is put
        this <code class="code">@Provider</code> annotated class somewhere where Jersey can find it. Users sometimes
        have problems with using provider classes on client side, so just for reminder - you have to
        declare them in client config (cliend does not anything like package scanning done by server).</p>

        <div class="example"><a name="d4e884"></a><p class="title"><b>Example&nbsp;4.8.&nbsp;Using Provider with Jersey client</b></p><div class="example-contents">
            
            <pre class="programlisting">&nbsp;&nbsp;1                 ClientConfig cc = new DefaultClientConfig();
&nbsp;&nbsp;2                 cc.getClasses().add(PlanetJAXBContextProvider.class);
&nbsp;&nbsp;3                 Client c = Client.create(cc);
&nbsp;&nbsp;4             </pre>
        </div></div><br class="example-break">
    </div>
</div>
  <div class="chapter" title="Chapter&nbsp;5.&nbsp;JSON Support"><div class="titlepage"><div><div><h2 class="title"><a name="json"></a>Chapter&nbsp;5.&nbsp;JSON Support</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d4e903">5.1. POJO support</a></span></dt><dt><span class="section"><a href="#d4e921">5.2. JAXB Based JSON support</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e936">5.2.1. Configuration Options</a></span></dt><dt><span class="section"><a href="#d4e957">5.2.2. JSON Notations</a></span></dt><dt><span class="section"><a href="#d4e1127">5.2.3. Examples</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e1132">5.3. Low-Level JSON support</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1146">5.3.1. Examples</a></span></dt></dl></dd></dl></div>
  

  <p>Jersey JSON support comes as a set of JAX-RS <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/ext/MessageBodyReader.html" target="_top">MessageBodyReader&lt;T&gt;</a> and <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/ext/MessageBodyWriter.html" target="_top">MessageBodyWriter&lt;T&gt;</a>
  providers distributed with <span class="emphasis"><em>jersey-json</em></span> module. These providers enable using
  three basic approaches when working with JSON format:

  </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
      <p><a class="link" href="#json.pojo.approach.title">POJO support</a></p>
    </li><li class="listitem">
      <p><a class="link" href="#json.jaxb.approach.title">JAXB based JSON support</a></p>
    </li><li class="listitem">
      <p><a class="link" href="#json.low.level.approach.title">Low-level, JSONObject/JSONArray based JSON support</a></p>
    </li></ul></div><p>
  
  The first method is pretty generic and allows you to map any Java Object to JSON and vice versa. 
  The other two approaches limit you in Java types your resource methods could produce and/or consume.
  JAXB based approach could be taken if you want to utilize certain JAXB features.
  The last, low-level, approach gives you the best fine-grained control over the outcoming JSON data format.
  </p>

  <div class="section" title="5.1.&nbsp;POJO support"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e903"></a>5.1.&nbsp;POJO support</h2></div></div></div>
    
    <p>
    POJO suppport represents the easiest way to convert your Java Objects to JSON and back.
    It is based on the <a class="ulink" href="http://jackson.codehaus.org/" target="_top">Jackson library</a>.
    </p>
    <p>
    To use this approach, you will need to turn the <span class="emphasis"><em>JSONConfiguration.FEATURE_POJO_MAPPING</em></span> feature on.
    This could be done in <code class="code">web.xml</code> using the following servlet init parameter:
</p><div class="example"><a name="d4e910"></a><p class="title"><b>Example&nbsp;5.1.&nbsp;POJO JSON support web.xml configuration</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1         &lt;init-param&gt;
&nbsp;&nbsp;2             &lt;param-name&gt;com.sun.jersey.api.json.POJOMappingFeature&lt;/param-name&gt;
&nbsp;&nbsp;3             &lt;param-value&gt;true&lt;/param-value&gt;
&nbsp;&nbsp;4         &lt;/init-param&gt;</pre>
</div></div><p><br class="example-break">
</p>

<p>
The following snippet shows how to use the POJO mapping feature on the client side:
</p><div class="example"><a name="d4e914"></a><p class="title"><b>Example&nbsp;5.2.&nbsp;POJO JSON support client configuration</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1   ClientConfig clientConfig = new DefaultClientConfig();
&nbsp;&nbsp;2   clientConfig.getFeatures().put(JSONConfiguration.FEATURE_POJO_MAPPING, Boolean.TRUE);
&nbsp;&nbsp;3   Client client = Client.create(clientConfig);</pre>
</div></div><p><br class="example-break">
</p>

<p>
Jackson JSON processor could be futher controlled via providing custom Jackson <a class="ulink" href="http://jackson.codehaus.org/1.7.0/javadoc/org/codehaus/jackson/map/ObjectMapper.html" target="_top">ObjectMapper</a> instance.
This could be handy if you need to redefine the default Jackson behaviour and to fine-tune how your JSON data structures look like.
Detailed description of all Jackson features is out of scope of this guide. The example bellow gives you a hint on how to wire
your ObjectMapper instance into your Jersey application.
</p>

<p>Download <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.samples&amp;a=jacksonjsonprovider&amp;v=1.9&amp;c=project&amp;e=zip" target="_top">https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.samples&amp;a=jacksonjsonprovider&amp;v=1.9&amp;c=project&amp;e=zip</a>
   to get a complete example using POJO based JSON support.
    </p>

  </div>

  <div class="section" title="5.2.&nbsp;JAXB Based JSON support"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e921"></a>5.2.&nbsp;JAXB Based JSON support</h2></div></div></div>
    

    <p>
     Taking this approach will save you a lot of time, if you want to easily produce/consume both JSON and XML data format.
     Because even then you will still be able to use a unified Java model.
     Another advantage is simplicity of working with such a model, as JAXB leverages annotated POJOs and these could be handled
     as simple Java beans
    </p>
    <p>
     A disadvantage of JAXB based approach could be if you need to work with a very specific JSON format. Then it could be
     difficult to find a proper way to get such a format produced and consumed. This is a reason why a lot of configuration options
     are provided, so that you can control how things get serialized out and deserialized back.
    </p>
    
    <p>
    Following is a very simple example of how a JAXB bean could look like.
</p><div class="example"><a name="d4e926"></a><p class="title"><b>Example&nbsp;5.3.&nbsp;Simple JAXB bean implementation</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @XmlRootElement
&nbsp;&nbsp;2 public class MyJaxbBean {
&nbsp;&nbsp;3   public String name;
&nbsp;&nbsp;4   public int age;
&nbsp;&nbsp;5       
&nbsp;&nbsp;6   public MyJaxbBean() {} // JAXB needs this
&nbsp;&nbsp;7 
&nbsp;&nbsp;8   public MyJaxbBean(String name, int age) {
&nbsp;&nbsp;9     this.name = name;
&nbsp;10     this.age = age;
&nbsp;11   }
&nbsp;12 }</pre>
</div></div><p><br class="example-break">
    
    Using the above JAXB bean for producing JSON data format from you resource method, is then as simple as:
    
</p><div class="example"><a name="d4e929"></a><p class="title"><b>Example&nbsp;5.4.&nbsp;JAXB bean used to generate JSON representation</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @GET @Produces(<span class="emphasis"><em>"application/json"</em></span>)
&nbsp;&nbsp;2 public <span class="emphasis"><em>MyJaxbBean</em></span> getMyBean() {
&nbsp;&nbsp;3    return <span class="emphasis"><em>new MyJaxbBean("Agamemnon", 32)</em></span>;
&nbsp;&nbsp;4 }</pre>
</div></div><p><br class="example-break">
    
    Notice, that JSON specific mime type is specified in @Produces annotation, and the method returns an instance
    of MyJaxbBean, which JAXB is able to process. Resulting JSON in this case would look like:
    
</p><pre class="programlisting">
    {"name":"Agamemnon", "age":"32"}
</pre><p>
    </p>
    
    <div class="section" title="5.2.1.&nbsp;Configuration Options"><div class="titlepage"><div><div><h3 class="title"><a name="d4e936"></a>5.2.1.&nbsp;Configuration Options</h3></div></div></div>
    	
	
	<p>
	JAXB itself enables you to control output JSON format to certain extent. Specifically renaming 
	and ommiting items is easy to do directly using JAXB annotations.
	
	E.g. the following example depicts changes in the above mentioned MyJaxbBean that will result in <code class="code">{"king":"Agamemnon"}</code> JSON output.
</p><div class="example"><a name="d4e940"></a><p class="title"><b>Example&nbsp;5.5.&nbsp;Tweaking JSON format using JAXB</b></p><div class="example-contents">

<pre class="programlisting">&nbsp;&nbsp;1 @XmlRootElement
&nbsp;&nbsp;2 public class MyJaxbBean {
&nbsp;&nbsp;3   
&nbsp;&nbsp;4     @XmlElement(name="king")
&nbsp;&nbsp;5     public String name;
&nbsp;&nbsp;6   
&nbsp;&nbsp;7     @XmlTransient
&nbsp;&nbsp;8     public int age;
&nbsp;&nbsp;9  
&nbsp;10     // several lines removed       
&nbsp;11 }</pre>
</div></div><p><br class="example-break">
	</p>
	
	<p>
	To achieve more important JSON format changes, you will need to configure Jersey JSON procesor itself.
	Various configuration options could be set on  an
	<a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/json/JSONConfiguration.html" target="_top">JSONConfiguration</a>
	instance. The instance could be then further used to create a JSONConfigurated 
	<a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/json/JSONJAXBContext.html" target="_top">JSONJAXBContext</a>,
	which serves as a main configuration point in this area.
	To pass your specialized JSONJAXBContext to Jersey, you will finally need to implement 
	a JAXBContext <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/ext/ContextResolver.html" target="_top">ContextResolver&lt;T&gt;</a>:</p>
	
	<div class="example"><a name="json.jaxb.context.resolver.example"></a><p class="title"><b>Example&nbsp;5.6.&nbsp;An example of a JAXBContext resolver implementation</b></p><div class="example-contents">
	
	<pre class="programlisting">&nbsp;&nbsp;1 @Provider
&nbsp;&nbsp;2 public class JAXBContextResolver implements ContextResolver&lt;JAXBContext&gt; {
&nbsp;&nbsp;3 
&nbsp;&nbsp;4     private JAXBContext context;
&nbsp;&nbsp;5     private Class[] types = {MyJaxbBean.class};
&nbsp;&nbsp;6 
&nbsp;&nbsp;7     public JAXBContextResolver() throws Exception {
&nbsp;&nbsp;8         this.context = 
&nbsp;&nbsp;9 	  new JSONJAXBContext( <a name="json.ctx.resolver.init"></a>(1)
&nbsp;10 	    JSONConfiguration.natural().build(), types); <a name="json.ctx.resolver.config"></a>(2)
&nbsp;11     }
&nbsp;12 
&nbsp;13     public JAXBContext getContext(Class&lt;?&gt; objectType) {
&nbsp;14         for (Class type : types) {
&nbsp;15             if (type == objectType) {
&nbsp;16                 return context;
&nbsp;17             }
&nbsp;18         }
&nbsp;19         return null;
&nbsp;20     }
&nbsp;21 }</pre>
	<div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#json.ctx.resolver.init">(1)</a> </p></td><td valign="top" align="left">
	 	<p>Creation of our specialized JAXBContext</p> 
	</td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#json.ctx.resolver.config">(2)</a> </p></td><td valign="top" align="left">
	 	<p>Final JSON format is given by this JSONConfiguration instance</p> 
	</td></tr></table></div>
	</div></div><br class="example-break">
    </div>
    
    <div class="section" title="5.2.2.&nbsp;JSON Notations"><div class="titlepage"><div><div><h3 class="title"><a name="d4e957"></a>5.2.2.&nbsp;JSON Notations</h3></div></div></div>
     
     <p>
      JSONConfiguration allows you to use four various JSON notations. Each of these notations serializes JSON in a different way.
      Following is a list of supported notations:

      </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
      <p>MAPPED (default notation)</p>
    </li><li class="listitem">
      <p>NATURAL</p>
    </li><li class="listitem">
      <p>JETTISON_MAPPED</p>
    </li><li class="listitem">
      <p>BADGERFISH</p>
    </li></ul></div><p>
      </p>
      
      <p>
      Individual notations and their further configuration options are described bellow. Rather then explaining rules for mapping
      XML constructs into JSON, the notations will be described using a simple example. Following are JAXB beans, which will be used.
      
      </p><div class="example"><a name="d4e970"></a><p class="title"><b>Example&nbsp;5.7.&nbsp;JAXB beans for JSON supported notations description, simple address bean</b></p><div class="example-contents">
      <pre class="programlisting">&nbsp;&nbsp;1 @XmlRootElement
&nbsp;&nbsp;2 public class Address {
&nbsp;&nbsp;3     public String street;
&nbsp;&nbsp;4     public String town;
&nbsp;&nbsp;5 
&nbsp;&nbsp;6     public Address(){}
&nbsp;&nbsp;7 
&nbsp;&nbsp;8     public Address(String street, String town) {
&nbsp;&nbsp;9         this.street = street;
&nbsp;10         this.town = town;
&nbsp;11     }
&nbsp;12 }</pre>
      </div></div><p><br class="example-break">

      </p><div class="example"><a name="d4e973"></a><p class="title"><b>Example&nbsp;5.8.&nbsp;JAXB beans for JSON supported notations description, contact bean</b></p><div class="example-contents">
      <pre class="programlisting">&nbsp;&nbsp;1 @XmlRootElement
&nbsp;&nbsp;2 public class Contact {
&nbsp;&nbsp;3 
&nbsp;&nbsp;4     public int id;
&nbsp;&nbsp;5     public String name;
&nbsp;&nbsp;6     public List&lt;Address&gt; addresses;
&nbsp;&nbsp;7 
&nbsp;&nbsp;8     public Contact() {};
&nbsp;&nbsp;9 
&nbsp;10     public Contact(int id, String name, List&lt;Address&gt; addresses) {
&nbsp;11         this.name = name;
&nbsp;12         this.id = id;
&nbsp;13         this.addresses = 
&nbsp;14 	        (addresses != null) ? new LinkedList&lt;Address&gt;(addresses) : null;
&nbsp;15     }
&nbsp;16 }</pre>
      </div></div><p><br class="example-break">
      </p>
      
      <p>
      Following text will be mainly working with a contact bean initialized with:
      </p><div class="example"><a name="json.jaxb.bean.init.example"></a><p class="title"><b>Example&nbsp;5.9.&nbsp;JAXB beans for JSON supported notations description, initialization</b></p><div class="example-contents">
      <pre class="programlisting">final Address[] addresses = {new Address("Long Street 1", "Short Village")};
Contact contact = new Contact(2, "Bob", Arrays.asList(addresses));</pre>
</div></div><p><br class="example-break">
I.e. contact bean with <code class="code">id=2</code>, <code class="code">name="Bob"</code> containing 
a single address (<code class="code">street="Long Street 1"</code>, <code class="code">town="Short Village"</code>).
      </p>
      
      <p>All bellow described configuration options are documented 
      also in apidocs at <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/json/JSONConfiguration.html" target="_top">http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/json/JSONConfiguration.html</a>
      </p>
      
      
      
      
      <div class="section" title="5.2.2.1.&nbsp;Mapped notation"><div class="titlepage"><div><div><h4 class="title"><a name="d4e986"></a>5.2.2.1.&nbsp;Mapped notation</h4></div></div></div>
       
       
       
       <p>
       <code class="code">JSONConfiguration</code> based on <code class="literal">mapped</code> notation could be build with 
       </p><pre class="programlisting">JSONConfiguration.mapped().build()</pre><p>
       for usage in a <code class="code">JAXBContext</code> resolver, <a class="xref" href="#json.jaxb.context.resolver.example" title="Example&nbsp;5.6.&nbsp;An example of a JAXBContext resolver implementation">Example&nbsp;5.6, &#8220;An example of a JAXBContext resolver implementation&#8221;</a>.
       Then a contact bean initialized with <a class="xref" href="#json.jaxb.bean.init.example" title="Example&nbsp;5.9.&nbsp;JAXB beans for JSON supported notations description, initialization">Example&nbsp;5.9, &#8220;JAXB beans for JSON supported notations description, initialization&#8221;</a>, will be serialized as
       </p><div class="example"><a name="d4e995"></a><p class="title"><b>Example&nbsp;5.10.&nbsp;JSON expression produced using <code class="literal">mapped</code> notation</b></p><div class="example-contents">
       <pre class="programlisting">&nbsp;&nbsp;1 { "id":"2" 
&nbsp;&nbsp;2  ,"name":"Bob"
&nbsp;&nbsp;3  ,"addresses":{"street":"Long Street 1"
&nbsp;&nbsp;4                     ,"town":"Short Village"}}</pre>
       </div></div><p><br class="example-break">
       The JSON representation seems fine, and will be working flawlessly with Java based Jersey client API.
       </p>
       <p>
       However, at least one issue might appear once you start using it with a JavaScript based client.
       The information, that <code class="code">addresses</code> item represents an array, is being lost for every single element array. 
       If you added another address bean to the contact,</p><pre class="programlisting">contact.addresses.add(new Address("Short Street 1000", "Long Village"));</pre><p>,
       you would get 
       </p><pre class="programlisting">&nbsp;&nbsp;1 { "id":"2" 
&nbsp;&nbsp;2  ,"name":"Bob"
&nbsp;&nbsp;3  ,"addresses":[{"street":"Long Street 1","town":"Short Village"}
&nbsp;&nbsp;4               ,{"street":"Short Street 1000","town":"Long Village"}]}</pre><p>
        Both representations are correct, but you will not be able to consume them using a single JavaScript client,
	because to access <code class="code">"Short Village"</code> value, you will write <code class="code">addresses.town</code> in one
	case and <code class="code">addresses[0].town</code> in the other.
	To fix this issue, you need to instruct the JSON processor, what items need to be treated as arrays
	by setting an optional property, <code class="literal">arrays</code>, on your <code class="code">JSONConfiguration</code> object.
	For our case, you would do it with
       </p><div class="example"><a name="d4e1008"></a><p class="title"><b>Example&nbsp;5.11.&nbsp;Force arrays in <code class="literal">mapped</code> JSON notation</b></p><div class="example-contents">
       <pre class="programlisting">JSONConfiguration.mapped().arrays("addresses").build()</pre>
       </div></div><p><br class="example-break">
       You can use multiple string values in the <code class="literal">arrays</code> method call, in case you are dealing with more
       than one array item in your beans. Similar mechanism (one or more argument values) applies also for all below desribed options.
       </p>
       
       <p>Another issue might be, that number value, <code class="literal">2</code>, for <code class="code">id</code> item 
       gets written as a string, <code class="literal">"2"</code>. To avoid this, you can use another optional property on <code class="code">JSONConfiguration</code>
       called <code class="literal">nonStrings</code>.
       </p><div class="example"><a name="d4e1019"></a><p class="title"><b>Example&nbsp;5.12.&nbsp;Force non-string values in <code class="literal">mapped</code> JSON notation</b></p><div class="example-contents">
       <pre class="programlisting">JSONConfiguration.mapped().arrays("addresses").nonStrings("id").build()</pre>
       </div></div><p><br class="example-break">
	</p>       
       
       <p>
       It might happen you use XML attributes in your JAXB beans. In <code class="literal">mapped</code> JSON notation, these attribute names are prefixed with <code class="literal">@</code>
       character. If <code class="code">id</code> was an attribute, it&acute;s definition would look like:
       </p><pre class="programlisting">  ...
  @XmlAttribute
  public int id;
  ...</pre><p>
       and then you would get </p><pre class="programlisting">{"@id":"2" ...</pre><p> at the JSON output.
       In case, you want to get rid of the <code class="literal">@</code> prefix, you can take advantage of another configuration 
       option of <code class="literal">JSONConfiguration</code>, called <code class="literal">attributeAsElement</code>.
       Usage is similar to previous options.
       </p><div class="example"><a name="d4e1032"></a><p class="title"><b>Example&nbsp;5.13.&nbsp;XML attributes as XML elements in <code class="literal">mapped</code> JSON notation</b></p><div class="example-contents">
       <pre class="programlisting">JSONConfiguration.mapped().attributeAsElement("id").build()</pre>
       </div></div><p><br class="example-break">
       </p>
	<p>
	<code class="literal">Mapped</code> JSON notation was designed to produce the simplest possible JSON expression out of JAXB beans. While in XML,
	you must always have a root tag to start a XML document with, there is no such a constraint in JSON. If you wanted to be strict,
	you might have wanted to keep a XML root tag equivalent generated in your JSON. If that is the case, another configuration option
	is available for you, which is called <code class="literal">rootUnwrapping</code>. You can use it as follows:
       </p><div class="example"><a name="json.jaxb.mapped.root.unwrapping"></a><p class="title"><b>Example&nbsp;5.14.&nbsp;Keep XML root tag equivalent in JSON <code class="literal">mapped</code> JSON notation</b></p><div class="example-contents">
       <pre class="programlisting">JSONConfiguration.mapped().rootUnwrapping(false).build()</pre>
       </div></div><p><br class="example-break">
       and get the following JSON for our <code class="literal">Contact</code> bean:
       </p><div class="example"><a name="d4e1044"></a><p class="title"><b>Example&nbsp;5.15.&nbsp;XML root tag equivalent kept in JSON using <code class="literal">mapped</code> notation</b></p><div class="example-contents">
       <pre class="programlisting">&nbsp;&nbsp;1 {"contact":{ "id":"2" 
&nbsp;&nbsp;2  ,"name":"Bob"
&nbsp;&nbsp;3  ,"addresses":{"street":"Long Street 1"
&nbsp;&nbsp;4                     ,"town":"Short Village"}}}</pre>
       </div></div><p><br class="example-break">
	<code class="literal">rootUnwrapping</code> option is set to <code class="literal">true</code> by default. You should switch it to <code class="literal">false</code>
	if you use inheritance at your JAXB beans. Then JAXB might try to encode type information into root element names, and by stripping these
	elements off, you could break unmarshalling.
	</p>
	
	<p>
	In version 1.1.1-ea, XML namespace support was added to the MAPPED JSON notation. There is of course no such thing as XML namespaces in JSON,
	but when working from JAXB, XML infoset is used as an intermediary format. And then when various XML namespaces are used, ceratin information 
	related to the concrete namespaces is needed even in JSON data, so that the JSON procesor could correctly unmarshal JSON to XML and JAXB. 
	To make it short, the XML namespace support means, you should be able to use the very same JAXB beans for XML and JSON even if XML namespaces are involved.
	</p>
	<p>
	Namespace mapping definition is similar to <a class="xref" href="#json.jaxb.jettison.mapped.ns.def" title="Example&nbsp;5.20.&nbsp;XML namespace to JSON mapping configuration for Jettison based mapped notation">Example&nbsp;5.20, &#8220;XML namespace to JSON mapping configuration for Jettison based <code class="literal">mapped</code> notation&#8221;</a> 
      </p><div class="example"><a name="d4e1054"></a><p class="title"><b>Example&nbsp;5.16.&nbsp;XML namespace to JSON mapping configuration for <code class="literal">mapped</code> notation</b></p><div class="example-contents">
       <pre class="programlisting">&nbsp;&nbsp;1         Map&lt;String,String&gt; ns2json = new HashMap&lt;String, String&gt;();
&nbsp;&nbsp;2         ns2json.put("http://example.com", "example");
&nbsp;&nbsp;3         context = new JSONJAXBContext(
&nbsp;&nbsp;4 	      JSONConfiguration.mapped()
&nbsp;&nbsp;5 	           .xml2JsonNs(ns2json).build(), types);</pre>
		   </div></div><p><br class="example-break">
	</p>
	<p>
	Dot character (.) will be used by default as a namespace separator in the JSON identifiers. E.g. for the above mentioned <code class="literal">example</code> namespace
	and tag <code class="literal">T</code>, <code class="literal">"example.T"</code> JSON identifier will be generated. To change this default behaviour, you can use the <code class="literal">nsSeparator</code>
	method on the mapped JSONConfiguration builder: <code class="literal">JSONConfiguration.mapped().xml2JsonNs(ns2json).nsSeparator(':').build()</code>. Then you will 
	get <code class="literal">"example:T"</code> instead of <code class="literal">"example.T"</code> generated. This option should be used carefully, as the Jersey framework does not even try to check
	conflicts between the user selected separator character and the tag and/or namespace names. 
	</p>
      </div>
      
      
      
      
      <div class="section" title="5.2.2.2.&nbsp;Natural notation"><div class="titlepage"><div><div><h4 class="title"><a name="d4e1066"></a>5.2.2.2.&nbsp;Natural notation</h4></div></div></div>
       
       
       
       <p>
       After using <code class="literal">mapped</code> JSON notation for a while, it was apparent, that a need to configure all the various things
       manually could be a bit problematic. To avoid the manual work, a new, <code class="literal">natural</code>, JSON notation was introduced in Jersey version 1.0.2.
       With <code class="literal">natural</code> notation, Jersey will automatically figure out how individual items need to be processed, so that you 
       do not need to do any kind of manual configuration. Java arrays and lists are mapped into JSON arrays, even for single-element cases. 
       Java numbers and booleans are correctly mapped into JSON numbers and booleans, and you do not need to bother with XML attributes,
       as in JSON, they keep the original names. So  without any additional configuration, just using
       </p><pre class="programlisting">JSONConfiguration.natural().build()</pre><p>
       for configuring your <code class="code">JAXBContext</code>, you will get the following JSON for the bean 
       initialized at <a class="xref" href="#json.jaxb.bean.init.example" title="Example&nbsp;5.9.&nbsp;JAXB beans for JSON supported notations description, initialization">Example&nbsp;5.9, &#8220;JAXB beans for JSON supported notations description, initialization&#8221;</a>:
       </p><div class="example"><a name="d4e1075"></a><p class="title"><b>Example&nbsp;5.17.&nbsp;JSON expression produced using <code class="literal">natural</code> notation</b></p><div class="example-contents">
       <pre class="programlisting">&nbsp;&nbsp;1 { "id":2
&nbsp;&nbsp;2  ,"name":"Bob"
&nbsp;&nbsp;3  ,"addresses":[{"street":"Long Street 1"
&nbsp;&nbsp;4                      ,"town":"Short Village"}]}</pre>
       </div></div><p><br class="example-break">
       You might notice, that the single element array <code class="literal">addresses</code> remains an array, and also the non-string <code class="literal">id</code>
       value is not limited with double quotes, as <code class="literal">natural</code> notation automatically detects these things.
       </p>
       <p>
       To support cases, when you use inheritance for your JAXB beans, an option was introduced to the <code class="literal">natural</code> JSON configuration builder
       to forbid XML root element stripping. The option looks pretty same as at the default <code class="literal">mapped</code> notation case (<a class="xref" href="#json.jaxb.mapped.root.unwrapping" title="Example&nbsp;5.14.&nbsp;Keep XML root tag equivalent in JSON mapped JSON notation">Example&nbsp;5.14, &#8220;Keep XML root tag equivalent in JSON <code class="literal">mapped</code> JSON notation&#8221;</a>).
       </p><div class="example"><a name="json.jaxb.natural.root.unwrapping"></a><p class="title"><b>Example&nbsp;5.18.&nbsp;Keep XML root tag equivalent in JSON <code class="literal">natural</code> JSON notation</b></p><div class="example-contents">
       <pre class="programlisting">JSONConfiguration.natural().rootUnwrapping(false).build()</pre>
       </div></div><p><br class="example-break">
       </p>
      </div>



      <div class="section" title="5.2.2.3.&nbsp;Jettison mapped notation"><div class="titlepage"><div><div><h4 class="title"><a name="d4e1090"></a>5.2.2.3.&nbsp;Jettison mapped notation</h4></div></div></div>
      

      <p>
       Next two notations are based on project <a class="ulink" href="http://jettison.codehaus.org/User%27s+Guide" target="_top">Jettison</a>.
       You might want to use one of these notations, when working with more complex XML documents. Namely when you deal with 
       multiple XML namespaces in your JAXB beans. 
       </p>
       <p>
       Jettison based <code class="literal">mapped</code> notation could be configured using:
       </p><pre class="programlisting">JSONConfiguration.mappedJettison().build()</pre><p>
       If nothing else is configured, you will get similar JSON output as for the default, <code class="literal">mapped</code>, notation:
       </p><div class="example"><a name="d4e1098"></a><p class="title"><b>Example&nbsp;5.19.&nbsp;JSON expression produced using Jettison based <code class="literal">mapped</code> notation</b></p><div class="example-contents">
       <pre class="programlisting">&nbsp;&nbsp;1 { "contact:{"id":2
&nbsp;&nbsp;2               ,"name":"Bob"
&nbsp;&nbsp;3               ,"addresses":{"street":"Long Street 1"
&nbsp;&nbsp;4                                  ,"town":"Short Village"}}</pre>
       </div></div><p><br class="example-break">
	The only difference is, your numbers and booleans will not be converted into strings, but you have no option for forcing arrays remain arrays
	in single-element case. Also the JSON object, representing XML root tag is being produced.
       </p>
       <p>
       If you need to deal with various XML namespaces, however, you will find Jettison <code class="literal">mapped</code> notation pretty useful.
       Lets define a particular namespace for <code class="code">id</code> item:
       </p><pre class="programlisting">  ...
  @XmlElement(namespace="http://example.com")
  public int id;
  ...</pre><p>
 	Then you simply confgure a mapping from XML namespace into JSON prefix as follows:
      </p><div class="example"><a name="json.jaxb.jettison.mapped.ns.def"></a><p class="title"><b>Example&nbsp;5.20.&nbsp;XML namespace to JSON mapping configuration for Jettison based <code class="literal">mapped</code> notation</b></p><div class="example-contents">
       <pre class="programlisting">&nbsp;&nbsp;1         Map&lt;String,String&gt; ns2json = new HashMap&lt;String, String&gt;();
&nbsp;&nbsp;2         ns2json.put("http://example.com", "example");
&nbsp;&nbsp;3         context = new JSONJAXBContext(
&nbsp;&nbsp;4 	      JSONConfiguration.mappedJettison()
&nbsp;&nbsp;5 	           .xml2JsonNs(ns2json).build(), types);</pre>
       </div></div><p><br class="example-break">
       Resulting JSON will look like in the example bellow.
        </p><div class="example"><a name="d4e1110"></a><p class="title"><b>Example&nbsp;5.21.&nbsp;JSON expression with XML namespaces mapped into JSON</b></p><div class="example-contents">
       <pre class="programlisting">&nbsp;&nbsp;1 { "contact:{"example.id":2
&nbsp;&nbsp;2               ,"name":"Bob"
&nbsp;&nbsp;3               ,"addresses":{"street":"Long Street 1"
&nbsp;&nbsp;4                                  ,"town":"Short Village"}}</pre>
       </div></div><p><br class="example-break">
       Please note, that <code class="code">id</code> item became <code class="code">example.id</code> based on the XML namespace mapping.
       If you have more XML namespaces in your XML, you will need to configure appropriate mapping for all of them
       </p>
      </div>



      <div class="section" title="5.2.2.4.&nbsp;Badgerfish notation"><div class="titlepage"><div><div><h4 class="title"><a name="d4e1115"></a>5.2.2.4.&nbsp;Badgerfish notation</h4></div></div></div>
      
      
      
      <p>
       Badgerfish notation is the other notation based on Jettison. From JSON and JavaScript perspective, this notation is definitely
       the worst readable one. You will probably not want to use it, unless you need to make sure your JAXB beans could be flawlessly
       written and read back to and from JSON, without bothering with any formatting configuration, namespaces, etc.
       </p>
       <p>
       <code class="code">JSONConfiguration</code> instance using <code class="literal">badgerfish</code> notation could be built with
       </p><pre class="programlisting">JSONConfiguration.badgerFish().build()</pre><p>
       and the output JSON for <a class="xref" href="#json.jaxb.bean.init.example" title="Example&nbsp;5.9.&nbsp;JAXB beans for JSON supported notations description, initialization">Example&nbsp;5.9, &#8220;JAXB beans for JSON supported notations description, initialization&#8221;</a> will be as follows.
       </p><div class="example"><a name="d4e1123"></a><p class="title"><b>Example&nbsp;5.22.&nbsp;JSON expression produced using <code class="literal">badgerfish</code> notation</b></p><div class="example-contents">
       <pre class="programlisting">&nbsp;&nbsp;1 {"contact":{"id":{"$":"2"}
&nbsp;&nbsp;2               ,"name":{"$":"Bob"}
&nbsp;&nbsp;3               ,"addresses":{"street":{"$":"Long Street 1"}
&nbsp;&nbsp;4                                  ,"town":{"$":"Short Village"}}}}</pre>
       </div></div><p><br class="example-break">
       </p>
      </div>

    </div>
<div class="section" title="5.2.3.&nbsp;Examples"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1127"></a>5.2.3.&nbsp;Examples</h3></div></div></div>
   <p>Download <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.samples&amp;a=json-from-jaxb&amp;v=1.9&amp;c=project&amp;e=zip" target="_top">https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.samples&amp;a=json-from-jaxb&amp;v=1.9&amp;c=project&amp;e=zip</a>
   or
   <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.samples&amp;a=jmaki-backend&amp;v=1.9&amp;c=project&amp;c=project&amp;e=zip" target="_top">https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.samples&amp;a=jmaki-backend&amp;v=1.9&amp;c=project&amp;e=zip</a>
   to get a more complex example using JAXB based JSON support.
   </p>
   </div>

   </div>




   <div class="section" title="5.3.&nbsp;Low-Level JSON support"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1132"></a>5.3.&nbsp;Low-Level JSON support</h2></div></div></div>
    

    <p>Using this approach means you will be using JSONObject and/or JSONArray classes for your data representations.
    These classes are actually taken from Jettison project, but conform to the description
    provided at <a class="ulink" href="http://www.json.org/java/index.html" target="_top"> http://www.json.org/java/index.html</a>.
    </p>

    <p>
    The biggest advantage here is, that you will gain full control over the JSON format produced and consumed.
    On the other hand, dealing with your data model objects will probably be a bit more complex, than when taking the JAXB based approach.
    Differencies are depicted at the following code snipets.
    </p>
    
    <p>
    </p><div class="example"><a name="d4e1138"></a><p class="title"><b>Example&nbsp;5.23.&nbsp;JAXB bean creation</b></p><div class="example-contents">
    <pre class="programlisting">MyJaxbBean myBean = new MyJaxbBean("Agamemnon", 32);</pre>
    </div></div><p><br class="example-break">
    
    Above you construct a simple JAXB bean, which could be written in JSON as <code class="code">{"name":"Agamemnon", "age":32}</code>
    </p>
    
    <p>
    Now to build an equivalent JSONObject (in terms of resulting JSON expression), you would need several more lines of code.
    
    </p><div class="example"><a name="d4e1143"></a><p class="title"><b>Example&nbsp;5.24.&nbsp;Constructing a JSONObject</b></p><div class="example-contents">
    
 <pre class="programlisting">&nbsp;&nbsp;1 JSONObject myObject = new JSONObject();
&nbsp;&nbsp;2 myObject.JSONObject myObject = new JSONObject();
&nbsp;&nbsp;3 try {
&nbsp;&nbsp;4   myObject.put("name", "Agamemnon");
&nbsp;&nbsp;5   myObject.put("age", 32);
&nbsp;&nbsp;6 } catch (JSONException ex) {
&nbsp;&nbsp;7   LOGGER.log(Level.SEVERE, "Error ...", ex);
&nbsp;&nbsp;8 }</pre>
    </div></div><p><br class="example-break">
    </p>

    <div class="section" title="5.3.1.&nbsp;Examples"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1146"></a>5.3.1.&nbsp;Examples</h3></div></div></div>

   <p>Download  <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.samples&amp;a=bookmark&amp;v=1.9&amp;c=project&amp;e=zip" target="_top">https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.samples&amp;a=bookmark&amp;v=1.9&amp;c=project&amp;e=zip</a>
   to get a more complex example using low-level JSON support.
   </p>

  </div>
</div>
</div>
  <div class="chapter" title="Chapter&nbsp;6.&nbsp;Declarative Hyperlinking"><div class="titlepage"><div><div><h2 class="title"><a name="linking"></a>Chapter&nbsp;6.&nbsp;Declarative Hyperlinking</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d4e1155">6.1. Links in Representations</a></span></dt><dt><span class="section"><a href="#d4e1169">6.2. Binding Template Parameters</a></span></dt><dt><span class="section"><a href="#d4e1204">6.3. Conditional Link Injection</a></span></dt><dt><span class="section"><a href="#d4e1213">6.4. Link Headers</a></span></dt><dt><span class="section"><a href="#d4e1227">6.5. Configuration</a></span></dt></dl></div>
    
    <p><a class="ulink" href="http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven" target="_top">RESTful
            APIs must be hypertext-driven</a>. JAX-RS currently offers <a class="ulink" href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/core/UriBuilder.html" target="_top">UriBuilder</a> to simplify URI
        creation but Jersey adds an additional annotation-based alternative that is described
        here.</p>
    <div class="section" title="6.1.&nbsp;Links in Representations"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1155"></a>6.1.&nbsp;Links in Representations</h2></div></div></div>
        
        <p>Links are added to representations using the <code class="literal">@Ref</code> annotation on
            entity class fields. The Jersey runtime is responsible for injecting the appropriate URI
            into the field prior to serialization by a message body writer. E.g. consider the
            following resource and entity classes:</p>
        <pre class="programlisting">@Path("widgets")
public class WidgetsResource {
  @GET
  public Widgets get() {
    return new Widgets();
  }
}
        
public class Widgets {
  @Ref(resource=WidgetsResource.class)
  URI u;
}</pre>
        <p>After a call to <code class="literal">WidgetsResource#get</code>, the Jersey runtime will inject
            the value "/context/widgets"<sup>[<a name="d4e1162" href="#ftn.d4e1162" class="footnote">1</a>]</sup> into the returned <code class="literal">Widgets</code> instance. If an absolute URI is
            desired instead of an absolute path then the annotation can be changed to
                <code class="literal">@Ref(resource=WidgetsResource.class, style=ABSOLUTE)</code>.</p>
        <p>The above usage works nicely when there's already a URI template on a class that you
            want to reuse. If there's no such template available then you can use a literal value
            instead of a reference. E.g. the following is equivalent to the earlier example:
                <code class="literal">@Ref(value="widgets", style=ABSOLUTE)</code>.</p>
    </div>
    <div class="section" title="6.2.&nbsp;Binding Template Parameters"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1169"></a>6.2.&nbsp;Binding Template Parameters</h2></div></div></div>
        
        <p>Referenced or literal templates may contain parameters. Two forms of parameters are
            supported:</p>
        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p>URI template parameters, e.g. <code class="literal">widgets/{id}</code> where
                        <code class="literal">{id}</code> represents a variable part of the URI.</p>
            </li><li class="listitem">
                <p>EL expressions, e.g. <code class="literal">widgets/${instance.id}</code> where
                        <code class="literal">${instance.id}</code> is an EL expression.</p>
            </li></ul></div>
        <p>Parameter values can be extracted from three implicit beans:</p>
        <div class="variablelist"><dl><dt><span class="term">
                    <code class="literal">instance</code>
                </span></dt><dd>
                    <p>Represents the instance of the class that contains the annotated
                        field.</p>
                </dd><dt><span class="term">
                    <code class="literal">entity</code>
                </span></dt><dd>
                    <p>Represents the entity class instance returned by the resource
                        method.</p>
                </dd><dt><span class="term">
                    <code class="literal">resource</code>
                </span></dt><dd>
                    <p>Represents the resource class instance that returned the entity.</p>
                </dd></dl></div>

        <p>By default URI template parameter values are extracted from the implicit
                <code class="literal">instance</code> bean, i.e. the following two annotations are
            equivalent:</p>
        <pre class="programlisting">@Ref("widgets/{id}")
@Ref("widgets/${instance.id}")</pre>
        <p>The source for URI template parameter values can be changed using the
                <code class="literal">@Binding</code> annotation, E.g. the following two annotations are
            equivalent:</p>
        <pre class="programlisting">@Ref(value="widgets/{id}", bindings={
  @Binding(name="id" value="${resource.id}"}
)
@Ref("widgets/${resource.id}")</pre>

    </div>

    <div class="section" title="6.3.&nbsp;Conditional Link Injection"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1204"></a>6.3.&nbsp;Conditional Link Injection</h2></div></div></div>
        
        <p>Link value injection can be made conditional by use of the
                <code class="literal">condition</code> property. The value of this property is a boolean EL
            expression and a link will only be injected if the condition expression evaluates to
            true. E.g.:</p>
        <pre class="programlisting">@Ref(value="widgets/${instance.id}/offers",
  condition="${instance.offers}")
URI offers;</pre>
        <p>In the above, a URI will only be injected into the <code class="literal">offers</code> field if
            the <code class="literal">offers</code> property of the instance is <code class="literal">true</code>.
        </p>
    </div>


    <div class="section" title="6.4.&nbsp;Link Headers"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1213"></a>6.4.&nbsp;Link Headers</h2></div></div></div>
        
        <p><a class="ulink" href="http://tools.ietf.org/html/rfc5988#section-5" target="_top">HTTP Link
                headers</a> can also be added to responses using annotations. Instead of
            annotating the fields of an entity class with <code class="literal">@Ref</code>, you instead
            annotate the entity class itself with <code class="literal">@Link</code>. E.g.:</p>
        <pre class="programlisting">@Link(
  value=@Ref("widgets/${resource.nextId}"),
  rel="next"
)</pre>
        <p>The above would insert a HTTP Link header into any response whose entity was thus
            annotated. The <code class="literal">@Link</code> annotation contains properties that map to the
            parameters of the HTTP Link header. The above specifies the link relation as
                <code class="literal">next</code>. All properties of the <code class="literal">@Ref</code> annotation
            may be used as described above. </p>
        <p>Multiple link headers can be added by use of the <code class="literal">@Links</code> annotation
            which can contain multiple <code class="literal">@Link</code> annotations.</p>
    </div>
    
    <div class="section" title="6.5.&nbsp;Configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1227"></a>6.5.&nbsp;Configuration</h2></div></div></div>
        
        <p>Declarative hyperlinking support is provided in the form of a filter. First, the application
            must declare a dependency on the <code class="literal">jersey-server-linking</code> module:</p>
        <pre class="programlisting">&lt;dependency&gt;
  &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
  &lt;artifactId&gt;jersey-server-linking&lt;/artifactId&gt;
  &lt;version&gt;${jersey-version}&lt;/version&gt;
&lt;/dependency&gt;</pre>
        <p>Second the filter needs to be installed in the application either programmatically by
            adding:</p>
        <pre class="programlisting">com.sun.jersey.server.linking.LinkFilter</pre>
        <p>to the list defined by:</p>
        <pre class="programlisting">com.sun.jersey.spi.container.ContainerResponseFilters</pre>
        <p>or using a <code class="literal">web.xml</code> init parameter:</p>
        <pre class="programlisting">&lt;init-param&gt;
  &lt;param-name&gt;com.sun.jersey.spi.container.ContainerResponseFilters&lt;/param-name&gt;
  &lt;param-value&gt;com.sun.jersey.server.linking.LinkFilter&lt;/param-value&gt;
&lt;/init-param&gt;
</pre>
<p>See the <a class="ulink" href="https://maven.java.net/content/repositories/releases/com/sun/jersey/samples/jersey-server-linking-sample" target="_top">jersey-server-linking-sample</a> for more details.</p>
    </div>


<div class="footnotes"><br><hr width="100" align="left"><div class="footnote">
                <p><sup>[<a name="ftn.d4e1162" href="#d4e1162" class="para">1</a>] </sup>Where <code class="literal">/context</code> is the application deployment
                    context.</p>
            </div></div></div>
  <div class="chapter" title="Chapter&nbsp;7.&nbsp;Jersey Test Framework"><div class="titlepage"><div><div><h2 class="title"><a name="test-framework"></a>Chapter&nbsp;7.&nbsp;Jersey Test Framework</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d4e1252">7.1. What is different in Jersey 1.2</a></span></dt><dt><span class="section"><a href="#d4e1275">7.2. Using test framework</a></span></dt><dt><span class="section"><a href="#d4e1318">7.3. Creating tests</a></span></dt><dt><span class="section"><a href="#d4e1325">7.4. Creating own module</a></span></dt><dt><span class="section"><a href="#d4e1336">7.5. Running tests outside Maven</a></span></dt></dl></div>
    

    <p>This chapter will present how to write tests for your resources
    using Jersey Test Framework and how to run them in various containers.
    Additionally it will explain how to create new module for not yet
    supported container.</p>

    <p>Jersey currently provides following modules:

        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">jersey-test-framework-grizzly</li><li class="listitem">jersey-test-framework-grizzly2</li><li class="listitem">jersey-test-framework-http</li><li class="listitem">jersey-test-framework-inmemory</li><li class="listitem">jersey-test-framework-embedded-glassfish</li><li class="listitem">jersey-test-framework-external</li></ul></div><p>
    </p>

    <div class="section" title="7.1.&nbsp;What is different in Jersey 1.2"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1252"></a>7.1.&nbsp;What is different in Jersey 1.2</h2></div></div></div>
        

        <p>There are some significant breaking changes in Jersey 1.2.
        In prior Jersey versions users were able to select container factory
        just by specifying it in some property. That was convenient from
        user perspective but not good from build perspective. Former test
        framework artifact was dependent on all containers which is useless
        in most cases (usually you test only with one container).</p>

        <p>Solution to this is modularization - make module for each
        test container. It has one drawback: users will have to have other
        dependency in their applications, for example if you want to test
        on embedded grizzly container, you will declare (only) dependency
        on jersey test framework grizzly module. You can declare multiple
        test containers this way and select one by defining property
        <code class="literal">jersey.test.containerFactory</code>.</p>

        <p>Another change (non-breaking) is renaming Jersey parameters
        which control container factory, used port and host name for
        external container. Old properties are still working but users are
        encouraged to use new ones.</p>

        <div class="table"><a name="d4e1258"></a><p class="title"><b>Table&nbsp;7.1.&nbsp;Property name changes</b></p><div class="table-contents">
            <table summary="Property name changes" border="1"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th align="left">Prior Jersey 1.2</th><th align="left">Jersey 1.2+</th></tr></thead><tbody><tr><td align="left">test.containerFactory</td><td align="left">jersey.test.containerFactory</td></tr><tr><td align="left">JERSEY_HTTP_PORT</td><td align="left">jersey.test.port</td></tr><tr><td align="left">JERSEY_HOST_NAME (used with external container)</td><td align="left">jersey.test.host</td></tr></tbody></table>
        </div></div><br class="table-break">
    </div>

    <div class="section" title="7.2.&nbsp;Using test framework"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1275"></a>7.2.&nbsp;Using test framework</h2></div></div></div>
        
        <p>When you want test your resources in maven-based project, you
            need to add dependency on one of the Jersey Test Framework modules. You
            can take a look at helloworld sample pom file. There is declared
            dependency on:

            </p><pre class="programlisting">

                &lt;dependency&gt;
                &lt;groupId&gt;com.sun.jersey.jersey-test-framework&lt;/groupId&gt;
                &lt;artifactId&gt;jersey-test-framework-grizzly2&lt;/artifactId&gt;
                &lt;version&gt;${project.version}&lt;/version&gt;
                &lt;scope&gt;test&lt;/scope&gt;
                &lt;/dependency&gt;

            </pre><p>

            which means that Grizzly Web container (version 2.x) will be used for testing.
        </p>

        <p>You can specify more than one module in dependencies and choose which
        module will be used by <code class="literal">jersey.test.containerFactory</code> property.
        Every module should contain at least one container factory.</p>

        <div class="glosslist"><dl><dt>jersey-test-framework-grizzly</dt><dd><p>
                        <code class="literal">com.sun.jersey.test.framework.spi.container.grizzly.web.GrizzlyWebTestContainerFactory</code>
                        <code class="literal">com.sun.jersey.test.framework.spi.container.grizzly.GrizzlyTestContainerFactory</code>
                    </p></dd><dt>jersey-test-framework-grizzly2</dt><dd><p>
                        <code class="literal">com.sun.jersey.test.framework.spi.container.grizzly2.web.GrizzlyWebTestContainerFactory</code>
                        <code class="literal">com.sun.jersey.test.framework.spi.container.grizzly2.GrizzlyTestContainerFactory</code>
                    </p></dd><dt>jersey-test-framework-http</dt><dd><p>
                        <code class="literal">com.sun.jersey.test.framework.spi.container.http.HTTPContainerFactory</code>
                    </p></dd><dt>jersey-test-framework-inmemory</dt><dd><p>
                        <code class="literal">com.sun.jersey.test.framework.spi.container.inmemory.InMemoryTestContainerFactory</code>
                    </p></dd><dt>jersey-test-framework-embedded-glassfish</dt><dd><p>
                        <code class="literal">com.sun.jersey.test.framework.spi.container.embedded.glassfish.EmbeddedGlassFishTestContainerFactory</code>
                    </p></dd><dt>jersey-test-framework-external</dt><dd><p>
                        <code class="literal">com.sun.jersey.test.framework.spi.container.external.ExternalTestContainerFactory</code>
                    </p></dd></dl></div>

        <p>Basically you can just add dependency on single module and its container factory would be used. Problem
        is when you specify module which has more than one container factory or multiple modules. If this happen, test
        framework will choose factory using following rules:</p>

        <pre class="programlisting">if("jersey.test.containerFactory" not specified)
    look for factories
    if(factories.count == 1)
        use found factory
    else
        if(com.sun.jersey.test.framework.spi.container.grizzly2.web.GrizzlyWebTestContainerFactory is present)
            use it // current default jersey test container factory
        else
            use first found and log warning
else
    use factory class specified in "jersey.test.containerFactory"</pre>

        <p>That means if your project depends on multiple test framework modules and you want to control which will
        be used, you have to declare which one in property called "jersey.test.containerFactory", for example like this:

            <code class="literal">mvn clean install -Djersey.test.containerFactory=com.sun.jersey.test.framework.spi.container.inmemory.InMemoryTestContainerFactory</code>
        </p>

    </div>

    <div class="section" title="7.3.&nbsp;Creating tests"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1318"></a>7.3.&nbsp;Creating tests</h2></div></div></div>
        

        <p>Jersey Test Framework uses JUnit version 4.X, so if you can write standard unit tests, you can easily
        create Jersey Test. You need to declare test as a descendant of JerseyTest class.

        </p><pre class="programlisting">public class MainTest extends JerseyTest {

    public MainTest()throws Exception {
        super("com.sun.jersey.samples.helloworld.resources");
    }

    @Test
    public void testHelloWorld() {
        WebResource webResource = resource();
        String responseMsg = webResource.path("helloworld").get(String.class);
        assertEquals("Hello World", responseMsg);
    }

}</pre><p>

        Note <code class="literal">super</code> call in constructor - it passes list of package names to scan (it really is a list,
        JerseyTest constructor has variable argument count). Another useful method is
        <code class="literal">resource()</code> which returns WebResource instance with URI set to base URI of your application.
        You can get preconfigured Jersey Client instance similarly by calling <code class="literal">client()</code> method.</p>

    </div>

    <div class="section" title="7.4.&nbsp;Creating own module"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1325"></a>7.4.&nbsp;Creating own module</h2></div></div></div>
        
        <p>Creating your own module is pretty straightforward, you just have to implement <code class="literal">com.sun.jersey.test.framework.spi.container.TestContainerFactory</code>
        and <code class="literal">com.sun.jersey.test.framework.spi.container.TestContainer</code>. TestContainer factory is there basically for returning TestContainer instance and
        TestContainer has self-explanatory methods: <code class="literal">start()</code>, <code class="literal">stop()</code>, <code class="literal">getClient()</code> and <code class="literal">getBaseURI()</code>.
        I recommend taking look at source code and read javadoc of these two classes, all you need is there.</p>

        <p>You should be avare of another thing when implementing own jersey test framework module. If you want it to be
        usable by running just <code class="literal">mvn clean install</code> (when only your module is specified), you need to add
        META-INF/services/com.sun.jersey.test.framework.spi.container.TestContainerFactory file into your jar and put there
        your factory class (fully classified) name.</p>
    </div>

    <div class="section" title="7.5.&nbsp;Running tests outside Maven"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1336"></a>7.5.&nbsp;Running tests outside Maven</h2></div></div></div>
        

        <p>Since Jersey is Maven based project, executing tests without Maven can be painful. You have to have everything
            needed present on classpath and by everything is meant following list:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-server&amp;v=1.9&amp;e=jar" target="_top">jersey-server</a></li><li class="listitem"><a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-core&amp;v=1.9&amp;e=jar" target="_top">jersey-core</a></li><li class="listitem"><a class="ulink" href="http://download.java.net/maven/2/javax/ws/rs/jsr311-api/1.1/jsr311-api-1.1.jar" target="_top">jsr311-api</a></li><li class="listitem"><a class="ulink" href="http://repo1.maven.org/maven2/asm/asm/3.1/asm-3.1.jar" target="_top">asm</a></li><li class="listitem"><a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.jersey-test-framework&amp;a=jersey-test-framework-grizzly&amp;v=1.9&amp;e=jar" target="_top">jersey-test-framework-grizzly</a></li><li class="listitem"><a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.jersey-test-framework&amp;a=jersey-test-framework-core&amp;v=1.9&amp;e=jar" target="_top">jersey-test-framework-core</a></li><li class="listitem"><a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-client&amp;v=1.9&amp;e=jar" target="_top">jersey-client</a></li><li class="listitem"><a class="ulink" href="http://download.java.net/maven/glassfish/org/glassfish/javax.servlet/3.0-b66/javax.servlet-3.0-b66.jar" target="_top">javax.servlet</a></li><li class="listitem"><a class="ulink" href="http://repo1.maven.org/maven2/junit/junit/4.5/junit-4.5.jar" target="_top">junit</a></li><li class="listitem"><a class="ulink" href="http://download.java.net/maven/2/com/sun/xml/bind/jaxb-impl/2.1/jaxb-impl-2.1.jar" target="_top">jaxb-impl</a></li><li class="listitem"><a class="ulink" href="http://download.java.net/maven/2/javax/xml/bind/jaxb-api/2.1/jaxb-api-2.1.jar" target="_top">jaxb-api</a></li><li class="listitem"><a class="ulink" href="http://repo1.maven.org/maven2/javax/xml/stream/stax-api/1.0-2/stax-api-1.0-2.jar" target="_top">stax-api</a></li><li class="listitem"><a class="ulink" href="http://repo1.maven.org/maven2/javax/activation/activation/1.1/activation-1.1.jar" target="_top">activation</a></li><li class="listitem"><a class="ulink" href="http://download.java.net/maven/2/com/sun/grizzly/grizzly-servlet-webserver/1.9.18-i/grizzly-servlet-webserver-1.9.18-i.jar" target="_top">grizzly-servlet-webserver</a></li><li class="listitem"><a class="ulink" href="http://download.java.net/maven/2/com/sun/grizzly/grizzly-http/1.9.18-i/grizzly-http-1.9.18-i.jar" target="_top">grizzly-http</a></li><li class="listitem"><a class="ulink" href="http://download.java.net/maven/2/com/sun/grizzly/grizzly-framework/1.9.18-i/grizzly-framework-1.9.18-i.jar" target="_top">grizzly-framework</a></li><li class="listitem"><a class="ulink" href="http://download.java.net/maven/2/com/sun/grizzly/grizzly-utils/1.9.18-i/grizzly-utils-1.9.18-i.jar" target="_top">grizzly-utils</a></li><li class="listitem"><a class="ulink" href="http://download.java.net/maven/2/com/sun/grizzly/grizzly-rcm/1.9.18-i/grizzly-rcm-1.9.18-i.jar" target="_top">grizzly-rcm</a></li><li class="listitem"><a class="ulink" href="http://download.java.net/maven/2/com/sun/grizzly/grizzly-portunif/1.9.18-i/grizzly-portunif-1.9.18-i.jar" target="_top">grizzly-portunif</a></li><li class="listitem"><a class="ulink" href="http://download.java.net/maven/2/com/sun/grizzly/grizzly-http-servlet/1.9.18-i/grizzly-http-servlet-1.9.18-i.jar" target="_top">grizzly-http-servlet</a></li><li class="listitem"><a class="ulink" href="http://repo1.maven.org/maven2/javax/servlet/servlet-api/2.5/servlet-api-2.5.jar" target="_top">servlet-api</a></li></ul></div>

        <p>This is needed to run <code class="literal">helloworld</code> sample tests, if you want run something more complex or
        with different test container (grizzly is used here), you may need to add other application specific dependencies
        (and remove some as well).</p>

        <p>As was already written above, Jersey test is descendant of standard unit test so it can be run same way.
        You can execute it by executing <code class="literal">org.junit.runner.JUnitCore</code> and passing your test class name
        as parameter, from ant (<a class="ulink" href="http://ant.apache.org/manual/OptionalTasks/junit.html" target="_top">junit-task</a>)
        or whatever you are used to.</p>

    </div>

    

</div>
  <div class="chapter" title="Chapter&nbsp;8.&nbsp;OSGi"><div class="titlepage"><div><div><h2 class="title"><a name="osgi"></a>Chapter&nbsp;8.&nbsp;OSGi</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d4e1389">8.1. Feature Overview</a></span></dt><dt><span class="section"><a href="#d4e1425">8.2. WAB Example</a></span></dt><dt><span class="section"><a href="#d4e1437">8.3. Http Service Example</a></span></dt></dl></div>
  
  
  <div class="section" title="8.1.&nbsp;Feature Overview"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1389"></a>8.1.&nbsp;Feature Overview</h2></div></div></div>
    
  
  <p>OSGi support was added to the Jersey version 1.2. Since then, you should be able to utilize standard OSGi means to run Jersey based web applications
  in OSGi runtime as described in the OSGi Service Platform Enterprise Specification. The specification could be downloaded 
  from <a class="ulink" href="http://www.osgi.org/Download/Release4V42" target="_top">http://www.osgi.org/Download/Release4V42</a>.
  </p>
  
  <p>
  The two supported ways of running an OSGi web application are
  </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">WAB (Web Application Bundle)</li><li class="listitem">Http Service</li></ul></div><p>
  </p>

  <p>
  WAB is in fact just an OSGified WAR archive. Http Service feature allows you to publish Java EE Servlets in the OSGi runtime.
  </p>


  <p>Two examples were added to the Jersey distribution to depict the above mentioned features and show how to use them with Jersey
  </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
      <p><a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.samples&amp;a=helloworld-osgi-webapp&amp;v=1.9&amp;c=project&amp;e=zip" target="_top">Hello world WAB</a></p>
    </li><li class="listitem">
      <p><a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.samples&amp;a=osgi-http-service&amp;v=1.9&amp;c=project&amp;e=zip" target="_top">Simple OSGi Http Service application</a></p>
    </li></ul></div><p>
  Both examples are multi-module maven projects and both consist of an application OSGi bundle module and a test module. The tests are based
  on <a class="ulink" href="http://wiki.ops4j.org/display/paxexam/Pax+Exam" target="_top">Pax Exam</a> framework.
  Both examples also include a readme file containing instructions how to manually run the application using <a class="ulink" href="http://felix.apache.org/site/index.html" target="_top">Apache Felix</a> framework.
  </p>

  <p>
  The rest of the chapter describes how to run the above mentioned examples on <a class="ulink" href="http://glassfish.java.net/" target="_top">GlassFish 3.1</a> application server.
  Since GlassFish utilizes Apache Felix, an OSGi runtime comes out of the box with GlassFish.
  However, for security reasons, the OSGi shell has been turned off. You can explicitly enable it. There is a system property called
  <code class="code">org.glassfish.additionalOSGiBundlesToStart</code> in <code class="code">domain.xml</code> that contains a list of additional bundles
  to be started by glassfish. One has to add <code class="code">org.apache.felix.shell.remote</code> there.  Here are a few ways to do it:

</p><p>
Option #1: You can delete the property and create it again using following <code class="code">asadmin</code> commands:
</p><p>
</p><p>
<code class="code">
asadmin delete-jvm-options --target server-config -Dorg.glassfish.additionalOSGiBundlesToStart=org.apache.felix.shell,org.apache.felix.gogo.runtime,org.apache.felix.gogo.shell,org.apache.felix.gogo.command
</code>
</p><p>
</p><p>
<code class="code">
asadmin create-jvm-options --target server-config -Dorg.glassfish.additionalOSGiBundlesToStart=org.apache.felix.shell,org.apache.felix.gogo.runtime,org.apache.felix.gogo.shell,org.apache.felix.gogo.command,org.apache.felix.shell.remote
</code>
</p><p>

</p><p>
Option #2: You can use GlassFish Admin Console to edit the <code class="code">jvm-option</code>.
</p><p>

</p><p>
Option #3: You can edit the <code class="code">domain.xml</code> directly.
</p><p>

Presuming you have the default GlassFish instance running, after enabling shell as described above, you should now be able to connect
  to the Felix console with 
</p><pre class="programlisting">
        telnet localhost 6666
</pre><p> 
   You should then see Apache Felix prompt similar to following
</p><pre class="programlisting">
Trying ::1...
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
____________________________
Welcome to Apache Felix Gogo

g!
</pre><p>

  </p>
  </div>
  
  <div class="section" title="8.2.&nbsp;WAB Example"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1425"></a>8.2.&nbsp;WAB Example</h2></div></div></div>
    
  <p>
  As mentioned above, WAB is just an OSGified WAR archive. Besides the ususal OSGi headers it must in addition contain a special header, <code class="code">Web-ContextPath</code>,
specifying the web application context path. Our WAB has (beside some other) the following headers present in the manifest
  </p><pre class="programlisting">
Web-ContextPath: helloworld
Webapp-Context: helloworld
Bundle-ClassPath: WEB-INF/classes
  </pre><p>
where the second one is ignored by GlassFish, but is needed by other containers not fully compliant with the OSGi Enterprise Specification mentioned above.
The third manifest header worth mentioning is the <code class="code">Bundle-ClassPath</code> specifying where to find the application Java classes within the bundle archive.
</p>
<p>
For more detailed information on the example please see the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.samples&amp;a=helloworld-osgi-webapp&amp;v=1.9&amp;c=project&amp;e=zip" target="_top">source code</a>.
</p>
<p>
Following is the listing showing how to actually install and run the WAB on GlassFish.  Be sure to replace &lt;version&gt; with the current Jersey version and &lt;repository&gt; with either snapshots or releases based on whether you depend
on a snapshot or stable release version of Jersey respectively:
  </p><pre class="programlisting">g! install https://maven.java.net/service/local/artifact/maven/redirect?r=&lt;repository&gt;&amp;g=com.sun.jersey.samples.helloworld-osgi-webapp&amp;a=war-bundle&amp;v=&lt;version&gt;&amp;e=war
Bundle ID: 246
g! start 246
</pre><p>
In the above listing, the number 246 represents handler to the OSGi bundle you have just installed. Bundle numbers are allocated dynamically.
It means, you might be given a different handler. It is important to always use the correct bundle number as specified by the Felix runtime in the "Bundle ID:" response.
</p>
<p>
After the WAB gets installed and activated by the above mentioned commands, you should be able to access the deployed
Jersey resource at <a class="ulink" href="http://localhost:8080/helloworld/webresources/helloworld" target="_top">http://localhost:8080/helloworld/webresources/helloworld</a>
</p>
</div> 

  <div class="section" title="8.3.&nbsp;Http Service Example"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1437"></a>8.3.&nbsp;Http Service Example</h2></div></div></div>
    

  <p>
    OSGi Http Service support currently does not come out of the box with GlassFish, but is provided with a separate OSGi bundle,
    <a class="ulink" href="http://download.java.net/maven/glassfish/org/glassfish/osgi-http/3.1-SNAPSHOT/osgi-http-3.1-SNAPSHOT.jar" target="_top">http://download.java.net/maven/glassfish/org/glassfish/osgi-http/3.1-SNAPSHOT/osgi-http-3.1-SNAPSHOT.jar</a>.
    You will need to enable the feature first, by installing that bundle. After that, you can install and activate the Jersey application bundle.
    Following is the listing showing how both bundles could be installed and activated (Be sure to replace &lt;version&gt; with the current Jersey version and &lt;repository&gt; with either snapshots or releases based on whether you depend
on a snapshot or stable release version of Jersey respectively):
    </p>

    <p>
</p><pre class="programlisting">
g! install http://download.java.net/maven/glassfish/org/glassfish/osgi-http/3.1-SNAPSHOT/osgi-http-3.1-SNAPSHOT.jar
Bundle ID: 247
g! install https://maven.java.net/service/local/artifact/maven/redirect?r=&lt;repository&gt;&amp;g=com.sun.jersey.samples.osgi-http-service&amp;a=bundle&amp;v=&lt;version&gt;&amp;e=jar
Bundle ID: 248
g! start 247 248
</pre><p>
Now you should be able to access the Jersey resource at <a class="ulink" href="http://localhost:8080/osgi/jersey-http-service/status" target="_top">http://localhost:8080/osgi/jersey-http-service/status</a>
</p>

<p>
Finally, to close the Felix console session just press <code class="code">[Ctrl]-[d]</code>.
</p>
</div> 

</div>
  <div class="chapter" title="Chapter&nbsp;9.&nbsp;JRebel support"><div class="titlepage"><div><div><h2 class="title"><a name="jrebel"></a>Chapter&nbsp;9.&nbsp;JRebel support</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d4e1451">9.1. How to use JRebel with Jersey</a></span></dt><dt><span class="section"><a href="#d4e1457">9.2. Using JRebel with the hello world sample</a></span></dt><dt><span class="section"><a href="#d4e1472">9.3. Limitations</a></span></dt></dl></div>
    

    <p>Jersey provides basic support for JRebel. JRebel can be used to reload java
        classes at runtime without requiring to redeploy an application. This
        can improve developer productivity.
        Java source can be modified, recompiled, and JRebel will ensure changes
        will be reflected at runtime.</p>

    <p>JRebel isn't opensource and is not for free BUT Zeroturnaround (JRebel's author)
        provides a free license for open source project developers. More details can be found
        on the project website: <a class="ulink" href="http://www.zeroturnaround.com/jrebel/" target="_top">http://zeroturnaround.com/jrebel</a>.
        Jersey currently supports JRebel version 3.1.2.</p>

    <div class="section" title="9.1.&nbsp;How to use JRebel with Jersey"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1451"></a>9.1.&nbsp;How to use JRebel with Jersey</h2></div></div></div>
        

        <p>The jersey-jrebel dependency is required in the pom file:</p>

            <pre class="programlisting">        &lt;dependency&gt;
            &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
            &lt;artifactId&gt;jersey-jrebel&lt;/artifactId&gt;
            &lt;version&gt;1.9&lt;/version&gt;
        &lt;/dependency&gt;</pre>

        <p>The javarebel-maven-plugin plugin can be added to the pom to automatically configure
        JRebel for the case when java is executed from maven:</p>

            <pre class="programlisting">            &lt;plugin&gt;
                &lt;groupId&gt;org.zeroturnaround&lt;/groupId&gt;
                &lt;artifactId&gt;javarebel-maven-plugin&lt;/artifactId&gt;

                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;generate-rebel-xml&lt;/id&gt;
                        &lt;phase&gt;process-resources&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;generate&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;</pre>
    </div>

    <div class="section" title="9.2.&nbsp;Using JRebel with the hello world sample"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1457"></a>9.2.&nbsp;Using JRebel with the hello world sample</h2></div></div></div>
        

        <p>The following assumes that JRebel has been set up correctly (a JRebel informational message will
            be output if JRebel is enabled).</p>

        <p>
            Download the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.samples&amp;a=helloworld&amp;v=1.9&amp;c=project&amp;e=zip" target="_top">hello world sample</a>
      and modify the pom file in accordance with the prevous chapter.</p>

        <p>
            Compile Helloworld sample with <code class="code">mvn clean install</code> and run it with <code class="code">mvn exec:java</code>.
            The Helloworld application is deployed on Grizzly container.</p>

        <p>Use a browser and goto the following URL <a class="ulink" href="" target="_top">http://localhost:9998/helloworld</a>.
            Messages should be output indicating initialization of Jersey framework, and the browser should
            display <code class="code">Hello World</code>.</p>

        <p>Modify the <code class="code">HelloWorldResource.java</code> file such that the resource method <code class="code">getClichedMessage</code>
            returns a different String value. Run <code class="code">mvn compile</code>. Reload the browser window and
            the browser should display the modified message.</p>
    </div>

    <div class="section" title="9.3.&nbsp;Limitations"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1472"></a>9.3.&nbsp;Limitations</h2></div></div></div>
        
        <p>JRebel currently doesn't notify it's plugin about newly created classes
        that have no reference to existing classes, such as newly created resource or provder classes.
        However, its possible to detect a newly created resource class and use it in your
        application when you are doing some other changes to existing code.
        Why? After a change has beed made, Jersey re-initializes itself and the
        new class can be detected in the process. For this case you you have to
        use class or package scanning for detecting such resource classes.</p>
    </div>

</div>
  <div class="chapter" title="Chapter&nbsp;10.&nbsp;Experimental Features"><div class="titlepage"><div><div><h2 class="title"><a name="experimental"></a>Chapter&nbsp;10.&nbsp;Experimental Features</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#hypermedia">10.1. Hypermedia Actions</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1482">10.1.1. Introduction</a></span></dt><dt><span class="section"><a href="#d4e1500">10.1.2. Hypermedia by Example</a></span></dt><dt><span class="section"><a href="#d4e1523">10.1.3. Server API</a></span></dt><dt><span class="section"><a href="#d4e1560">10.1.4. Client API</a></span></dt><dt><span class="section"><a href="#d4e1610">10.1.5. Server Evolution</a></span></dt><dt><span class="section"><a href="#d4e1620">10.1.6. Configuring Hypermedia in Jersey</a></span></dt></dl></dd></dl></div>
    
    <p>This chapter describes experimental features of Jersey that are
    only available in maven SNAPSHOT releases. Such features are not intended to
    be utilized for stable development as the APIs may change.
    </p>
    <p>Providing such experimental features allows developers to experiment
    and provide feedback, please send feedback to <a class="ulink" href="mailto:users@jersey.java.net" target="_top">users@jersey.java.net</a>.</p>

    <div class="section" title="10.1.&nbsp;Hypermedia Actions"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="hypermedia"></a>10.1.&nbsp;Hypermedia Actions</h2></div></div></div>
    
    <div class="section" title="10.1.1.&nbsp;Introduction"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1482"></a>10.1.1.&nbsp;Introduction</h3></div></div></div>
        
        <p>It is generally understood that, in order to follow the REST style, URIs should be
            assigned to anything of interest (resources) and a few, well-defined operations should
            be used to interact with these resources. For example, the state of a purchase order
            resource can be updated by POSTing or PATCHing a new value for the its state field.
            However, there are actions that cannot be easily mapped to read or write operations on
            resources. These operations are inherently more complex and their details are rarely of
            interest to clients. For example, given a purchase order resource, the operation of
            setting its state to <code class="literal">REVIEWED</code> may involve a number of different steps
            such as: </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">checking the customer's credit status</li><li class="listitem">reserving product inventory</li><li class="listitem">verifying per-customer quantity limits.</li></ol></div><p> Clearly, this <span class="emphasis"><em>workflow</em></span> cannot be equated to simply
            updating a field on a resource. Moreover, clients are generally uninterested in the
            details behind these type of workflows, and in some cases computing the final state of a
            resource on the client side, as required for a PUT operation, is impractical or
            impossible.</p>
        <p>We call these operations <span class="emphasis"><em>actions</em></span> and, because they are of
            interest to us, we turn them into <span class="emphasis"><em>action resources</em></span>. An action
            resource is a sub-resource defined for the purpose of exposing workflow-related
            operations on parent resources. As sub-resources, action resources are identified by
            URIs that are relative to their parent. For instance, the following are examples of
            action resources:
            </p><pre class="programlisting">    http://.../orders/1/review
    http://.../orders/1/pay
    http://.../orders/1/ship</pre><p>
            for purchase order "1" identified by <code class="literal">http://.../orders/1</code>.</p>
        <p>Action resources as first-class citizens provide the necessary tools for developers to
            implement HATEOAS. A set of action resources defines --via their link relationships-- a
                <span class="emphasis"><em>contract</em></span> with clients that has the potential to evolve over
            time depending on the application's state. For instance, assuming purchase orders are
            only reviewed once, the <code class="literal">review</code> action will become unavailable and the
                <code class="literal">pay</code> action will become available after an order is
        reviewed.</p>
    </div>
    <div class="section" title="10.1.2.&nbsp;Hypermedia by Example"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1500"></a>10.1.2.&nbsp;Hypermedia by Example</h3></div></div></div>
        
        <p>The notion of action resources naturally leads to discussions about improved client
            APIs to support them. Given that action resources are identified by URIs, no additional
            API is really necessary, but the use of client-side proxies and method invocations to
            trigger these actions seems quite natural. Additionally, the use of client proxies
            introduces a level of indirection that enables better support for <span class="emphasis"><em>server
                evolution</em></span>, i.e. the ability of a server's contract to support certain
            changes without breaking existing clients. Finally, it has been argued that using client
            proxies is simply more natural for developers and less error prone as fewer URIs need to
            be constructed.</p>
        <p>Rather than presenting all these extensions abstractly, we shall illustrate their use
            via an example. The complete example can found in <a class="ulink" href="https://maven.java.net/content/repositories/releases/com/sun/jersey/experimental/hypermedia-action/hypermedia-action-sample" target="_top">hypermedia-action-sample</a>. The <span class="emphasis"><em>Purchase Ordering System</em></span>
            exemplifies a system in which customers can submit orders and where orders are guided by
            a workflow that includes states like <code class="literal">REVIEWED</code>,
            <code class="literal">PAYED</code> and <code class="literal">SHIPPED</code>. The system's model is comprised
            of 4 entities: <code class="literal">Order</code>, <code class="literal">Product</code>,
            <code class="literal">Customer</code> and <code class="literal">Address</code>. These model entities are
            controlled by 3 resource classes: <code class="literal">OrderResource</code>,
                <code class="literal">CustomerResource</code> and <code class="literal">ProductResource</code>.
            Addresses are sub-resources that are also controlled by
            <code class="literal">CustomerResource</code>. An order instance refers to a single customer, a
            single address (of that customer) and one or more products. The XML representation (or
            view) of a sample order is shown below. </p><pre class="programlisting">    &lt;order&gt;
        &lt;id&gt;1&lt;/id&gt;
        &lt;customer&gt;http://.../customers/21&lt;/customer&gt;
        &lt;shippingAddress&gt;http://.../customers/21/address/1&lt;/shippingAddress&gt;
        &lt;orderItems&gt;
            &lt;product&gt;http://.../products/3345&lt;/product&gt;
            &lt;quantity&gt;1&lt;/quantity&gt;
        &lt;/orderItems&gt;
        &lt;status&gt;RECEIVED&lt;/status&gt;
    &lt;/order&gt;</pre><p> Note the use of URIs to refer to each component of an order. This
            form of <span class="emphasis"><em>serialization by reference</em></span> is supported in Jersey using
            JAXB beans and the <code class="literal">@XmlJavaTypeAdapter</code> annotation. An
                <code class="literal">XmlAdapter</code> is capable of mapping an object reference in the model
            to a URI. Refer to <a class="ulink" href="https://maven.java.net/content/repositories/releases/com/sun/jersey/experimental/hypermedia-action/hypermedia-action-sample" target="_top">hypermedia-action-sample</a> for more information on how this mapping is
        implemented.</p>
    </div>
    <div class="section" title="10.1.3.&nbsp;Server API"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1523"></a>10.1.3.&nbsp;Server API</h3></div></div></div>
        
        <p>The server API introduces 3 new annotation types: <code class="literal">@Action</code>,
                <code class="literal">@ContextualActionSet</code> and
            <code class="literal">@HypermediaController</code>. The <code class="literal">@Action</code> annotation
            identifies a sub-resource as a <span class="emphasis"><em>named action</em></span>. The
                <code class="literal">@ContextualActionSet</code> is used to support contextual contracts and
            must annotate a method that returns a set of action names. Finally,
                <code class="literal">@HypermediaController</code> marks a resource class as a
                <span class="emphasis"><em>hypermedia controller class</em></span>: a class with one more methods
            annotated with <code class="literal">@Action</code> and at most one method annotated with
                <code class="literal">@ContextualActionSet</code>.</p>
        <p>The following example illustrates the use of all these annotation types to define the
                <code class="literal">OrderResource</code> controller.<sup>[<a name="d4e1538" href="#ftn.d4e1538" class="footnote">2</a>]</sup>
            </p><pre class="programlisting">&nbsp;&nbsp;1     @Path("/orders/{id}")
&nbsp;&nbsp;2     @HypermediaController(
&nbsp;&nbsp;3         model=Order.class,
&nbsp;&nbsp;4         linkType=LinkType.LINK_HEADERS)
&nbsp;&nbsp;5     public class OrderResource {
&nbsp;&nbsp;6         
&nbsp;&nbsp;7         private Order order;
&nbsp;&nbsp;8     
&nbsp;&nbsp;9         ...
&nbsp;10         
&nbsp;11         @GET @Produces("application/xml")
&nbsp;12         public Order getOrder(@PathParam("id") String id) {      
&nbsp;13             return order;
&nbsp;14         }
&nbsp;15         
&nbsp;16         @POST @Action("review") @Path("review")
&nbsp;17         public void review(@HeaderParam("notes") String notes) {
&nbsp;18             ...
&nbsp;19             order.setStatus(REVIEWED);
&nbsp;20         }
&nbsp;21         
&nbsp;22         @POST @Action("pay") @Path("pay")
&nbsp;23         public void pay(@QueryParam("newCardNumber") String newCardNumber) {
&nbsp;24             ...
&nbsp;25             order.setStatus(PAYED);
&nbsp;26         }
&nbsp;27         
&nbsp;28         @PUT @Action("ship") @Path("ship")
&nbsp;29         @Produces("application/xml")
&nbsp;30         @Consumes("application/xml")
&nbsp;31         public Order ship(Address newShippingAddress) {
&nbsp;32             ...
&nbsp;33             order.setStatus(SHIPPED);
&nbsp;34             return order;
&nbsp;35         }
&nbsp;36         
&nbsp;37         @POST @Action("cancel") @Path("cancel")
&nbsp;38         public void cancel(@QueryParam("notes") String notes) {
&nbsp;39             ...
&nbsp;40             order.setStatus(CANCELED);
&nbsp;41         }
&nbsp;42     }</pre><p>
        </p>
        <p>The <code class="literal">@HypermediaController</code> annotation above indicates that this
            resource class is a hypermedia controller for the <code class="literal">Order</code> class. Each
            method annotated with <code class="literal">@Action</code> defines a link relationship and
            associated action resource. These methods are also annotated with
            <code class="literal">@Path</code> to make a sub-resource. There does not appear to be a need to
            use <code class="literal">@Action</code> and <code class="literal">@Path</code> simultaneously, but without
            the latter some resource methods may become ambiguous. In the future, we hope to
            eliminate the use of <code class="literal">@Path</code> when <code class="literal">@Action</code> is
            present. The element <code class="literal">linkType</code> selects the way in which URIs
            corresponding to action resources are serialized: in this case, using link headers.
            These link headers become part of the an order's representation. For instance, an order
            in the <code class="literal">RECEIVED</code> state, i.e. an order that can only be reviewed or
            canceled, will be represented as follows. </p><pre class="programlisting">    Link: &lt;http://.../orders/1/review&gt;;rel=review;op=POST
    Link: &lt;http://.../orders/1/cancel&gt;;rel=cancel;op=POST
    &lt;order&gt;
        &lt;id&gt;1&lt;/id&gt;
        &lt;customer&gt;http://.../customers/21&lt;/customer&gt;
        &lt;shippingAddress&gt;http://.../customers/21/address/1&lt;/shippingAddress&gt;
        &lt;orderItems&gt;
            &lt;product&gt;http://.../products/3345&lt;/product&gt;
            &lt;quantity&gt;1&lt;/quantity&gt;
        &lt;/orderItems&gt;
        &lt;status&gt;RECEIVED&lt;/status&gt;
    &lt;/order&gt;</pre><p>
        </p>
        <p>Without a method annotated with <code class="literal">@ContextualActionSet</code>, all actions
            are available at all times regardless of the state of an order. The following method can
            be provided to define a contextual contract for this resource. </p><pre class="programlisting">&nbsp;&nbsp;1     @ContextualActionSet
&nbsp;&nbsp;2     public Set&lt;String&gt; getContextualActionSet() {
&nbsp;&nbsp;3         Set&lt;String&gt; result = new HashSet&lt;String&gt;();
&nbsp;&nbsp;4         switch (order.getStatus()) {
&nbsp;&nbsp;5             case RECEIVED:
&nbsp;&nbsp;6                 result.add("review");
&nbsp;&nbsp;7                 result.add("cancel");
&nbsp;&nbsp;8                 break;
&nbsp;&nbsp;9             case REVIEWED:
&nbsp;10                 result.add("pay");
&nbsp;11                 result.add("cancel");
&nbsp;12                 break;
&nbsp;13             case PAYED:
&nbsp;14                 result.add("ship");
&nbsp;15                 break;
&nbsp;16             case CANCELED:
&nbsp;17             case SHIPPED:
&nbsp;18                 break;
&nbsp;19         }
&nbsp;20         return result;
&nbsp;21     }</pre><p>
        </p>
        <p>This method returns a set of action names based on the order's internal state; the
            values returned in this set correspond to the <code class="literal">@Action</code> annotations in
            the controller. For example, this contextual contract prevents shipping an order that
            has not been payed by only including the <code class="literal">ship</code> action in the
                <code class="literal">PAYED</code> state.</p>
    </div>
    <div class="section" title="10.1.4.&nbsp;Client API"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1560"></a>10.1.4.&nbsp;Client API</h3></div></div></div>
        
        <p>Although action resources can be accessed using traditional APIs for REST, including
            Jersey's client API, the use of client-side proxies and method invocations to trigger
            these actions seems quite natural. As we shall see, the use of client proxies also
            introduces a level of indirection that enables better support for server evolution,
            permitting the definition of contracts with various degrees of coupling.</p>
        <p>Client proxies are created based on <span class="emphasis"><em>hypermedia controller
            interfaces</em></span>. Hypermedia controller interfaces are Java interfaces annotated by
                <code class="literal">@HypermediaController</code> that, akin to the server side API, specify
            the name of a model class and the type of serialization to use for action resource URIs.
            The client-side model class should be based on the representation returned by the
            server; in particular, in our example the client-side model for an
            <code class="literal">Order</code> uses instances of <code class="literal">URI</code> to link an order to a
            customer, an address and a list of products. </p><pre class="programlisting">&nbsp;&nbsp;1     @HypermediaController(
&nbsp;&nbsp;2         model=Order.class,
&nbsp;&nbsp;3         linkType=LinkType.LINK_HEADERS)
&nbsp;&nbsp;4     public interface OrderController {
&nbsp;&nbsp;5         
&nbsp;&nbsp;6         public Order getModel();
&nbsp;&nbsp;7         
&nbsp;&nbsp;8         @Action("review")
&nbsp;&nbsp;9         public void review(@Name("notes") String notes);
&nbsp;10         
&nbsp;11         @POST @Action("pay")
&nbsp;12         public void pay(@QueryParam("newCardNumber") String newCardNumber);
&nbsp;13         
&nbsp;14         @Action("ship")
&nbsp;15         public Order ship(Address newShippingAddress);
&nbsp;16         
&nbsp;17         @Action("cancel")
&nbsp;18         public void cancel(@Name("notes") String notes);
&nbsp;19     }</pre><p>
        </p>
        <p>The <code class="literal">@Action</code> annotation associates an interface method with a link
            relation and hence an action resource on the server. Thus, invoking a method on the
            generated proxy results in an interaction with the corresponding action resource. The
            way in which the method invocation is mapped to an HTTP request depends on the
            additional annotations specified in the interface. For instance, the
            <code class="literal">pay</code> action in the example above indicates that it must use a
                <code class="literal">POST</code> and that the <code class="literal">String</code> parameter
                <code class="literal">newCardNumber</code> must be passed as a query parameter. This is an
            example of a <span class="emphasis"><em>static</em></span> contract in which the client has built-in
            knowledge of the way in which an action is defined by the server.</p>
        <p>In contrast, the <code class="literal">review</code> action only provides a name for its
            parameter using the <code class="literal">@Name</code> annotation. This is an example of a
                <span class="emphasis"><em>dynamic</em></span> contract in which the client is only coupled to the
                <code class="literal">review</code> link relation and the knowledge that this relation
            requires <code class="literal">notes</code> to be supplied. The exact interaction with the
                <code class="literal">review</code> action must therefore be discovered dynamically and the
                <code class="literal">notes</code> parameter mapped accordingly. The Jersey client runtime
            uses WADL fragments that describe action resources to map these method calls into HTTP
            requests.</p>
        <p>The following sample shows how to use <code class="literal">OrderController</code> to generate a
            proxy to review, pay and ship an order. For the sake of the example, we assume the
            customer that submitted the order has been suspended and needs to be activated before
            the order is reviewed. For that purpose, the client code retrieves the customer URI from
            the order's model and obtains an instance of <code class="literal">CustomerController</code>.<sup>[<a name="d4e1587" href="#ftn.d4e1587" class="footnote">3</a>]</sup>
            </p><pre class="programlisting">&nbsp;&nbsp;1     // Instantiate Jersey's Client class
&nbsp;&nbsp;2     Client client = new Client();
&nbsp;&nbsp;3         
&nbsp;&nbsp;4     // Create proxy for order and retrieve model
&nbsp;&nbsp;5     OrderController orderCtrl = client.view(
&nbsp;&nbsp;6         "http://.../orders/1", OrderController.class);
&nbsp;&nbsp;7         
&nbsp;&nbsp;8     // Create proxy for customer in order 1
&nbsp;&nbsp;9     CustomerController customerCtrl = client.view(
&nbsp;10         orderCtrl.getModel().getCustomer(),
&nbsp;11         CustomerController.class);
&nbsp;12         
&nbsp;13     // Activate customer in order 1 
&nbsp;14     customerCtrl.activate();
&nbsp;15         
&nbsp;16     // Review and pay order 
&nbsp;17     orderCtrl.review("approve");
&nbsp;18     orderCtrl.pay("123456789");
&nbsp;19         
&nbsp;20     // Ship order 
&nbsp;21     Address newAddress = getNewAddress();
&nbsp;22     orderCtrl.ship(newAddress);</pre><p>
        </p>
        <p>The client runtime will automatically update the action set throughout a conversation:
            for example, even though the <code class="literal">review</code> action does not produce a result,
            the HTTP response to that action still includes a list of link headers defining the
            contextual action set, which in this case will consist of the <code class="literal">pay</code> and
                <code class="literal">cancel</code> actions but not the <code class="literal">ship</code> action. An 
            attempt to interact with any action not in the contextual action set will result in
            a client-side exception if using proxies (as shown above), or a server-side exception 
            if using some other API.</p>
        <p>The following annotations are allowed in hypermedia controller interfaces:
                <code class="literal">@Name</code>, <code class="literal">@Consumes</code>,
            <code class="literal">@Produces</code>, <code class="literal">@CookieParam</code>,
            <code class="literal">@FormParam</code>, <code class="literal">@HeaderParam</code>,
            <code class="literal">@QueryParam</code>, as well as any HTTP method annotation like
                <code class="literal">@POST</code>, <code class="literal">@PUT</code>, etc. All other annotations not
            listed here are unsupported at this time (of note, <code class="literal">@MatrixParam</code> is
            not supported). The <code class="literal">@Name</code> annotation used in Jersey is defined in
                <code class="literal">com.sun.jersey.core.hypermedia</code>.</p>
    </div>
    <div class="section" title="10.1.5.&nbsp;Server Evolution"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1610"></a>10.1.5.&nbsp;Server Evolution</h3></div></div></div>
        
        <p>In the last section, we have seen how the use of client proxies based on
                <span class="emphasis"><em>partially</em></span> annotated interfaces facilitates server evolution. An
            interface method annotated with <code class="literal">@Action</code> and <code class="literal">@Name</code>
            represents a <span class="emphasis"><em>loosely-coupled</em></span> contract with a server. Changes to
            action resource URIs, HTTP methods and parameter types on the server will not require a
            client re-spin. Naturally, as in all client-server architectures, it is always possible
            to break backward compatibility, but the ability to support more dynamic contracts
            --usually at the cost of additional processing time-- is still an area of investigation.</p>
        <p> We see this form of hypermedia support in Jersey as a small step in this direction,
            showing the potential of using dynamic meta-data for the definition of these type of
            contracts. The use of dynamic meta-data requires the server to return WADL fragments
            when using <code class="literal">OPTIONS</code> on an action resource URI. When dynamic meta-data
            is not available (for example if using an older version of Jersey on the server) client
            interfaces should be fully annotated and a <span class="emphasis"><em>tighly-coupled</em></span> contract
            should be used instead.</p>
    </div>
    <div class="section" title="10.1.6.&nbsp;Configuring Hypermedia in Jersey"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1620"></a>10.1.6.&nbsp;Configuring Hypermedia in Jersey</h3></div></div></div>
        
        <p>There are a few configuration options in <a class="ulink" href="https://maven.java.net/content/repositories/releases/com/sun/jersey/experimental/hypermedia-action/hypermedia-action-sample" target="_top">hypermedia-action-sample</a> that are worth highlighting. First, a
            special filter factory <code class="literal">HypermediaFilterFactory</code> must
            be enabled. This can be done programmatically by adding
            </p><pre class="programlisting">com.sun.jersey.server.hypermedia.filter.HypermediaFilterFactory</pre><p> to the list defined by
            </p><pre class="programlisting">com.sun.jersey.spi.container.ResourceFilters</pre><p> or
            declaratively in the application's <code class="literal">web.xml</code> file. Refer to the Java class
            <code class="literal">com.sun.jersey.samples.hypermedia.Main</code> in the hypermedia sample for an example of how
            to do this using Grizzly (which can be executed with <code class="literal">mvn install exec:java</code>). Second, hypermedia applications must included the
            following Maven runtime dependencies:
            </p><pre class="programlisting">
        &lt;dependency&gt;
            &lt;groupId&gt;com.sun.jersey.experimental.hypermedia-action&lt;/groupId&gt;
            &lt;artifactId&gt;hypermedia-action-server&lt;/artifactId&gt;
            &lt;version&gt;${jersey-version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.sun.jersey.experimental.hypermedia-action&lt;/groupId&gt;
            &lt;artifactId&gt;hypermedia-action-client&lt;/artifactId&gt;
            &lt;version&gt;${jersey-version}&lt;/version&gt;
        &lt;/dependency&gt;</pre>
        <p>
            Last, even though the annotation <code class="literal">@HypermediaController</code> has
            a <code class="literal">linkType</code> element, only the <code class="literal">LinkType.LINK_HEADERS</code>
            option is currently supported and must be used by both clients and servers.
        </p>
    </div>
</div>
<div class="footnotes"><br><hr width="100" align="left"><div class="footnote">
                <p><sup>[<a name="ftn.d4e1538" href="#d4e1538" class="para">2</a>] </sup>Several details about this class are omitted for clarity. The reader is
                    referred to the hypermedia sample for more details.</p>
            </div><div class="footnote">
                <p><sup>[<a name="ftn.d4e1587" href="#d4e1587" class="para">3</a>] </sup>
                    <code class="literal">CustomerController</code> is a hypermedia controller interface akin
                    to <code class="literal">OrderController</code> which is omitted since it does not
                    highlight any additional feature.</p>
            </div></div></div>
  <div class="chapter" title="Chapter&nbsp;11.&nbsp;Dependencies"><div class="titlepage"><div><div><h2 class="title"><a name="chapter_deps"></a>Chapter&nbsp;11.&nbsp;Dependencies</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#core_server">11.1. Core server</a></span></dt><dt><span class="section"><a href="#core_client">11.2. Core client</a></span></dt><dt><span class="section"><a href="#d4e1720">11.3. Container</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1722">11.3.1. Grizzly HTTP Web server</a></span></dt><dt><span class="section"><a href="#d4e1730">11.3.2. Simple HTTP Web server</a></span></dt><dt><span class="section"><a href="#d4e1734">11.3.3. Light weight HTTP server</a></span></dt><dt><span class="section"><a href="#d4e1737">11.3.4. Servlet</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e1749">11.4. Entity</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1751">11.4.1. JAXB</a></span></dt><dt><span class="section"><a href="#d4e1796">11.4.2. Atom</a></span></dt><dt><span class="section"><a href="#d4e1817">11.4.3. JSON</a></span></dt><dt><span class="section"><a href="#d4e1829">11.4.4. Mail and MIME multipart</a></span></dt><dt><span class="section"><a href="#d4e1850">11.4.5. Activation</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e1854">11.5. Tools</a></span></dt><dt><span class="section"><a href="#d4e1858">11.6. Spring</a></span></dt><dt><span class="section"><a href="#d4e1865">11.7. Guice</a></span></dt><dt><span class="section"><a href="#d4e1881">11.8. Jersey Test Framework</a></span></dt></dl></div>
  

  <p>Jersey is built, assembled and installed using Maven. Jersey is
  deployed to the Java.Net maven repository at the following location: <a class="ulink" href="http://maven.java.net/" target="_top">http://maven.java.net/</a>.
  The Jersey modules can be browsed at the following location: <a class="ulink" href="https://maven.java.net/content/repositories/releases/com/sun/jersey" target="_top">https://maven.java.net/content/repositories/releases/com/sun/jersey</a>.
  Jars, Jar sources, Jar JavaDoc and samples are all available on the java.net
  maven repository.</p>

  <p>A zip file containing all maven-based samples can be obtained <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.samples&amp;a=jersey-samples&amp;v=1.9&amp;e=zip&amp;c=project" target="_top">here</a>.
  Individual zip files for each sample may be found by browsing the <a class="ulink" href="https://maven.java.net/content/repositories/releases/com/sun/jersey/samples/" target="_top">samples</a>
  directory.</p>

  <p>An application depending on Jersey requires that it in turn includes
  the set of jars that Jersey depends on. Jersey has a pluggable component
  architecture so the set of jars required to be include in the class path can
  be different for each application.</p>
  
  <p>
  All Jersey components are built using Java SE 6 compiler. It means, you will also need at least Java SE 6
  to be able to compile and run your application.
  </p>

  <p>Developers using maven are likely to find it easier to include and
  manage dependencies of their applications than developers using ant or other
  build technologies. This document will explain to both maven and non-maven
  developers how to depend on Jersey for their application. Ant developers are
  likely to find the <a class="ulink" href="http://maven.apache.org/ant-tasks.html" target="_top">Ant
  Tasks for Maven</a> very useful. For the convenience of non-maven
  developers the following are provided: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
        <p>A <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-archive&amp;v=1.9&amp;e=zip" target="_top">zip
        of Jersey</a> containing the Jersey jars, core dependencies (it
        does not provide dependencies for third party jars beyond those
        for JSON support) and JavaDoc.</p>
      </li><li class="listitem">
        <p>A <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-bundle&amp;v=1.9&amp;e=jar" target="_top">jersey
        bundle jar</a> to avoid the dependency management of multiple
        jersey-based jars.</p>
      </li></ul></div>

  <p>Jersey's runtime dependences are categorized into the following:
  </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
        <p>Core server. The minimum set of dependences that Jersey requires
        for the server.</p>
      </li><li class="listitem">
        <p>Core client. The minimum set of dependences that Jersey requires
        for the client.</p>
      </li><li class="listitem">
        <p>Container. The set of container dependences. Each container
        provider has it's own set of dependences.</p>
      </li><li class="listitem">
        <p>Entity. The set of entity dependencies. Each entity provider has
        it's own set of dependences.</p>
      </li><li class="listitem">
        <p>Tools. The set of dependencies required for runtime
        tooling.</p>
      </li><li class="listitem">
        <p>Spring. The set of dependencies required for Spring.</p>
      </li><li class="listitem">
        <p>Guice. The set of dependencies required for Guice.</p>
      </li></ul></div>

  <p>All dependences in this documented are referenced by
  hyper-links</p>

  <div class="section" title="11.1.&nbsp;Core server"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="core_server"></a>11.1.&nbsp;Core server</h2></div></div></div>
    

    <p>Maven developers require a dependency on the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-server&amp;v=1.9&amp;e=pom" target="_top">jersey-server</a>
    module. The following dependency needs to be added to the pom:
    </p><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
    &lt;artifactId&gt;jersey-server&lt;/artifactId&gt;
    &lt;version&gt;1.9&lt;/version&gt;
&lt;/dependency&gt;</pre>

    <p>And the following repositories need to be added to the pom::
    </p><pre class="programlisting">&lt;repository&gt;
    &lt;id&gt;maven2-repository.java.net&lt;/id&gt;
    &lt;name&gt;Java.net Repository for Maven&lt;/name&gt;
    &lt;url&gt;http://download.java.net/maven/2&lt;/url&gt;
    &lt;layout&gt;default&lt;/layout&gt;
&lt;/repository&gt;
&lt;repository&gt;
    &lt;id&gt;maven-repository.java.net&lt;/id&gt;
    &lt;name&gt;Java.net Maven 1 Repository&lt;/name&gt;
    &lt;url&gt;http://download.java.net/maven/1&lt;/url&gt;
    &lt;layout&gt;legacy&lt;/layout&gt;
&lt;/repository&gt;</pre> 

    <p>If you want to depend on Jersey snapshot versions the following repository needs to be added to the pom:
    </p><pre class="programlisting">&lt;repository&gt;
    &lt;id&gt;snapshot-repository.java.net&lt;/id&gt;
    &lt;name&gt;Java.net Snapshot Repository for Maven&lt;/name&gt;
    &lt;url&gt;https://maven.java.net/content/repositories/snapshots/&lt;/url&gt;
    &lt;layout&gt;default&lt;/layout&gt;
&lt;/repository&gt;</pre> 

    <p>Non-maven developers require: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
          <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-server&amp;v=1.9&amp;e=jar" target="_top">jersey-server.jar</a>

          ,
        </li><li class="listitem">
          <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-core&amp;v=1.9&amp;e=jar" target="_top">jersey-core.jar</a>

          ,
        </li><li class="listitem">
          <a class="ulink" href="http://repo1.maven.org/maven2/asm/asm/3.1/asm-3.1.jar" target="_top">asm.jar</a>
        </li></ul></div><p> or, if using the jersey-bundle: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
          <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-bundle&amp;v=1.9&amp;e=jar" target="_top">jersey-bundle.jar</a>

          ,
        </li><li class="listitem">
          <a class="ulink" href="http://repo1.maven.org/maven2/asm/asm/3.1/asm-3.1.jar" target="_top">asm.jar</a>
        </li></ul></div><p> For Ant developers the <a class="ulink" href="http://maven.apache.org/ant-tasks.html" target="_top">Ant Tasks for Maven</a>
    may be used to add the following to the ant document such that the
    dependencies do not need to be downloaded explicitly: </p><pre class="programlisting">&lt;artifact:dependencies pathId="dependency.classpath"&gt;
  &lt;dependency groupId="com.sun.jersey"
              artifactId="jersey-server"
              version="1.9"/&gt;
  &lt;artifact:remoteRepository id="maven-repository.java.net"
                             url="http://maven.java.net/" /&gt;
  &lt;artifact:remoteRepository id="maven1-repository.java.net"
                             url="http://download.java.net/maven/1"
                             layout="legacy" /&gt;
&lt;/artifact:dependencies&gt;</pre><p> The path id
    &#8220;dependency.classpath&#8221; may then be referenced as the classpath to be used
    for compiling or executing. Specifically the <a class="ulink" href="http://repo1.maven.org/maven2/asm/asm/3.1/asm-3.1.jar" target="_top">asm.jar</a>
    dependency is required when either of the following <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/core/ResourceConfig.html" target="_top">com.sun.jersey.api.core.ResourceConfig</a>
    implementations are utilized: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
          <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/core/ClasspathResourceConfig.html" target="_top">com.sun.jersey.api.core.ClasspathResourceConfig</a>

          ; or
        </li><li class="listitem">
          <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/core/PackagesResourceConfig.html" target="_top">com.sun.jersey.api.core.PackagesResourceConfig</a>
        </li></ul></div>

    <p>By default Jersey will utilize the <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/api/core/ClasspathResourceConfig.html" target="_top">ClasspathResourceConfig</a>
    if an alternative is not specified. If an alternative is specified that
    does not depend on the asm.jar then it is no longer necessary to include
    the asm.jar in the minimum set of required jars.</p>
  </div>

  <div class="section" title="11.2.&nbsp;Core client"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="core_client"></a>11.2.&nbsp;Core client</h2></div></div></div>
    

    <p>Maven developers require a dependency on the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-client&amp;v=1.9&amp;e=pom" target="_top">jersey-client</a>
    module. The following dependency needs to be added to the pom:
    </p><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
    &lt;artifactId&gt;jersey-client&lt;/artifactId&gt;
    &lt;version&gt;1.9&lt;/version&gt;
&lt;/dependency&gt;</pre><p> Non-maven developers require:
    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
          <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-client&amp;v=1.9&amp;e=jar" target="_top">jersey-client.jar</a>

          ,
        </li><li class="listitem">
          <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-core&amp;v=1.9&amp;e=jar" target="_top">jersey-core.jar</a>

          ,
        </li></ul></div><p> or, if using the jersey-bundle: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
          <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-bundle&amp;v=1.9&amp;e=jar" target="_top">jersey-bundle.jar</a>

          ,
        </li></ul></div>

    <p>The use of client with the Apache HTTP client to make HTTP request
    and receive HTTP responses requires a dependency on the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.contribs&amp;a=jersey-apache-client&amp;v=1.9&amp;e=pom" target="_top">jersey-apache-client</a>
    module. The following dependency needs to be added to the pom:
    </p><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;com.sun.jersey.contribs&lt;/groupId&gt;
    &lt;artifactId&gt;jersey-apache-client&lt;/artifactId&gt;
    &lt;version&gt;1.9&lt;/version&gt;
&lt;/dependency&gt;</pre>
  </div>

  <div class="section" title="11.3.&nbsp;Container"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1720"></a>11.3.&nbsp;Container</h2></div></div></div>
    

    <div class="section" title="11.3.1.&nbsp;Grizzly HTTP Web server"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1722"></a>11.3.1.&nbsp;Grizzly HTTP Web server</h3></div></div></div>
      

      <p>Maven developers, deploying an application using the Grizzly HTTP
      Web server, require a dependency on the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-grizzly&amp;v=1.9&amp;e=pom" target="_top">jersey-grizzly</a>
 and <a class="ulink" href="http://download.java.net/maven/2/com/sun/grizzly/grizzly-servlet-webserver/1.9.18-i/grizzly-servlet-webserver-1.9.18-i.pom" target="_top">grizzly-servlet-webserver</a>
      module.</p>

      <p>Non-maven developers require: <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-grizzly&amp;v=1.9&amp;e=jar" target="_top">jersey-grizzly.jar</a>
 and <a class="ulink" href="http://download.java.net/maven/2/com/sun/grizzly/grizzly-servlet-webserver/1.9.18-i/grizzly-servlet-webserver-1.9.18-i.jar" target="_top">grizzly-servlet-webserver.jar</a></p>
    </div>

    <div class="section" title="11.3.2.&nbsp;Simple HTTP Web server"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1730"></a>11.3.2.&nbsp;Simple HTTP Web server</h3></div></div></div>
      

      <p>Maven developers, deploying an application using the Simple HTTP
      Web server, require a dependency on the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.contribs&amp;a=jersey-simple-server&amp;v=1.9&amp;e=pom" target="_top">jersey-simple-server</a>
      module.</p>
    </div>
    <div class="section" title="11.3.3.&nbsp;Light weight HTTP server"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1734"></a>11.3.3.&nbsp;Light weight HTTP server</h3></div></div></div>
      

      <p>Deploying an application using the light weight HTTP server
      requires no additional dependences, as Java SE 6 already contains everything needed.</p>
    </div>

    <div class="section" title="11.3.4.&nbsp;Servlet"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1737"></a>11.3.4.&nbsp;Servlet</h3></div></div></div>
      

      <p>Deploying an application on a servlet container requires a
      deployment dependency with that container.</p>

      <p>See the Java documentation <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey/com/sun/jersey/spi/container/servlet/package-summary.html" target="_top">here</a>
      on how to configure the servlet container.</p>

      <p>Using servlet:
      <code class="code">com.sun.jersey.spi.container.servlet.ServletContainer</code>
      requires no additional dependences.</p>

      <p>Maven developers using servlet:
      <code class="code">com.sun.jersey.server.impl.container.servlet.ServletAdaptor</code>
      in a non-EE 5 servlet require a dependency on the <a class="ulink" href="http://download.java.net/maven/1/javax.persistence/poms/persistence-api-1.0.2.pom" target="_top">persistence-api</a>
      module.</p>

      <p>Non-Maven developers require: <a class="ulink" href="http://download.java.net/maven/1/javax.persistence/jars/persistence-api-1.0.2.jar" target="_top">persistence-api.jar</a></p>
    </div>
  </div>

  <div class="section" title="11.4.&nbsp;Entity"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1749"></a>11.4.&nbsp;Entity</h2></div></div></div>
    

    <div class="section" title="11.4.1.&nbsp;JAXB"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1751"></a>11.4.1.&nbsp;JAXB</h3></div></div></div>
      

      <p>XML serialization support of Java types that are JAXB beans
      requires a dependency on the JAXB reference implementation version 2.x
      or higher (see later for specific version constraints with respect to
      JSON support). Deploying an application for XML serialization support
      requires no additional dependences, since Java SE 6 ships with JAXB 2.x support.</p>


      <p>Maven developers, using JSON serialization support of JAXB beans
      when using the MIME media type <code class="code">application/json</code> require a
      dependency on the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-json&amp;v=1.9&amp;e=pom" target="_top">jersey-json</a>
      module (no explicit dependency on jaxb-impl is required). This module
      depends on the JAXB reference implementation version 2.1.12 or greater,
      and such a version is required when enabling support for the JAXB
      natural JSON convention. For all other supported JSON conventions any
      JAXB 2.x version may be utilized. The following dependency needs to be
      added to the pom: </p><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
    &lt;artifactId&gt;jersey-json&lt;/artifactId&gt;
    &lt;version&gt;1.9&lt;/version&gt;
&lt;/dependency&gt;</pre>

      <p>Non-maven developers require: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <a class="ulink" href="http://repository.codehaus.org/org/codehaus/jackson/jackson-core-asl/1.8.3/jackson-core-asl-1.8.3.jar" target="_top">jackson-core-asl.jar</a>

            ,
          </li><li class="listitem">
            <a class="ulink" href="http://repository.codehaus.org/org/codehaus/jackson/jackson-mapper-asl/1.8.3/jackson-mapper-asl-1.8.3.jar" target="_top">jackson-mapper-asl.jar</a>

            ,
          </li><li class="listitem">
            <a class="ulink" href="http://repository.codehaus.org/org/codehaus/jackson/jackson-jaxrs/1.8.3/jackson-jaxrs-1.8.3.jar" target="_top">jackson-jaxrs.jar</a>

            ,
          </li><li class="listitem">
            <a class="ulink" href="http://repo1.maven.org/maven2/org/codehaus/jettison/jettison/1.1/jettison-1.1.jar" target="_top">jettison.jar</a>

            ,
          </li><li class="listitem">
            <a class="ulink" href="http://download.java.net/maven/1/com.sun.xml.bind/jars/jaxb-impl-2.1.12.jar" target="_top">jaxb-impl.jar</a>

            ,
          </li><li class="listitem">
            <a class="ulink" href="http://download.java.net/maven/1/javax.xml.bind/jars/jaxb-api-2.1.jar" target="_top">jaxb-api.jar</a>

            ,
          </li><li class="listitem">
            <a class="ulink" href="http://download.java.net/maven/1/javax.activation/jars/activation-1.1.jar" target="_top">activation.jar</a>

            ,
          </li><li class="listitem">
            <a class="ulink" href="http://download.java.net/maven/1/javax.xml.stream/jars/stax-api-1.0-2.jar" target="_top">stax-api.jar</a>
          </li></ul></div><p> and additionally, if not depending on the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-bundle&amp;v=1.9&amp;e=jar" target="_top">jersey-bundle.jar</a>,
      non-maven developers require: <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-json&amp;v=1.9&amp;e=jar" target="_top">jersey-json.jar</a></p>
      <p>Maven developers, using Fast Infoset serialization support of JAXB
      beans with using the MIME media type
      <code class="code">application/fastinfoset</code> require a dependency on the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-fastinfoset&amp;v=1.9&amp;e=pom" target="_top">jersey-fastinfoset</a>
      module (no dependency on jaxb-impl is required). The following
      dependency needs to be added to the pom: </p><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
    &lt;artifactId&gt;jersey-fastinfoset&lt;/artifactId&gt;
    &lt;version&gt;1.9&lt;/version&gt;
&lt;/dependency&gt;</pre>

      <p>Non-maven developers require: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <a class="ulink" href="http://download.java.net/maven/1/com.sun.xml.fastinfoset/jars/FastInfoset-1.2.2.jar" target="_top">FastInfoset.jar</a>

            ,
          </li><li class="listitem">
            <a class="ulink" href="http://download.java.net/maven/1/com.sun.xml.bind/jars/jaxb-impl-2.1.12.jar" target="_top">jaxb-impl.jar</a>

            ,
          </li><li class="listitem">
            <a class="ulink" href="http://download.java.net/maven/1/javax.xml.bind/jars/jaxb-api-2.1.jar" target="_top">jaxb-api.jar</a>

            ,
          </li><li class="listitem">
            <a class="ulink" href="http://download.java.net/maven/1/javax.activation/jars/activation-1.1.jar" target="_top">activation.jar</a>

            ,
          </li><li class="listitem">
            <a class="ulink" href="http://download.java.net/maven/1/javax.xml.stream/jars/stax-api-1.0-2.jar" target="_top">stax-api.jar</a>
          </li></ul></div><p> and additionally, if not depending on the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-bundle&amp;v=1.9&amp;e=jar" target="_top">jersey-bundle.jar</a>,
      non-maven developers require: <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-fastinfoset&amp;v=1.9&amp;e=jar" target="_top">jersey-fastinfoset.jar</a></p>
    </div>

    <div class="section" title="11.4.2.&nbsp;Atom"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1796"></a>11.4.2.&nbsp;Atom</h3></div></div></div>
      

      <p>The use of the Java types
      <code class="code">org.apache.abdera.model.{Categories, Entry, Feed, Service}</code>
      requires a dependency on Apache Abdera.</p>

      <p>Maven developers require a dependency on the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.contribs&amp;a=jersey-atom-abdera&amp;v=1.9&amp;e=pom" target="_top">jersey-atom-abdera</a>
      module. The following dependency needs to be added to the pom:
      </p><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;com.sun.jersey.contribs&lt;/groupId&gt;
    &lt;artifactId&gt;jersey-atom-abdera&lt;/artifactId&gt;
    &lt;version&gt;1.9&lt;/version&gt;
&lt;/dependency&gt;</pre>

      <p>The use of the Java types
      <code class="code">com.sun.syndication.feed.atom.Entry</code> and
      <code class="code">com.sun.syndication.feed.atom.Feed</code> requires a dependency on
      ROME version 0.9 or higher.</p>

      <p>Maven developers require a dependency on the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-atom&amp;v=1.9&amp;e=pom" target="_top">jersey-atom</a>
      module. The following dependency needs to be added to the pom:
      </p><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
    &lt;artifactId&gt;jersey-atom&lt;/artifactId&gt;
    &lt;version&gt;1.9&lt;/version&gt;
&lt;/dependency&gt;</pre>

      <p>Non-maven developers require: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <a class="ulink" href="http://download.java.net/maven/1/rome/jars/rome-0.9.jar" target="_top">rome.jar</a>

            ,
          </li><li class="listitem">
            <a class="ulink" href="http://repo1.maven.org/maven2/jdom/jdom/1.0/jdom-1.0.jar" target="_top">jdom.jar</a>
          </li></ul></div><p> and additionally, if not depending on the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-bundle&amp;v=1.9&amp;e=jar" target="_top">jersey-bundle.jar</a>,
      non-maven developers require: <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-atom&amp;v=1.9&amp;e=jar" target="_top">jersey-atom.jar</a></p>
    </div>

    <div class="section" title="11.4.3.&nbsp;JSON"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1817"></a>11.4.3.&nbsp;JSON</h3></div></div></div>
      

      <p>The use of the Java types
      <code class="code">org.codehaus.jettison.json.JSONObject</code> and
      <code class="code">org.codehaus.jettison.json.JSONArray</code> requires Jettison
      version 1.1 or higher.</p>

      <p>Maven developers require a dependency on the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-json&amp;v=1.9&amp;e=pom" target="_top">jersey-json</a>
      module. The following dependency needs to be added to the pom:
      </p><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
    &lt;artifactId&gt;jersey-json&lt;/artifactId&gt;
    &lt;version&gt;1.9&lt;/version&gt;
&lt;/dependency&gt;</pre>

      <p>Non-maven developers require: <a class="ulink" href="http://repo1.maven.org/maven2/org/codehaus/jettison/jettison/1.1/jettison-1.1.jar" target="_top">jettison.jar</a>
      and additionally, if not depending on the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-bundle&amp;v=1.9&amp;e=jar" target="_top">jersey-bundle.jar</a>
      non-maven developers require: <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey&amp;a=jersey-json&amp;v=1.9&amp;e=jar" target="_top">jersey-json.jar</a></p>
    </div>

    <div class="section" title="11.4.4.&nbsp;Mail and MIME multipart"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1829"></a>11.4.4.&nbsp;Mail and MIME multipart</h3></div></div></div>
      

      <p>The use of the Java type
      <code class="code">javax.mail.internet.MimeMultipart</code>
      requires Java Mail version 1.4 or higher.</p>

      <p>Maven developers require a dependency on the <a class="ulink" href="http://download.java.net/maven/1/javax.mail/poms/mail-1.4.pom" target="_top">java-mail</a>
      module.</p>

      <p>Non-maven developers require: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <a class="ulink" href="http://download.java.net/maven/1/javax.mail/jars/mail-1.4.jar" target="_top">mail.jar</a>

            ,
          </li><li class="listitem">
            <a class="ulink" href="http://download.java.net/maven/1/javax.activation/jars/activation-1.1.jar" target="_top">activation.jar</a>
          </li></ul></div>

      <p>Jersey ships with a high-level MIME multipart API. Maven
      developers requires a dependency on the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.contribs&amp;a=jersey-multipart&amp;v=1.9&amp;e=pom" target="_top">jersey-multipart</a>
      module. The following dependency needs to be added to the pom:
      </p><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;com.sun.jersey.contribs&lt;/groupId&gt;
    &lt;artifactId&gt;jersey-multipart&lt;/artifactId&gt;
    &lt;version&gt;1.9&lt;/version&gt;
&lt;/dependency&gt;</pre>

      <p>Non-maven developers require: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=org.jvnet&amp;a=mimepull&amp;v=1.3&amp;e=jar" target="_top">mimepull.jar</a>

            ,
          </li><li class="listitem">
              <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.contribs&amp;a=jersey-multipart&amp;v=1.9&amp;e=jar" target="_top">jersey-multipart.jar</a>
          </li></ul></div>
    </div>

    <div class="section" title="11.4.5.&nbsp;Activation"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1850"></a>11.4.5.&nbsp;Activation</h3></div></div></div>
      

      <p>The use of the Java type <code class="code">javax.activation.DataSource</code>
      requires no additional dependencies, as Java SE 6 ships everything needed.</p>
    </div>
  </div>

  <div class="section" title="11.5.&nbsp;Tools"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1854"></a>11.5.&nbsp;Tools</h2></div></div></div>
    

    <p>By default WADL for resource classes is generated dynamically at
    runtime. WADL support requires a dependency on the JAXB reference
    implementation version 2.x or higher. Deploying an application for WADL
    support requires no additional dependences, since Java SE 6 ships with JAXB 2.x support.</p>

    <p>The WADL ant task requires the same set of dependences as those for
    runtime WADL support.</p>
  </div>

  <div class="section" title="11.6.&nbsp;Spring"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1858"></a>11.6.&nbsp;Spring</h2></div></div></div>
    

    <p>Maven developers, using Spring 2.0.x or Spring 2.5.x, require a
    dependency on the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.contribs&amp;a=jersey-spring&amp;v=1.9&amp;e=pom" target="_top">jersey-spring</a>
    module. The following dependency needs to be added to the pom:
    </p><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;com.sun.jersey.contribs&lt;/groupId&gt;
    &lt;artifactId&gt;jersey-spring&lt;/artifactId&gt;
    &lt;version&gt;1.9&lt;/version&gt;
&lt;/dependency&gt;</pre>

    <p>See the Java documentation <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/contribs/jersey-spring/com/sun/jersey/spi/spring/container/servlet/package-summary.html" target="_top">here</a>
    on how to integrate Jersey-based Web applications with Spring.</p>
  </div>

  <div class="section" title="11.7.&nbsp;Guice"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1865"></a>11.7.&nbsp;Guice</h2></div></div></div>
    

    <p>Maven developers, using Guice 2.0, require a dependency on the
    <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.contribs&amp;a=jersey-guice&amp;v=1.9&amp;e=pom" target="_top">jersey-guice</a>
    module. The following dependency needs to be added to the pom:
    </p><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;com.sun.jersey.contribs&lt;/groupId&gt;
    &lt;artifactId&gt;jersey-guice&lt;/artifactId&gt;
    &lt;version&gt;1.9&lt;/version&gt;
&lt;/dependency&gt;</pre>

    <p>See the Java documentation <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/contribs/jersey-guice/com/sun/jersey/guice/spi/container/servlet/package-summary.html" target="_top">here</a>
    on how to integrate Jersey-based Web applications with Guice.</p>

    <p>The Jersey Guice support may also be used with <a class="ulink" href="http://code.google.com/p/guiceyfruit/" target="_top">GuiceyFruit</a>, a set of
    extensions on top of Guice 2.0, such as support for Java EE artifacts like
    <code class="code">@PostConstruct</code>/<code class="code">@PreDestroy</code>,
    <code class="code">@Resource</code> and <code class="code">@PersistenceContext</code>. To avail of
    GuiceyFruit features exclude the guice dependency from the maven central
    repo and add the following:</p>

    <pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;org.guiceyfruit&lt;/groupId&gt;
    &lt;artifactId&gt;guiceyfruit&lt;/artifactId&gt;
    &lt;version&gt;2.0&lt;/version&gt;
&lt;/dependency&gt;
...
&lt;repository&gt;
    &lt;id&gt;guice-maven&lt;/id&gt;
    &lt;name&gt;guice maven&lt;/name&gt;
    &lt;url&gt;<a class="ulink" href="http://guiceyfruit.googlecode.com/svn/repo/releases" target="_top">http://guiceyfruit.googlecode.com/svn/repo/releases</a>&lt;/url&gt;
&lt;/repository&gt;</pre>
  </div>

  <div class="section" title="11.8.&nbsp;Jersey Test Framework"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1881"></a>11.8.&nbsp;Jersey Test Framework</h2></div></div></div>
    

    <p><span class="emphasis"><em>NOTE that breaking changes have occurred between 1.1.1-ea
    and 1.1.2-ea. See the end of this section for details.</em></span></p>

    <p>Jersey Test Framework allows you to test your RESTful Web Services
    on a wide range of containers. It supports light-weight containers such as
    Grizzly, Embedded GlassFish, and the Light Weight HTTP Server in addition
    to regular web containers such as GlassFish and Tomcat. Developers may
    plug in their own containers.</p>

    <p>A developer may write tests using the Junit 4.x framework can extend
    from the abstract <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey-test-framework/com/sun/jersey/test/framework/JerseyTest.html" target="_top">JerseyTest</a>
    class.</p>

    <p>Maven developers require a dependency on the <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.jersey-test-framework&amp;a=jersey-test-framework-grizzly&amp;v=1.9&amp;e=pom" target="_top">jersey-test-framework-grizzly</a>
    module. The following dependency needs to be added to the pom:
    </p><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;com.sun.jersey.jersey-test-framework&lt;/groupId&gt;
    &lt;artifactId&gt;jersey-test-framework-grizzly&lt;/artifactId&gt;
    &lt;version&gt;1.9&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</pre>

    <p>When utilizing an embedded container this framework can manage
    deployment and testing of your web services. However, the framework
    currently doesn't support instantiating and deploying on external
    containers.</p>

    <p>The test framework provides the following test container factories:
    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
          <code class="code">com.sun.jersey.test.framework.spi.container.http.HTTPContainerFactory</code>

           for testing with the Light Weight HTTP server.
        </li><li class="listitem">
          <code class="code">com.sun.jersey.test.framework.spi.container.inmemory.InMemoryTestContainerFactory</code>

           for testing in memory without using HTTP.
        </li><li class="listitem">
          <code class="code">com.sun.jersey.test.framework.spi.container.grizzly.GrizzlyTestContainerFactory</code>

           for testing with low-level Grizzly.
        </li><li class="listitem">
          <code class="code">com.sun.jersey.test.framework.spi.container.grizzly.web.GrizzlyWebTestContainerFactory</code>

           for testing with Web-based Grizzly.
        </li><li class="listitem">
          <code class="code">com.sun.jersey.test.framework.spi.container.grizzly2.GrizzlyTestContainerFactory</code>

           for testing with low-level Grizzly2.
        </li><li class="listitem">
          <code class="code">com.sun.jersey.test.framework.spi.container.grizzly2.web.GrizzlyWebTestContainerFactory</code>

           for testing with Web-based Grizzly2.
        </li><li class="listitem">
          <code class="code">com.sun.jersey.test.framework.spi.container.embedded.glassfish.EmbeddedGlassFishTestContainerFactory</code>

           for testing with embedded GlassFish v3
        </li><li class="listitem">
          <code class="code">com.sun.jersey.test.framework.spi.container.external.ExternalTestContainerFactory</code>

           for testing with application deployed externally, for example to GlassFish or Tomcat. 
        </li></ul></div>

    <p>The system property <code class="code">jersey.test.containerFactory</code> is
    utilized to declare the default test container factory that shall be used
    for testing, the value of which is the fully qualified class name of a
    test container factory class. If the property is not declared then the
    GrizzlyWebTestContainerFactory is utilized as default test container
    factory.</p>

    <p>To test a maven-based web project with an external container such as
    GlassFish, create the war file then deploy as follows (assuming that the
    pom file is set up for deployment): </p><pre class="programlisting">mvn clean package -Dmaven.test.skip=true
</pre><p> Then execute the tests as follows: </p><pre class="programlisting">mvn test \ -Djersey.test.containerFactory=com.sun.jersey.test.framework.spi.container.embedded.glassfish.external.ExternalTestContainerFactory \
-DJERSEY_HTTP_PORT=&lt;HTTP_PORT&gt;
</pre>

    <p><span class="emphasis"><em>Breaking changes from 1.1.1-ea to
    1.1.2-ea</em></span></p>

    <p>The maven project groupId has changed from
    <code class="code">com.sun.jersey.test.framework</code> to
    <code class="code">com.sun.jersey</code></p>

    <p>The extending of Jersey unit test and configuration has changed. See
    <a class="ulink" href="http://jersey.java.net/nonav/apidocs/1.9/jersey-test-framework/com/sun/jersey/test/framework/package-summary.html" target="_top">here</a>
    for an example.</p>

    <p>See the blog entry on <a class="ulink" href="http://blogs.sun.com/naresh/entry/jersey_test_framework_makes_it" target="_top">Jersey
    Test Framework</a> for detailed instructions on how to use 1.1.1-ea
    version of the framework in your application.</p>
  </div>
</div>
  <div class="chapter" title="Chapter&nbsp;12.&nbsp;Jersey with GlassFish"><div class="titlepage"><div><div><h2 class="title"><a name="glassfish"></a>Chapter&nbsp;12.&nbsp;Jersey with GlassFish</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d4e1927">12.1. Overriding Jersey with war files</a></span></dt><dt><span class="section"><a href="#d4e1934">12.2. Upgrading Jersey in GlassFish</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1936">12.2.1. GlassFish v3.0 and 3.0.1</a></span></dt><dt><span class="section"><a href="#d4e1956">12.2.2. GlassFish 3.1</a></span></dt></dl></dd></dl></div>
    

    <p>This chapter will present instructions on how to use Jersey with Glassfish
        when Jersey is distributed in the war and to manually upgrade the Jersey version
        bundled with a GlassFish installation.
    </p>

    <div class="section" title="12.1.&nbsp;Overriding Jersey with war files"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1927"></a>12.1.&nbsp;Overriding Jersey with war files</h2></div></div></div>
        
        <p>To override the version of Jersey distributed in GlassFish with
        a version of Jersey distributed in a war file ensure that
        class loader delegation is set to false in
        WEB-INF/sun-web.xml or WEB-INF/glassfish-web.xml. For example:
            </p><pre class="programlisting">&lt;sun-web-app error-url=""&gt;
    &lt;context-root&gt;/context&lt;/context-root&gt;
    &lt;class-loader delegate="false"/&gt;
&lt;/sun-web-app&gt;</pre><p>
        </p>
        <p>In the GlassFish admin console, go to Configuration-&gt;JVM Settings,
        switch to the JVM Options tab and add the following option:
            </p><pre class="programlisting">-Dcom.sun.enterprise.overrideablejavaxpackages=javax.ws.rs,javax.ws.rs.core,javax.ws.rs.ext</pre><p>
        </p>
        <p>Restart GlassFish for new JVM settings to take effect.</p>
    </div>

    <div class="section" title="12.2.&nbsp;Upgrading Jersey in GlassFish"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1934"></a>12.2.&nbsp;Upgrading Jersey in GlassFish</h2></div></div></div>
        

        <div class="section" title="12.2.1.&nbsp;GlassFish v3.0 and 3.0.1"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1936"></a>12.2.1.&nbsp;GlassFish v3.0 and 3.0.1</h3></div></div></div>
            
            <p>
GlassFish v3.0 comes up with Jersey version 1.1.4.1. GlassFish v3.0.1 with Jersey version 1.1.5. To upgrade these to 1.9 you will need 
to replace certain files manually.
            </p>

            <p>
GlassFish uses Jersey internally in it's REST administration API, and 
the Update Center client would not allow you to upgrade in order to prevent this functionality.
The workaround described in this section is known to work, but it is not currently a tested and supported
scenario. Please keep in mind things could break. It is recommended to back up all all impacted files.
The actual replace steps follow.
            </p>

            <p>Remove the existing Jersey files:
Stop all running server instances. Then remove the following files from the GlassFish installation directory:

                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">glassfish/modules/jsr311-api.jar</li><li class="listitem">glassfish/modules/jersey-gf-bundle.jar</li><li class="listitem">glassfish/modules/jersey-gf-statsproviders.jar</li><li class="listitem">glassfish/modules/jersey-multipart.jar</li><li class="listitem">glassfish/modules/jackson-core-asl.jar</li><li class="listitem">glassfish/modules/jettison.jar</li><li class="listitem">glassfish/modules/mimepull.jar</li></ul></div><p>

Download the new Jersey version archive from

                <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.glassfish.v3&amp;a=jersey-gfv3-core&amp;v=1.9&amp;c=project&amp;e=zip" target="_top">https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.glassfish.v3&amp;a=jersey-gfv3-core&amp;v=1.9&amp;c=project&amp;e=zip</a>

and unzip it's
                <code class="literal">glassfish/modules</code> content into the GlassFish installation directory (to the
                <code class="literal">glassfish/modules</code> subdirectory there).
            </p>

            <p>
To install also Jersey examples in addition, download

                <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.glassfish.v3&amp;a=jersey-gfv3-docs-and-samples&amp;v=1.9&amp;c=project&amp;e=zip" target="_top">https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.glassfish.v3&amp;a=jersey-gfv3-docs-and-samples&amp;v=1.9&amp;c=project&amp;e=zip</a>

and unzip it's content into the GlassFish installation directory.
            </p>
            <p>
To be 100 % sure the changes take effect, you might also want to remove the felix cache, which is located in
                <code class="literal">glassfish/domains/domain1/osgi-cache</code> directory.
This directory gets created upon the first start of the GlassFish instance.  
            </p>
        </div>

        <div class="section" title="12.2.2.&nbsp;GlassFish 3.1"><div class="titlepage"><div><div><h3 class="title"><a name="d4e1956"></a>12.2.2.&nbsp;GlassFish 3.1</h3></div></div></div>
            
            <p>GlassFish 3.1 is released.  GlassFish 3.1 builds can be downloaded from
                <a class="ulink" href="http://glassfish.java.net/downloads/3.1-final.html" target="_top">http://glassfish.java.net/downloads/3.1-final.html</a>
            </p>
            <p>
If you want to update the Jersey bits in GlassFish with the latest Jersey snapshot version, or if you want to install Jersey documentation and examples, you would need
to do the following steps:
            </p>
            <p>Remove the existing Jersey files:
Stop all running server instances. Then remove the following files from the GlassFish installation directory:

                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">glassfish/modules/jersey-core.jar</li><li class="listitem">glassfish/modules/jersey-client.jar</li><li class="listitem">glassfish/modules/jersey-gf-server.jar</li><li class="listitem">glassfish/modules/jersey-json.jar</li><li class="listitem">glassfish/modules/jersey-multipart.jar</li><li class="listitem">glassfish/modules/jersey-gf-statsproviders.jar</li><li class="listitem">glassfish/modules/jackson-core-asl.jar</li><li class="listitem">glassfish/modules/jackson-mapper-asl.jar</li><li class="listitem">glassfish/modules/jackson-jaxrs.jar</li><li class="listitem">glassfish/modules/jettison.jar</li></ul></div><p>

Download the new Jersey version archive from

                <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.glassfish.v3&amp;a=jersey-gfv3-core&amp;v=1.9&amp;c=project&amp;e=zip" target="_top">https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.glassfish.v3&amp;a=jersey-gfv3-core&amp;v=1.9&amp;c=project&amp;e=zip</a>

and unzip it's
                <code class="literal">glassfish/modules</code> content into the GlassFish installation directory (to the
                <code class="literal">glassfish/modules</code> subdirectory there).
            </p>

            <p>
To install also Jersey examples in addition, download (you can change the version in the link to get another non-snapshot version of Jersey)

                <a class="ulink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.glassfish.v3&amp;a=jersey-gfv3-docs-and-samples&amp;v=1.9&amp;c=project&amp;e=zip" target="_top">https://maven.java.net/service/local/artifact/maven/redirect?r=releases&amp;g=com.sun.jersey.glassfish.v3&amp;a=jersey-gfv3-docs-and-samples&amp;v=1.9&amp;c=project&amp;e=zip</a>

and unzip it's content into the GlassFish installation directory.
            </p>
            <p>
To be 100 % sure the changes take effect, you might also want to remove the felix cache, which is located in
                <code class="literal">glassfish/domains/domain1/osgi-cache</code> directory.
This directory gets created upon the first start of the GlassFish instance.
            </p>
        </div>
    </div>

</div>
  <div class="chapter" title="Chapter&nbsp;13.&nbsp;Building and testing Jersey"><div class="titlepage"><div><div><h2 class="title"><a name="how-to-build"></a>Chapter&nbsp;13.&nbsp;Building and testing Jersey</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d4e1982">13.1. Checking out the source</a></span></dt><dt><span class="section"><a href="#d4e1997">13.2. Building using Maven</a></span></dt><dt><span class="section"><a href="#d4e2009">13.3. Testing</a></span></dt><dt><span class="section"><a href="#d4e2015">13.4. Continuous building and testing with Hudson</a></span></dt><dt><span class="section"><a href="#d4e2019">13.5. Using NetBeans</a></span></dt></dl></div>
  

<div class="section" title="13.1.&nbsp;Checking out the source"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1982"></a>13.1.&nbsp;Checking out the source</h2></div></div></div>

<p>
The Jersey source code is available from the Subversion repository located at
<a class="ulink" href="http://java.net/projects/jersey/sources/svn/show" target="_top">http://java.net/projects/jersey/sources/svn/show</a>.
</p>
<p>
To check out the trunk where active development on the next release occurs use
the following command:
</p><pre class="programlisting">
svn checkout https://svn.java.net/svn/jersey~svn/trunk/jersey jersey --username &lt;username&gt;
</pre><p>
</p>
<p>
If you are new to Subversion, you may want to visit the <a class="ulink" href="http://subversion.tigris.org/" target="_top">Subversion Project website</a> and read <a class="ulink" href="http://svnbook.red-bean.com/" target="_top">Version Control with Subversion</a>.
</p>
<p>
<a class="ulink" href="http://jersey.java.net/servlets/ProjectSource" target="_top">Read more about how to checkout this project's repository...</a>
</p>
<p>
Stable releases of Jersey are tagged in the location
<a class="ulink" href="http://jersey.java.net/svn/jersey/tags" target="_top">http://jersey.java.net/svn/jersey/tags</a>.
</p>
<p>
The source code may be browsed using
<a class="ulink" href="http://fisheye4.atlassian.com/browse/jersey" target="_top">FishEye</a>.
</p>
</div>

<div class="section" title="13.2.&nbsp;Building using Maven"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e1997"></a>13.2.&nbsp;Building using Maven</h2></div></div></div>

<p>
Java SE 6 or greater is required. Maven 2.2.1 or greater is recommended.
</p>
<p>
It is recommended to build the whole of Jersey after you have initially checked
out the source code.
To build all of Jersey use the following command from the checked out
<code class="literal">jersey</code> directory:
</p><pre class="programlisting">
mvn clean install
</pre><p>
To skip all the tests do:
</p><pre class="programlisting">
mvn -Dmaven.test.skip=true clean install
</pre><p>
The following maven options are recommended:
</p><pre class="programlisting">
-Xmx1048m -XX:PermSize=64M -XX:MaxPermSize=128M
</pre><p>
</p>

<p>
Building the whole Jersey project including tests could take about an hour, depending on your system 
performance of course. Even if you have a pretty fast performant machine, this could be quite annoying.
Especially if you just want to experiment with a limited amount of code.
To avoid building the whole Jersey project tree, you can easily utilize the maven reactor plugin.
</p>
<p>
To build only the modules needed for the helloworld example, you can launch:
</p><pre class="programlisting">
mvn reactor:make -Dmake.goals=clean,install -Dmake.folders=samples/helloworld
</pre><p> 
which takes less then 2 minutes on my machine. To switch testing off, when building the same
set of modules, you will use:
</p><pre class="programlisting">
mvn reactor:make -Dmake.goals=-Dmaven.test.skip,clean,install -Dmake.folders=samples/helloworld
</pre><p> 
</p>
</div>

<div class="section" title="13.3.&nbsp;Testing"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e2009"></a>13.3.&nbsp;Testing</h2></div></div></div>

<p>
Jersey contains many unit tests. Most of these are not really unit tests per-say
and are functional tests using the JUnit test framework because it is very
convientient for execution and reporting.
</p>
<p>
Some modules have specific tests but most tests associated with testing the
jersey-core, jersey-client and jersey-server modules are located in the
jersey-test module. This module can take some time to execute all the tests so
it is recommended that you pick the appropriate tests to run related to the
particular area that is being investigated. For example,
using:
</p><pre class="programlisting">
mvn -Dtest=&lt;pattern&gt; test
</pre><p>
where <code class="literal">pattern</code> may be a comma separated set of names matching
tests.
</p>
</div>
<div class="section" title="13.4.&nbsp;Continuous building and testing with Hudson"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e2015"></a>13.4.&nbsp;Continuous building and testing with Hudson</h2></div></div></div>

<p>
Jersey is built, tested and deployed on Solaris, Windows and Linux using an
interal Hudson server. The Jersey Hudson jobs are available publically
at <a class="ulink" href="http://hudson.glassfish.org/job/Jersey-trunk-multiplatform/" target="_top">
    http://hudson.glassfish.org/job/Jersey-trunk-multiplatform/</a>.
</p>
</div>

<div class="section" title="13.5.&nbsp;Using NetBeans"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e2019"></a>13.5.&nbsp;Using NetBeans</h2></div></div></div>

<p>
NetBeans 6.8 or greater has excellent maven support. The Jersey maven
modules can be loaded, built and tested in NetBeans without any additional
project-specific requirements.
</p>
</div>

</div>

</div></body></html>